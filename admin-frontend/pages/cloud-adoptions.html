<!-- äº‘å…»ç®¡ç† -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">ğŸ± äº‘å…»ç®¡ç†</h2>
        <div class="card-actions">
            <button class="btn btn-primary btn-sm" onclick="refreshCloudAdoptions()">åˆ·æ–°</button>
        </div>
    </div>
    <div class="card-body">
        <div class="filter-bar" style="margin-bottom:16px;">
            <select id="caStatusFilter" onchange="refreshCloudAdoptions()" style="padding:6px 12px;border:1px solid #ddd;border-radius:4px;">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="true">è¿›è¡Œä¸­</option>
                <option value="false">å·²ç»“æŸ</option>
            </select>
        </div>
        <div class="table-responsive">
            <table class="table" id="cloudAdoptionTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ç”¨æˆ·</th>
                        <th>çŒ«å’ª</th>
                        <th>äº‘å…»åç§°</th>
                        <th>æœˆé¢(å…ƒ)</th>
                        <th>å¼€å§‹æ—¥æœŸ</th>
                        <th>ç»“æŸæ—¥æœŸ</th>
                        <th>çŠ¶æ€</th>
                        <th>ç´¯è®¡é‡‘é¢</th>
                        <th>åˆ›å»ºæ—¶é—´</th>
                    </tr>
                </thead>
                <tbody id="cloudAdoptionBody">
                    <tr><td colspan="10" class="text-center">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
        <div id="cloudAdoptionPagination" class="pagination-wrap"></div>
    </div>
</div>

<script>
(function() {
    let caPage = 1;
    const caSize = 10;

    window.refreshCloudAdoptions = async function(page) {
        if (page) caPage = page;
        const tbody = document.getElementById('cloudAdoptionBody');
        tbody.innerHTML = '<tr><td colspan="10" class="text-center">åŠ è½½ä¸­...</td></tr>';
        try {
            const params = { page: caPage, size: caSize };
            const statusVal = document.getElementById('caStatusFilter').value;
            if (statusVal) params.isActive = statusVal;
            const res = await API.get('/cloud-adoption/page', params);
            if (res.code === 200 && res.data) {
                const records = res.data.records || [];
                if (records.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="10" class="text-center">æš‚æ— æ•°æ®</td></tr>';
                    return;
                }
                tbody.innerHTML = records.map(a => `<tr>
                    <td>${a.id}</td>
                    <td>${a.username || a.userId}</td>
                    <td>${a.catName || a.catId}</td>
                    <td>${a.adoptionName || '-'}</td>
                    <td>${a.monthlyAmount || 0}</td>
                    <td>${a.startDate || '-'}</td>
                    <td>${a.endDate || '-'}</td>
                    <td><span class="badge ${a.isActive ? 'badge-success' : 'badge-secondary'}">${a.isActive ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}</span></td>
                    <td>Â¥${(a.totalAmount || 0).toFixed ? a.totalAmount.toFixed(2) : a.totalAmount || 0}</td>
                    <td>${(a.createTime || '').replace('T', ' ').substring(0, 16)}</td>
                </tr>`).join('');
                // Pagination
                const totalPages = res.data.pages || Math.ceil((res.data.total || 0) / caSize);
                const pagDiv = document.getElementById('cloudAdoptionPagination');
                pagDiv.innerHTML = '';
                if (totalPages > 1) {
                    for (let i = 1; i <= totalPages; i++) {
                        pagDiv.innerHTML += `<button class="btn btn-sm ${i===caPage?'btn-primary':'btn-outline'}" onclick="refreshCloudAdoptions(${i})">${i}</button> `;
                    }
                }
            } else {
                tbody.innerHTML = '<tr><td colspan="10" class="text-center">åŠ è½½å¤±è´¥</td></tr>';
            }
        } catch (err) {
            tbody.innerHTML = `<tr><td colspan="10" class="text-center">åŠ è½½å¤±è´¥: ${err.message}</td></tr>`;
        }
    };

    refreshCloudAdoptions();
})();
</script>
