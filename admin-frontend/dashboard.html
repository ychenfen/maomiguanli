<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - çŒ«å’ªæ•‘åŠ©ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
        }

        .header {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left h1 {
            font-size: 20px;
            color: #333;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            color: #666;
            font-size: 14px;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #f56c6c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .logout-btn:hover {
            background: #f45454;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 12px;
            color: #999;
        }

        .stat-card.blue { border-left: 4px solid #409EFF; }
        .stat-card.green { border-left: 4px solid #67C23A; }
        .stat-card.orange { border-left: 4px solid #E6A23C; }
        .stat-card.red { border-left: 4px solid #F56C6C; }

        .section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: #f5f7fa;
            padding: 12px;
            text-align: left;
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            color: #333;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1>ğŸ± çŒ«å’ªæ•‘åŠ©ç³»ç»Ÿ - ç®¡ç†åå°</h1>
        </div>
        <div class="header-right">
            <div class="user-info">
                <span id="userName">ç®¡ç†å‘˜</span>
            </div>
            <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
        </div>
    </div>

    <div class="container">
        <div id="loadingMessage" class="loading">åŠ è½½ä¸­...</div>
        <div id="errorMessage" class="error" style="display: none;"></div>
        <div id="content" style="display: none;">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card blue">
                    <h3>ç”¨æˆ·æ€»æ•°</h3>
                    <div class="value" id="totalUsers">-</div>
                    <div class="label">ä»Šæ—¥æ–°å¢: <span id="todayUsers">-</span></div>
                </div>
                <div class="stat-card green">
                    <h3>çŒ«å’ªæ€»æ•°</h3>
                    <div class="value" id="totalCats">-</div>
                    <div class="label">å¯é¢†å…»: <span id="adoptableCats">-</span></div>
                </div>
                <div class="stat-card orange">
                    <h3>ç¤¾åŒºåŠ¨æ€</h3>
                    <div class="value" id="totalDynamics">-</div>
                    <div class="label">ä»Šæ—¥å‘å¸ƒ: <span id="todayDynamics">-</span></div>
                </div>
                <div class="stat-card red">
                    <h3>å¾…å®¡æ ¸ç”³è¯·</h3>
                    <div class="value" id="pendingApplications">-</div>
                    <div class="label">èº«ä»½è®¤è¯ç”³è¯·</div>
                </div>
            </div>

            <!-- è´¢åŠ¡ç»Ÿè®¡ -->
            <div class="section">
                <h2>è´¢åŠ¡æ¦‚è§ˆ</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>æ€»æ”¶å…¥</h3>
                        <div class="value" id="totalIncome">-</div>
                        <div class="label">æœ¬æœˆ: Â¥<span id="monthIncome">-</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>æ€»æ”¯å‡º</h3>
                        <div class="value" id="totalExpense">-</div>
                        <div class="label">æœ¬æœˆ: Â¥<span id="monthExpense">-</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>å½“å‰ä½™é¢</h3>
                        <div class="value" id="currentBalance">-</div>
                        <div class="label">å¾…å¤„ç†äº¤æ˜“: <span id="pendingTransactions">-</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        const API_BASE = (window.__API_BASE__ || '/api').replace(/\/$/, '');

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkAuth() {
            const token = localStorage.getItem('admin_token');
            const user = localStorage.getItem('admin_user');

            if (!token || !user) {
                window.location.href = 'login.html';
                return null;
            }

            const userObj = JSON.parse(user);
            document.getElementById('userName').textContent = userObj.realName || userObj.username;

            return token;
        }

        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('admin_token');
            localStorage.removeItem('admin_user');
            window.location.href = 'login.html';
        }

        // åŠ è½½æ•°æ®
        async function loadDashboardData() {
            const token = checkAuth();
            if (!token) return;

            try {
                const response = await fetch(`${API_BASE}/admin/dashboard/statistics`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();

                if (result.code === 200) {
                    displayData(result.data);
                    document.getElementById('loadingMessage').style.display = 'none';
                    document.getElementById('content').style.display = 'block';
                } else if (result.code === 401) {
                    showError('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
                    setTimeout(() => {
                        logout();
                    }, 2000);
                } else {
                    showError(result.message || 'åŠ è½½æ•°æ®å¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®é”™è¯¯:', error);
                showError('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨');
            }
        }

        // æ˜¾ç¤ºæ•°æ®
        function displayData(data) {
            // ç”¨æˆ·ç»Ÿè®¡
            if (data.userStatistics) {
                document.getElementById('totalUsers').textContent = data.userStatistics.totalUsers || 0;
                document.getElementById('todayUsers').textContent = data.userStatistics.todayNewUsers || 0;
            }

            // çŒ«å’ªç»Ÿè®¡
            if (data.catStatistics) {
                document.getElementById('totalCats').textContent = data.catStatistics.totalCats || 0;
                document.getElementById('adoptableCats').textContent = data.catStatistics.adoptableCats || 0;
            }

            // å†…å®¹ç»Ÿè®¡
            if (data.contentStatistics) {
                document.getElementById('totalDynamics').textContent = data.contentStatistics.totalDynamics || 0;
                document.getElementById('todayDynamics').textContent = data.contentStatistics.todayDynamics || 0;
            }

            // è®¤è¯ç»Ÿè®¡
            if (data.verificationStatistics) {
                document.getElementById('pendingApplications').textContent = data.verificationStatistics.pendingApplications || 0;
            }

            // è´¢åŠ¡ç»Ÿè®¡
            if (data.financialStatistics) {
                document.getElementById('totalIncome').textContent = 'Â¥' + (data.financialStatistics.totalIncome || 0);
                document.getElementById('monthIncome').textContent = data.financialStatistics.monthIncome || 0;
                document.getElementById('totalExpense').textContent = 'Â¥' + (data.financialStatistics.totalExpense || 0);
                document.getElementById('monthExpense').textContent = data.financialStatistics.monthExpense || 0;
                document.getElementById('currentBalance').textContent = 'Â¥' + (data.financialStatistics.currentBalance || 0);
                document.getElementById('pendingTransactions').textContent = data.financialStatistics.pendingTransactions || 0;
            }
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('loadingMessage').style.display = 'none';
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.onload = () => {
            loadDashboardData();
        };
    </script>
</body>
</html>
