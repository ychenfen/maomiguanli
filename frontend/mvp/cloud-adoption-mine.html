<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆ‘çš„äº‘å…» - æ ¡å›­çŒ«å’ªæ•‘åŠ©</title>
  <link rel="stylesheet" href="/mvp/mvp.css" />
  <script src="/config.js"></script>
  <script src="/mvp/mvp.js"></script>
</head>
<body>
  <div id="nav"></div>
  <div class="container">
    <div class="page-header">
      <h1>æˆ‘çš„äº‘å…»</h1>
      <p>æŸ¥çœ‹å’Œç®¡ç†ä½ æ­£åœ¨è¿›è¡Œçš„äº‘å…»è®°å½•</p>
    </div>
    <div class="stats-row">
      <div class="stat-box"><div class="num" id="statActive">-</div><div class="label">è¿›è¡Œä¸­</div></div>
      <div class="stat-box"><div class="num" id="statTotal">-</div><div class="label">ç´¯è®¡é‡‘é¢</div></div>
      <div class="stat-box"><div class="num" id="statExpiring">-</div><div class="label">å³å°†åˆ°æœŸ</div></div>
    </div>
    <div id="listContainer"><div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div></div>
  </div>
  <script>
    document.getElementById('nav').innerHTML = MVP.renderNav('cloud-mine');
    async function load() {
      if (!MVP.requireLogin()) return;
      const container = document.getElementById('listContainer');
      try {
        const statsRes = await MVP.apiGet('/cloud-adoption/stats');
        if (statsRes.code === 200 && statsRes.data) {
          document.getElementById('statActive').textContent = statsRes.data.activeCount || 0;
          document.getElementById('statTotal').textContent = 'Â¥' + MVP.fmtMoney(statsRes.data.totalAmount);
          document.getElementById('statExpiring').textContent = statsRes.data.expiringCount || 0;
        }
        const res = await MVP.apiGet('/cloud-adoption/my-adoptions');
        if (res.code !== 200) { container.innerHTML = '<div class="empty"><p>åŠ è½½å¤±è´¥</p></div>'; return; }
        const list = res.data || [];
        if (list.length === 0) {
          container.innerHTML = '<div class="empty"><div class="icon">ğŸ±</div><p>ä½ è¿˜æ²¡æœ‰äº‘å…»è®°å½•</p><a href="/mvp/cloud-adoption-order.html" class="btn btn-primary" style="margin-top:12px;">å»å‘èµ·äº‘å…»</a></div>';
          return;
        }
        container.innerHTML = '<div class="grid grid-2">' + list.map(a => `
          <div class="item-card" onclick="window.location.href='/mvp/cloud-adoption-detail.html?adoptionId=${a.id}'">
            <img class="cover" src="${MVP.catImg(a.catCoverImage)}" alt="${a.catName}" style="height:140px;" onerror="this.style.background='#edf2f7'" />
            <div class="info">
              <h3>${a.adoptionName || a.catName}</h3>
              <div class="meta">
                <span>çŒ«å’ª: ${a.catName}</span>
                <span class="badge ${a.isActive ? 'badge-active' : 'badge-cancelled'}">${a.isActive ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}</span>
              </div>
              <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center;">
                <span style="color:var(--primary);font-weight:600;font-size:18px;">Â¥${MVP.fmtMoney(a.monthlyAmount)}<span style="font-size:12px;color:var(--text-secondary);font-weight:400;">/æœˆ</span></span>
                <span style="font-size:12px;color:var(--text-secondary);">${a.startDate} ~ ${a.endDate}</span>
              </div>
              ${a.message ? `<div style="margin-top:8px;font-size:13px;color:var(--text-secondary);background:#f7fafc;padding:8px;border-radius:6px;">"${a.message}"</div>` : ''}
            </div>
          </div>
        `).join('') + '</div>';
      } catch (err) {
        container.innerHTML = `<div class="empty"><p>åŠ è½½å¤±è´¥: ${err.message}</p></div>`;
      }
    }
    load();
  </script>
</body>
</html>
