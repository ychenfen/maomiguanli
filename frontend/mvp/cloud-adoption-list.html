<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>äº‘å…»çŒ«å’ª - æ ¡å›­çŒ«å’ªæ•‘åŠ©</title>
  <link rel="stylesheet" href="/mvp/mvp.css" />
  <script src="/config.js"></script>
  <script src="/mvp/mvp.js"></script>
</head>
<body>
  <div id="nav"></div>
  <div class="container">
    <div class="page-header">
      <h1>äº‘å…»çŒ«å’ª</h1>
      <p>é€‰æ‹©ä¸€åªçŒ«å’ªï¼Œå¼€å§‹ä½ çš„äº‘å…»ä¹‹æ—…ã€‚æ¯æœˆå®šé¢èµ„åŠ©ï¼Œè®©æµæµªçŒ«æ„Ÿå—æ¸©æš–ã€‚</p>
    </div>

    <!-- ç»Ÿè®¡ -->
    <div class="stats-row" id="statsRow">
      <div class="stat-box"><div class="num" id="statTotal">-</div><div class="label">å¯äº‘å…»çŒ«å’ª</div></div>
      <div class="stat-box"><div class="num" id="statActive">-</div><div class="label">è¿›è¡Œä¸­äº‘å…»</div></div>
      <div class="stat-box"><div class="num" id="statAmount">-</div><div class="label">ç´¯è®¡äº‘å…»é‡‘é¢</div></div>
    </div>

    <!-- çŒ«å’ªåˆ—è¡¨ -->
    <div class="grid grid-3" id="catList">
      <div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div>
    </div>
    <div id="pagination"></div>
  </div>

  <script>
    document.getElementById('nav').innerHTML = MVP.renderNav('cloud-list');

    let currentPage = 1;
    const pageSize = 9;

    async function loadCats(page) {
      currentPage = page;
      const container = document.getElementById('catList');
      container.innerHTML = '<div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div>';

      try {
        const data = await MVP.apiGet('/cats/page', { page, size: pageSize });
        if (data.code !== 200) { container.innerHTML = '<div class="empty"><p>åŠ è½½å¤±è´¥</p></div>'; return; }

        const records = data.data.records || [];
        const total = data.data.total || 0;
        const totalPages = Math.ceil(total / pageSize);

        if (records.length === 0) {
          container.innerHTML = '<div class="empty"><div class="icon">ğŸ±</div><p>æš‚æ— çŒ«å’ªæ•°æ®</p></div>';
          return;
        }

        container.innerHTML = records.map(cat => `
          <div class="item-card" onclick="window.location.href='/mvp/cloud-adoption-detail.html?catId=${cat.id}'">
            <img class="cover" src="${MVP.catImg(cat.coverImage)}" alt="${cat.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 200 150%22><rect fill=%22%23edf2f7%22 width=%22200%22 height=%22150%22/><text x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23a0aec0%22 font-size=%2240%22>ğŸ±</text></svg>'" />
            <div class="info">
              <h3>${cat.name}</h3>
              <div class="meta">
                <span>å“ç§: ${cat.breed || 'æœªçŸ¥'}</span>
                <span>æ€§åˆ«: ${cat.gender === 1 ? 'å…¬' : cat.gender === 2 ? 'æ¯' : 'æœªçŸ¥'}</span>
              </div>
              <div class="meta" style="margin-top:6px;">
                <span>çŠ¶æ€: <span class="badge badge-active">${cat.statusText || cat.status || 'æ­£å¸¸'}</span></span>
              </div>
              <div style="margin-top:10px;">
                <button class="btn btn-primary btn-sm" onclick="event.stopPropagation();window.location.href='/mvp/cloud-adoption-order.html?catId=${cat.id}&catName=${encodeURIComponent(cat.name)}'">å‘èµ·äº‘å…»</button>
              </div>
            </div>
          </div>
        `).join('');

        // Pagination
        const pagDiv = document.getElementById('pagination');
        pagDiv.innerHTML = '';
        if (totalPages > 1) {
          pagDiv.appendChild(MVP.renderPagination(currentPage, totalPages, loadCats));
        }
      } catch (err) {
        container.innerHTML = `<div class="empty"><p>åŠ è½½å¤±è´¥: ${err.message}</p></div>`;
      }
    }

    async function loadStats() {
      try {
        if (MVP.isLoggedIn()) {
          const stats = await MVP.apiGet('/cloud-adoption/stats');
          if (stats.code === 200 && stats.data) {
            document.getElementById('statActive').textContent = stats.data.activeCount || 0;
            document.getElementById('statAmount').textContent = 'Â¥' + MVP.fmtMoney(stats.data.totalAmount);
          }
        }
        const cats = await MVP.apiGet('/cats/page', { page: 1, size: 1 });
        if (cats.code === 200) {
          document.getElementById('statTotal').textContent = cats.data.total || 0;
        }
      } catch (e) { /* ignore */ }
    }

    loadCats(1);
    loadStats();
  </script>
</body>
</html>
