import{u as Q}from"./index-DsNOaJLU.js";/* empty css                   *//* empty css                         *//* empty css                *//* empty css                        *//* empty css                   *//* empty css               */import{r as O,aB as F,c as K,j as Z,z as d,B as a,R as l,K as q,I as c,L as u,J as n,aA as X,A as o,O as _,u as p,P as r,Q as w,a6 as I}from"./vue-vendor-L7KxampG.js";import{e as ee,v as te,E as g,O as se,k as ae,P as ne,m as le,Z as oe,ad as ie,a as re,w as ce,ac as ue,Q as de,B as me,p as _e,ah as ve,ai as pe,g as fe,_ as P}from"./element-plus-o-j_G_-z.js";import{a as ge,u as ye,d as he}from"./rescue-asa8I2FB.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCXpdI6d.js";const ke={class:"detail-page"},Me={class:"container-small"},we={key:0},Ie={class:"status-bar"},Te={class:"rescue-title"},De={class:"rescue-meta"},Se={class:"meta-item"},xe={class:"meta-item"},Ne={class:"rescue-description"},Re={key:0,class:"rescue-images"},Be={class:"images-grid"},Ce={class:"rescue-contact"},Oe={class:"contact-items"},Pe={class:"contact-item"},Ge={class:"contact-info"},ze={class:"contact-value"},Le={key:0,class:"contact-item"},be={class:"contact-info"},Ue={class:"contact-value"},$e={class:"rescue-actions"},He={class:"update-content"},Ve={class:"update-text"},We={key:0,class:"update-images"},Ye={__name:"detail",setup(Ae){const G=F(),M=X(),z=Q(),y=O(!1),h=G.params.id,t=O(null),E=K(()=>{var s,e;return z.userInfo.id===((e=(s=t.value)==null?void 0:s.author)==null?void 0:e.id)}),T=async()=>{y.value=!0;try{const s=await ge(h);if(s.code===200&&(t.value=s.data,t.value.images&&typeof t.value.images=="string"))try{t.value.images=JSON.parse(t.value.images)}catch{t.value.images=[]}}catch{g.error("加载救助详情失败")}finally{y.value=!1}},D=s=>({PENDING:"待救助",IN_PROGRESS:"救助中",COMPLETED:"已完成"})[s]||s,L=s=>({PENDING:"danger",IN_PROGRESS:"warning",COMPLETED:"success"})[s]||"info",b=s=>({LOW:"一般",MEDIUM:"紧急",HIGH:"非常紧急"})[s]||s,U=s=>({LOW:"info",MEDIUM:"warning",HIGH:"danger"})[s]||"info",S=s=>s?fe(s).format("YYYY-MM-DD HH:mm"):"-",$=()=>{var s,e;(e=(s=t.value)==null?void 0:s.author)!=null&&e.id&&M.push(`/user/${t.value.author.id}`)},x=async s=>{try{const e=D(s);await P.confirm(`确定要将救助状态更新为"${e}"吗？`,"更新状态",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),(await ye(h,{status:s})).code===200&&(g.success("状态更新成功"),T())}catch(e){e!=="cancel"&&g.error(e.message||"状态更新失败")}},H=()=>{M.push(`/rescue/edit/${h}`)},V=async()=>{try{await P.confirm("确定要删除这条救助信息吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),(await he(h)).code===200&&(g.success("删除成功"),M.push("/rescue"))}catch(s){s!=="cancel"&&g.error(s.message||"删除失败")}};return Z(()=>{T()}),(s,e)=>{const m=ae,f=ee,N=le,W=re,Y=ue,R=de,B=se,A=pe,j=ve,J=te;return o(),d("div",ke,[a("div",Me,[l(f,{class:"back-btn",onClick:e[0]||(e[0]=i=>s.$router.back())},{default:n(()=>[l(m,null,{default:n(()=>[l(p(ne))]),_:1}),e[3]||(e[3]=_(" 返回 ",-1))]),_:1}),q((o(),c(B,{class:"detail-card"},{default:n(()=>{var i,k;return[!y.value&&t.value?(o(),d("div",we,[a("div",Ie,[l(N,{type:L(t.value.status),size:"large"},{default:n(()=>[_(r(D(t.value.status)),1)]),_:1},8,["type"]),l(N,{type:U(t.value.urgency),size:"large"},{default:n(()=>[_(r(b(t.value.urgency)),1)]),_:1},8,["type"])]),a("h1",Te,r(t.value.title),1),a("div",De,[a("div",Se,[l(m,null,{default:n(()=>[l(p(oe))]),_:1}),a("span",null,r(t.value.location),1)]),a("div",xe,[l(m,null,{default:n(()=>[l(p(ie))]),_:1}),a("span",null,r(S(t.value.createTime)),1)]),a("div",{class:"meta-item",onClick:$,style:{cursor:"pointer"}},[l(W,{size:24,src:(i=t.value.author)==null?void 0:i.avatar},{default:n(()=>[l(m,null,{default:n(()=>[l(p(ce))]),_:1})]),_:1},8,["src"]),a("span",null,r((k=t.value.author)==null?void 0:k.username),1)])]),l(Y),a("div",Ne,[e[4]||(e[4]=a("h3",null,"详细情况",-1)),a("p",null,r(t.value.description),1)]),t.value.images&&t.value.images.length>0?(o(),d("div",Re,[e[5]||(e[5]=a("h3",null,"现场照片",-1)),a("div",Be,[(o(!0),d(w,null,I(t.value.images,(v,C)=>(o(),c(R,{key:C,src:v,"preview-src-list":t.value.images,"initial-index":C,fit:"cover",class:"image-item"},null,8,["src","preview-src-list","initial-index"]))),128))])])):u("",!0),a("div",Ce,[e[8]||(e[8]=a("h3",null,"联系方式",-1)),a("div",Oe,[a("div",Pe,[l(m,null,{default:n(()=>[l(p(me))]),_:1}),a("div",Ge,[e[6]||(e[6]=a("div",{class:"contact-label"},"联系电话",-1)),a("div",ze,r(t.value.contactPhone),1)])]),t.value.contactWechat?(o(),d("div",Le,[l(m,null,{default:n(()=>[l(p(_e))]),_:1}),a("div",be,[e[7]||(e[7]=a("div",{class:"contact-label"},"微信号",-1)),a("div",Ue,r(t.value.contactWechat),1)])])):u("",!0)])]),a("div",$e,[E.value&&t.value.status==="PENDING"?(o(),c(f,{key:0,type:"warning",size:"large",onClick:e[1]||(e[1]=v=>x("IN_PROGRESS"))},{default:n(()=>[...e[9]||(e[9]=[_(" 标记为救助中 ",-1)])]),_:1})):u("",!0),E.value&&t.value.status==="IN_PROGRESS"?(o(),c(f,{key:1,type:"success",size:"large",onClick:e[2]||(e[2]=v=>x("COMPLETED"))},{default:n(()=>[...e[10]||(e[10]=[_(" 标记为已完成 ",-1)])]),_:1})):u("",!0),E.value?(o(),c(f,{key:2,type:"primary",plain:"",size:"large",onClick:H},{default:n(()=>[...e[11]||(e[11]=[_(" 编辑信息 ",-1)])]),_:1})):u("",!0),E.value?(o(),c(f,{key:3,type:"danger",plain:"",size:"large",onClick:V},{default:n(()=>[...e[12]||(e[12]=[_(" 删除信息 ",-1)])]),_:1})):u("",!0)])])):u("",!0)]}),_:1})),[[J,y.value]]),t.value&&t.value.updates&&t.value.updates.length>0?(o(),c(B,{key:0,class:"updates-card"},{header:n(()=>[...e[13]||(e[13]=[a("h3",null,"救助进展",-1)])]),default:n(()=>[l(j,null,{default:n(()=>[(o(!0),d(w,null,I(t.value.updates,i=>(o(),c(A,{key:i.id,timestamp:S(i.createTime),placement:"top"},{default:n(()=>[a("div",He,[a("div",Ve,r(i.content),1),i.images&&i.images.length>0?(o(),d("div",We,[(o(!0),d(w,null,I(i.images,(k,v)=>(o(),c(R,{key:v,src:k,"preview-src-list":i.images,"initial-index":v,fit:"cover",class:"update-image"},null,8,["src","preview-src-list","initial-index"]))),128))])):u("",!0)])]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):u("",!0)])])}}},nt=Ee(Ye,[["__scopeId","data-v-94d9d1a0"]]);export{nt as default};
