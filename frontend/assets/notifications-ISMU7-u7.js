import"./index-DnjN8ieL.js";/* empty css                   *//* empty css                   *//* empty css                             *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                *//* empty css                     *//* empty css                       */import{g as Q,e as X,s as Z}from"./notification-DroLapJk.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{O as te,$ as le,E as y,q as ae,r as oe,u as re,I as ne,J as ue,D as ie,af as se,e as pe,aD as de,aE as me,m as ve,v as ge,F as fe,T as ye,U as _e}from"./element-plus-o-j_G_-z.js";import{r as p,j as ce,z as Ee,R as e,J as l,A as _,I,L as x,O as n,B as T,K as be,P as d}from"./vue-vendor-L7KxampG.js";import"./utils-CCXpdI6d.js";const Ie={class:"notification-manage"},Te={class:"card-header"},Ne={class:"header-actions"},Ve={__name:"notifications",setup(we){const N=p(!1),V=p(!1),U=p([]),w=p(""),R=p(1),C=p(10),L=p(0),f=p(null),a=p({title:"",content:"",type:"SYSTEM",priority:"MEDIUM",targetType:"ALL",targetRole:"",userIdsText:""}),z={title:[{required:!0,message:"请输入通知标题",trigger:"blur"}],content:[{required:!0,message:"请输入通知内容",trigger:"blur"}],type:[{required:!0,message:"请选择通知类型",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],targetType:[{required:!0,message:"请选择接收对象",trigger:"change"}]},M=p(!1),i=p(null),O=r=>({SYSTEM:"系统通知",ANNOUNCEMENT:"公告",REMINDER:"提醒",WARNING:"警告"})[r]||r,A=r=>({SYSTEM:"primary",ANNOUNCEMENT:"success",REMINDER:"warning",WARNING:"danger"})[r]||"info",F=r=>({LOW:"低",MEDIUM:"中",HIGH:"高"})[r]||r,k=r=>({LOW:"info",MEDIUM:"warning",HIGH:"danger"})[r]||"info",G=()=>{a.value.targetRole="",a.value.userIdsText=""},W=async()=>{f.value&&await f.value.validate(async r=>{if(r){if(a.value.targetType==="SPECIFIC"&&!a.value.userIdsText){y.warning("请输入用户ID");return}V.value=!0;try{const t={title:a.value.title,content:a.value.content,type:a.value.type,priority:a.value.priority};if(a.value.targetType==="SPECIFIC"){const g=a.value.userIdsText.split(",").map(s=>parseInt(s.trim())).filter(s=>!isNaN(s));if(g.length===0){y.warning("请输入有效的用户ID");return}await X(g,t)}else a.value.targetType==="ROLE"&&(t.targetRole=a.value.targetRole),await Z(t);y.success("发送成功"),h(),c()}catch{y.error("发送失败")}finally{V.value=!1}}})},h=()=>{a.value={title:"",content:"",type:"SYSTEM",priority:"MEDIUM",targetType:"ALL",targetRole:"",userIdsText:""},f.value&&f.value.resetFields()},c=async()=>{N.value=!0;try{const r=await Q({pageNum:R.value,pageSize:C.value,type:w.value});r.code===200&&(U.value=r.data.records||[],L.value=r.data.total||0)}catch{y.error("加载数据失败")}finally{N.value=!1}},q=r=>{i.value=r,M.value=!0};return ce(()=>{c()}),(r,t)=>{const g=re,s=oe,u=ue,E=ne,D=se,B=ie,S=pe,H=ae,P=te,m=me,b=ve,Y=de,j=fe,v=_e,J=ye,$=le,K=ge;return _(),Ee("div",Ie,[e(P,{style:{"margin-bottom":"20px"}},{header:l(()=>[...t[11]||(t[11]=[T("span",null,"发送系统通知",-1)])]),default:l(()=>[e(H,{model:a.value,rules:z,ref_key:"sendFormRef",ref:f,"label-width":"100px"},{default:l(()=>[e(s,{label:"通知标题",prop:"title"},{default:l(()=>[e(g,{modelValue:a.value.title,"onUpdate:modelValue":t[0]||(t[0]=o=>a.value.title=o),placeholder:"请输入通知标题"},null,8,["modelValue"])]),_:1}),e(s,{label:"通知内容",prop:"content"},{default:l(()=>[e(g,{modelValue:a.value.content,"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.content=o),type:"textarea",rows:5,placeholder:"请输入通知内容"},null,8,["modelValue"])]),_:1}),e(s,{label:"通知类型",prop:"type"},{default:l(()=>[e(E,{modelValue:a.value.type,"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.type=o),placeholder:"请选择通知类型",style:{width:"100%"}},{default:l(()=>[e(u,{label:"系统通知",value:"SYSTEM"}),e(u,{label:"公告",value:"ANNOUNCEMENT"}),e(u,{label:"提醒",value:"REMINDER"}),e(u,{label:"警告",value:"WARNING"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"优先级",prop:"priority"},{default:l(()=>[e(E,{modelValue:a.value.priority,"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.priority=o),placeholder:"请选择优先级",style:{width:"100%"}},{default:l(()=>[e(u,{label:"低",value:"LOW"}),e(u,{label:"中",value:"MEDIUM"}),e(u,{label:"高",value:"HIGH"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"接收对象",prop:"targetType"},{default:l(()=>[e(B,{modelValue:a.value.targetType,"onUpdate:modelValue":t[4]||(t[4]=o=>a.value.targetType=o),onChange:G},{default:l(()=>[e(D,{label:"ALL"},{default:l(()=>[...t[12]||(t[12]=[n("全体用户",-1)])]),_:1}),e(D,{label:"ROLE"},{default:l(()=>[...t[13]||(t[13]=[n("按角色",-1)])]),_:1}),e(D,{label:"SPECIFIC"},{default:l(()=>[...t[14]||(t[14]=[n("指定用户",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.value.targetType==="ROLE"?(_(),I(s,{key:0,label:"用户角色",prop:"targetRole"},{default:l(()=>[e(E,{modelValue:a.value.targetRole,"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.targetRole=o),placeholder:"请选择用户角色",style:{width:"100%"}},{default:l(()=>[e(u,{label:"普通用户",value:"USER"}),e(u,{label:"志愿者",value:"VOLUNTEER"}),e(u,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue"])]),_:1})):x("",!0),a.value.targetType==="SPECIFIC"?(_(),I(s,{key:1,label:"用户ID",prop:"userIds"},{default:l(()=>[e(g,{modelValue:a.value.userIdsText,"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.userIdsText=o),type:"textarea",rows:3,placeholder:"请输入用户ID，多个ID用逗号分隔，例如：1,2,3"},null,8,["modelValue"])]),_:1})):x("",!0),e(s,null,{default:l(()=>[e(S,{type:"primary",onClick:W,loading:V.value},{default:l(()=>[...t[15]||(t[15]=[n(" 发送通知 ",-1)])]),_:1},8,["loading"]),e(S,{onClick:h},{default:l(()=>[...t[16]||(t[16]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(P,null,{header:l(()=>[T("div",Te,[t[17]||(t[17]=T("span",null,"通知历史",-1)),T("div",Ne,[e(E,{modelValue:w.value,"onUpdate:modelValue":t[7]||(t[7]=o=>w.value=o),placeholder:"类型筛选",style:{width:"150px"},clearable:"",onChange:c},{default:l(()=>[e(u,{label:"系统通知",value:"SYSTEM"}),e(u,{label:"公告",value:"ANNOUNCEMENT"}),e(u,{label:"提醒",value:"REMINDER"}),e(u,{label:"警告",value:"WARNING"})]),_:1},8,["modelValue"])])])]),default:l(()=>[be((_(),I(Y,{data:U.value,style:{width:"100%"}},{default:l(()=>[e(m,{prop:"id",label:"ID",width:"60"}),e(m,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),e(m,{prop:"type",label:"类型",width:"100"},{default:l(({row:o})=>[e(b,{type:A(o.type)},{default:l(()=>[n(d(O(o.type)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"priority",label:"优先级",width:"80"},{default:l(({row:o})=>[e(b,{type:k(o.priority),size:"small"},{default:l(()=>[n(d(F(o.priority)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"content",label:"内容","min-width":"250","show-overflow-tooltip":""}),e(m,{prop:"recipientCount",label:"接收人数",width:"100"}),e(m,{prop:"readCount",label:"已读人数",width:"100"}),e(m,{prop:"createTime",label:"发送时间",width:"160"}),e(m,{label:"操作",fixed:"right",width:"100"},{default:l(({row:o})=>[e(S,{type:"primary",link:"",size:"small",onClick:Re=>q(o)},{default:l(()=>[...t[18]||(t[18]=[n(" 查看 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,N.value]]),e(j,{"current-page":R.value,"onUpdate:currentPage":t[8]||(t[8]=o=>R.value=o),"page-size":C.value,"onUpdate:pageSize":t[9]||(t[9]=o=>C.value=o),total:L.value,layout:"total, prev, pager, next",style:{"margin-top":"20px","justify-content":"flex-end"},onCurrentChange:c},null,8,["current-page","page-size","total"])]),_:1}),e($,{modelValue:M.value,"onUpdate:modelValue":t[10]||(t[10]=o=>M.value=o),title:"通知详情",width:"600px"},{default:l(()=>[i.value?(_(),I(J,{key:0,column:2,border:""},{default:l(()=>[e(v,{label:"通知ID"},{default:l(()=>[n(d(i.value.id),1)]),_:1}),e(v,{label:"类型"},{default:l(()=>[e(b,{type:A(i.value.type)},{default:l(()=>[n(d(O(i.value.type)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"标题",span:2},{default:l(()=>[n(d(i.value.title),1)]),_:1}),e(v,{label:"内容",span:2},{default:l(()=>[n(d(i.value.content),1)]),_:1}),e(v,{label:"优先级"},{default:l(()=>[e(b,{type:k(i.value.priority)},{default:l(()=>[n(d(F(i.value.priority)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"发送时间"},{default:l(()=>[n(d(i.value.createTime),1)]),_:1}),e(v,{label:"接收人数"},{default:l(()=>[n(d(i.value.recipientCount),1)]),_:1}),e(v,{label:"已读人数"},{default:l(()=>[n(d(i.value.readCount),1)]),_:1})]),_:1})):x("",!0)]),_:1},8,["modelValue"])])}}},Ye=ee(Ve,[["__scopeId","data-v-10a4d280"]]);export{Ye as default};
