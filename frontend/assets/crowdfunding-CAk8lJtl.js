import{s as T}from"./index-DsNOaJLU.js";/* empty css                   *//* empty css                     *//* empty css                   *//* empty css                         *//* empty css                             *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                    */import{r as i,j as ae,z as M,R as t,J as a,A as c,K as le,I as b,O as s,P as r,L as w,B as V,a4 as oe,u as ne,Q as se,a6 as re}from"./vue-vendor-L7KxampG.js";import{O as ue,$ as ie,E as g,aD as de,aE as pe,aC as me,m as ce,e as ge,v as fe,F as _e,u as ve,K as Ee,I as ye,J as be,T as Ce,U as we,ah as Ve,ai as Te,q as Ae,r as ke,_ as De}from"./element-plus-o-j_G_-z.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCXpdI6d.js";function xe(p){return T.get("/api/crowdfunding/page",{params:p})}function Ie(p){return T.get(`/api/crowdfunding/${p}`)}function Pe(p){return T.put(`/api/crowdfunding/${p}/cancel`)}function Me(p,v){return T.put(`/api/crowdfunding/${p}/progress`,null,{params:{updateMessage:v}})}const Le={class:"crowdfunding-manage"},Ue={class:"card-header"},Ne={class:"header-actions"},ze={key:1,style:{"margin-top":"20px"}},Fe={__name:"crowdfunding",setup(p){const v=i(!1),A=i(!1),L=i([]),k=i(""),D=i(""),h=i(1),x=i(10),U=i(0),I=i(!1),E=i(!1),n=i(null),f=i({updateMessage:""}),N=o=>({DRAFT:"草稿",ACTIVE:"进行中",COMPLETED:"已完成",CANCELLED:"已取消",EXPIRED:"已过期"})[o]||o,z=o=>({DRAFT:"info",ACTIVE:"success",COMPLETED:"primary",CANCELLED:"danger",EXPIRED:"warning"})[o]||"info",P=o=>{if(!o.targetAmount||o.targetAmount===0)return 0;const e=o.currentAmount/o.targetAmount*100;return Math.min(Math.round(e),100)},R=o=>{const e=P(o);return e>=100?"#67c23a":e>=80?"#409eff":e>=50?"#e6a23c":"#f56c6c"},m=async()=>{v.value=!0;try{const o=await xe({page:h.value,pageSize:x.value,keyword:k.value,status:D.value});o.code===200&&(L.value=o.data.records||[],U.value=o.data.total||0)}catch{g.error("加载数据失败")}finally{v.value=!1}},S=async o=>{try{const e=await Ie(o.id);e.code===200&&(n.value=e.data,I.value=!0)}catch{g.error("加载详情失败")}},O=o=>{n.value=o,f.value.updateMessage="",E.value=!0},K=async()=>{if(!f.value.updateMessage){g.warning("请输入进展更新内容");return}A.value=!0;try{await Me(n.value.id,f.value.updateMessage),g.success("更新成功"),E.value=!1,m()}catch{g.error("更新失败")}finally{A.value=!1}},X=async o=>{try{await De.confirm(`确定要取消众筹项目 "${o.title}" 吗？`,"警告",{type:"warning"}),await Pe(o.id),g.success("取消成功"),m()}catch(e){e!=="cancel"&&g.error("取消失败")}};return ae(()=>{m()}),(o,e)=>{const _=ge,F=ve,y=be,j=ye,d=pe,J=me,$=ce,q=de,Q=_e,G=ue,u=we,H=Ce,W=Te,Y=Ve,B=ie,Z=ke,ee=Ae,te=fe;return c(),M("div",Le,[t(G,null,{header:a(()=>[V("div",Ue,[e[8]||(e[8]=V("span",null,"众筹管理",-1)),V("div",Ne,[t(F,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=l=>k.value=l),placeholder:"搜索项目标题",style:{width:"200px"},clearable:"",onClear:m,onKeyup:oe(m,["enter"])},{append:a(()=>[t(_,{icon:ne(Ee),onClick:m},null,8,["icon"])]),_:1},8,["modelValue"]),t(j,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=l=>D.value=l),placeholder:"状态筛选",style:{width:"150px","margin-left":"10px"},clearable:"",onChange:m},{default:a(()=>[t(y,{label:"草稿",value:"DRAFT"}),t(y,{label:"进行中",value:"ACTIVE"}),t(y,{label:"已完成",value:"COMPLETED"}),t(y,{label:"已取消",value:"CANCELLED"}),t(y,{label:"已过期",value:"EXPIRED"})]),_:1},8,["modelValue"])])])]),default:a(()=>[le((c(),b(q,{data:L.value,style:{width:"100%"}},{default:a(()=>[t(d,{prop:"id",label:"ID",width:"60"}),t(d,{prop:"title",label:"项目标题","min-width":"200","show-overflow-tooltip":""}),t(d,{prop:"catName",label:"猫咪",width:"120"}),t(d,{prop:"creatorName",label:"发起人",width:"120"}),t(d,{prop:"targetAmount",label:"目标金额",width:"100"},{default:a(({row:l})=>[s(" ¥"+r(l.targetAmount),1)]),_:1}),t(d,{prop:"currentAmount",label:"已筹金额",width:"100"},{default:a(({row:l})=>[s(" ¥"+r(l.currentAmount),1)]),_:1}),t(d,{label:"进度",width:"120"},{default:a(({row:l})=>[t(J,{percentage:P(l),color:R(l)},null,8,["percentage","color"])]),_:1}),t(d,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t($,{type:z(l.status)},{default:a(()=>[s(r(N(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"endTime",label:"结束时间",width:"160"}),t(d,{label:"操作",fixed:"right",width:"180"},{default:a(({row:l})=>[t(_,{type:"primary",link:"",size:"small",onClick:C=>S(l)},{default:a(()=>[...e[9]||(e[9]=[s(" 查看 ",-1)])]),_:1},8,["onClick"]),l.status==="ACTIVE"?(c(),b(_,{key:0,type:"warning",link:"",size:"small",onClick:C=>O(l)},{default:a(()=>[...e[10]||(e[10]=[s(" 更新进展 ",-1)])]),_:1},8,["onClick"])):w("",!0),l.status==="ACTIVE"?(c(),b(_,{key:1,type:"danger",link:"",size:"small",onClick:C=>X(l)},{default:a(()=>[...e[11]||(e[11]=[s(" 取消 ",-1)])]),_:1},8,["onClick"])):w("",!0)]),_:1})]),_:1},8,["data"])),[[te,v.value]]),t(Q,{"current-page":h.value,"onUpdate:currentPage":e[2]||(e[2]=l=>h.value=l),"page-size":x.value,"onUpdate:pageSize":e[3]||(e[3]=l=>x.value=l),total:U.value,layout:"total, prev, pager, next",style:{"margin-top":"20px","justify-content":"flex-end"},onCurrentChange:m},null,8,["current-page","page-size","total"])]),_:1}),t(B,{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=l=>I.value=l),title:"众筹项目详情",width:"800px"},{default:a(()=>[n.value?(c(),b(H,{key:0,column:2,border:""},{default:a(()=>[t(u,{label:"项目ID"},{default:a(()=>[s(r(n.value.id),1)]),_:1}),t(u,{label:"状态"},{default:a(()=>[t($,{type:z(n.value.status)},{default:a(()=>[s(r(N(n.value.status)),1)]),_:1},8,["type"])]),_:1}),t(u,{label:"项目标题",span:2},{default:a(()=>[s(r(n.value.title),1)]),_:1}),t(u,{label:"猫咪"},{default:a(()=>[s(r(n.value.catName),1)]),_:1}),t(u,{label:"发起人"},{default:a(()=>[s(r(n.value.creatorName),1)]),_:1}),t(u,{label:"目标金额"},{default:a(()=>[s(" ¥"+r(n.value.targetAmount),1)]),_:1}),t(u,{label:"已筹金额"},{default:a(()=>[s(" ¥"+r(n.value.currentAmount),1)]),_:1}),t(u,{label:"捐款人数"},{default:a(()=>[s(r(n.value.donorCount||0)+"人 ",1)]),_:1}),t(u,{label:"完成进度"},{default:a(()=>[s(r(P(n.value))+"% ",1)]),_:1}),t(u,{label:"开始时间"},{default:a(()=>[s(r(n.value.startTime),1)]),_:1}),t(u,{label:"结束时间"},{default:a(()=>[s(r(n.value.endTime),1)]),_:1}),t(u,{label:"项目描述",span:2},{default:a(()=>[s(r(n.value.description),1)]),_:1})]),_:1})):w("",!0),n.value&&n.value.progressUpdates&&n.value.progressUpdates.length>0?(c(),M("div",ze,[e[12]||(e[12]=V("h4",null,"项目进展",-1)),t(Y,null,{default:a(()=>[(c(!0),M(se,null,re(n.value.progressUpdates,(l,C)=>(c(),b(W,{key:C,timestamp:l.updateTime},{default:a(()=>[s(r(l.message),1)]),_:2},1032,["timestamp"]))),128))]),_:1})])):w("",!0)]),_:1},8,["modelValue"]),t(B,{modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=l=>E.value=l),title:"更新项目进展",width:"500px"},{footer:a(()=>[t(_,{onClick:e[6]||(e[6]=l=>E.value=!1)},{default:a(()=>[...e[13]||(e[13]=[s("取消",-1)])]),_:1}),t(_,{type:"primary",onClick:K,loading:A.value},{default:a(()=>[...e[14]||(e[14]=[s(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(ee,{model:f.value,"label-width":"100px"},{default:a(()=>[t(Z,{label:"进展更新"},{default:a(()=>[t(F,{modelValue:f.value.updateMessage,"onUpdate:modelValue":e[5]||(e[5]=l=>f.value.updateMessage=l),type:"textarea",rows:5,placeholder:"请输入项目进展更新内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},lt=he(Fe,[["__scopeId","data-v-6ba14cc3"]]);export{lt as default};
