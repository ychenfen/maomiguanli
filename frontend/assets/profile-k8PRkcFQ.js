import{u as fe,g as ve,a as _e,b as ge,c as j,d as we,e as ye}from"./index-C7QMbvNI.js";/* empty css                   *//* empty css                   *//* empty css                  *//* empty css                    *//* empty css               *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                 *//* empty css                     *//* empty css                *//* empty css                   */import{r as m,l as T,j as be,z as f,B as o,R as a,J as s,aA as Ve,A as n,K as q,I,u as g,L as V,P as v,O as C,Q as Pe,a6 as he}from"./vue-vendor-L7KxampG.js";import{G as Ee,$ as Ue,E as p,N as ke,O as Ie,a as Ce,k as Ne,w as Re,e as xe,aj as ze,m as Me,ac as Se,ak as Te,B as $e,C as De,ad as Fe,v as Ae,al as Be,am as Le,q as Oe,r as je,u as qe,H as Ye,F as He,a9 as Ge,aa as Je,g as Ke}from"./element-plus-o-j_G_-z.js";import{C as Qe}from"./index-cLv6ztlq.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCXpdI6d.js";/* empty css                        */import"./cat-DwVSNbqL.js";const Xe={class:"profile-page"},Ze={class:"container"},ea={class:"profile-header"},aa={class:"profile-info"},la={key:0,class:"real-name"},sa={class:"profile-details"},ta={key:0,class:"detail-item"},oa={key:1,class:"detail-item"},ra={key:2,class:"detail-item"},na={class:"detail-item"},da={class:"profile-stats"},ua={class:"stat-number"},ia={class:"stat-number"},ma={class:"stat-number"},pa={class:"favorites-list"},ca={key:1,class:"cats-grid"},fa={key:2,class:"pagination-wrapper"},va=["src"],_a={__name:"profile",setup(ga){const Y=Ve(),N=fe(),R=m(!1),w=m(!1),P=m(!1),$=m("basic"),r=m({}),h=m({}),D=m(null),d=T({username:"",realName:"",studentId:"",phone:"",email:""}),H={realName:[{max:50,message:"真实姓名不能超过50个字符",trigger:"blur"}],studentId:[{max:20,message:"学号/工号不能超过20个字符",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},F=m(null),u=T({oldPassword:"",newPassword:"",confirmPassword:""}),G={oldPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度为6-20位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(l,e,i)=>{e!==u.newPassword?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}]},x=m([]),z=m(0),y=T({page:1,size:12}),b=m(!1),E=m(""),J="/api/file/upload",K={Authorization:`Bearer ${ve()}`},M=async()=>{R.value=!0;try{const l=await _e();l.code===200&&(r.value=l.data,Object.assign(d,{username:l.data.username,realName:l.data.realName||"",studentId:l.data.studentId||"",phone:l.data.phone||"",email:l.data.email||""}))}catch{p.error("加载用户信息失败")}finally{R.value=!1}},Q=async()=>{try{const l=await ge();l.code===200&&(h.value=l.data)}catch(l){console.error("加载用户统计失败",l)}},W=async()=>{if(await D.value.validate().catch(()=>!1)){w.value=!0;try{(await j(d)).code===200&&(p.success("保存成功"),await N.getUserInfo(),await M())}catch(e){p.error(e.message||"保存失败")}finally{w.value=!1}}},X=async()=>{if(await F.value.validate().catch(()=>!1)){w.value=!0;try{(await we({oldPassword:u.oldPassword,newPassword:u.newPassword})).code===200&&(p.success("密码修改成功，请重新登录"),u.oldPassword="",u.newPassword="",u.confirmPassword="",setTimeout(()=>{N.logout(),Y.push("/login")},1500))}catch(e){p.error(e.message||"修改密码失败")}finally{w.value=!1}}},Z=async()=>{P.value=!0;try{const l=await ye({page:y.page,size:y.size});l.code===200&&(x.value=l.data.records||[],z.value=l.data.total||0)}catch{p.error("加载收藏列表失败")}finally{P.value=!1}},ee=()=>{E.value=r.value.avatar||"",b.value=!0},ae=l=>{const e=l.type.startsWith("image/"),i=l.size/1024/1024<2;return e?i?!0:(p.error("图片大小不能超过 2MB"),!1):(p.error("只能上传图片文件"),!1)},le=async l=>{if(l.code===200){E.value=l.data.url;try{(await j({avatar:l.data.url})).code===200&&(p.success("头像更新成功"),b.value=!1,await N.getUserInfo(),await M())}catch{p.error("更新头像失败")}}else p.error("上传失败")},se=l=>({USER:"普通用户",VOLUNTEER:"志愿者",ADMIN:"管理员",SUPER_ADMIN:"超级管理员"})[l]||l,te=l=>({USER:"info",VOLUNTEER:"success",ADMIN:"warning",SUPER_ADMIN:"danger"})[l]||"info",oe=l=>l?Ke(l).format("YYYY-MM-DD"):"-";return be(()=>{M(),Q()}),(l,e)=>{const i=Ne,re=Ce,U=xe,ne=Me,A=Se,k=Ie,B=ke,_=qe,c=je,L=Oe,S=Le,de=Ye,ue=He,ie=Be,me=Ee,pe=Ge,ce=Ue,O=Ae;return n(),f("div",Xe,[o("div",Ze,[a(me,{gutter:24},{default:s(()=>[a(B,{xs:24,md:8},{default:s(()=>[q((n(),I(k,{class:"profile-card"},{default:s(()=>[o("div",ea,[a(re,{size:100,src:r.value.avatar},{default:s(()=>[a(i,{size:50},{default:s(()=>[a(g(Re))]),_:1})]),_:1},8,["src"]),a(U,{class:"upload-btn",circle:"",size:"small",onClick:ee},{default:s(()=>[a(i,null,{default:s(()=>[a(g(ze))]),_:1})]),_:1})]),o("div",aa,[o("h2",null,v(r.value.username),1),r.value.realName?(n(),f("p",la,v(r.value.realName),1)):V("",!0),a(ne,{type:te(r.value.role),size:"small"},{default:s(()=>[C(v(se(r.value.role)),1)]),_:1},8,["type"])]),a(A),o("div",sa,[r.value.studentId?(n(),f("div",ta,[a(i,null,{default:s(()=>[a(g(Te))]),_:1}),o("span",null,v(r.value.studentId),1)])):V("",!0),r.value.phone?(n(),f("div",oa,[a(i,null,{default:s(()=>[a(g($e))]),_:1}),o("span",null,v(r.value.phone),1)])):V("",!0),r.value.email?(n(),f("div",ra,[a(i,null,{default:s(()=>[a(g(De))]),_:1}),o("span",null,v(r.value.email),1)])):V("",!0),o("div",na,[a(i,null,{default:s(()=>[a(g(Fe))]),_:1}),o("span",null,"加入于 "+v(oe(r.value.createTime)),1)])]),a(A),o("div",da,[o("div",{class:"stat-item",onClick:e[0]||(e[0]=t=>l.$router.push("/adoption/my"))},[o("div",ua,v(h.value.applications||0),1),e[16]||(e[16]=o("div",{class:"stat-label"},"领养申请",-1))]),o("div",{class:"stat-item",onClick:e[1]||(e[1]=t=>l.$router.push("/community?author="+r.value.id))},[o("div",ia,v(h.value.dynamics||0),1),e[17]||(e[17]=o("div",{class:"stat-label"},"发布动态",-1))]),o("div",{class:"stat-item",onClick:e[2]||(e[2]=t=>l.$router.push("/rescue?author="+r.value.id))},[o("div",ma,v(h.value.rescues||0),1),e[18]||(e[18]=o("div",{class:"stat-label"},"救助信息",-1))])])]),_:1})),[[O,R.value]])]),_:1}),a(B,{xs:24,md:16},{default:s(()=>[a(ie,{modelValue:$.value,"onUpdate:modelValue":e[13]||(e[13]=t=>$.value=t),class:"profile-tabs"},{default:s(()=>[a(S,{label:"基本信息",name:"basic"},{default:s(()=>[a(k,null,{default:s(()=>[a(L,{ref_key:"basicFormRef",ref:D,model:d,rules:H,"label-width":"100px"},{default:s(()=>[a(c,{label:"用户名",prop:"username"},{default:s(()=>[a(_,{modelValue:d.username,"onUpdate:modelValue":e[3]||(e[3]=t=>d.username=t),disabled:""},null,8,["modelValue"])]),_:1}),a(c,{label:"真实姓名",prop:"realName"},{default:s(()=>[a(_,{modelValue:d.realName,"onUpdate:modelValue":e[4]||(e[4]=t=>d.realName=t),placeholder:"请输入真实姓名",maxlength:"50"},null,8,["modelValue"])]),_:1}),a(c,{label:"学号/工号",prop:"studentId"},{default:s(()=>[a(_,{modelValue:d.studentId,"onUpdate:modelValue":e[5]||(e[5]=t=>d.studentId=t),placeholder:"请输入学号或工号",maxlength:"20"},null,8,["modelValue"])]),_:1}),a(c,{label:"手机号",prop:"phone"},{default:s(()=>[a(_,{modelValue:d.phone,"onUpdate:modelValue":e[6]||(e[6]=t=>d.phone=t),placeholder:"请输入手机号",maxlength:"20"},null,8,["modelValue"])]),_:1}),a(c,{label:"邮箱",prop:"email"},{default:s(()=>[a(_,{modelValue:d.email,"onUpdate:modelValue":e[7]||(e[7]=t=>d.email=t),placeholder:"请输入邮箱",maxlength:"100"},null,8,["modelValue"])]),_:1}),a(c,null,{default:s(()=>[a(U,{type:"primary",loading:w.value,onClick:W},{default:s(()=>[...e[19]||(e[19]=[C(" 保存修改 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),a(S,{label:"修改密码",name:"password"},{default:s(()=>[a(k,null,{default:s(()=>[a(L,{ref_key:"passwordFormRef",ref:F,model:u,rules:G,"label-width":"100px"},{default:s(()=>[a(c,{label:"旧密码",prop:"oldPassword"},{default:s(()=>[a(_,{modelValue:u.oldPassword,"onUpdate:modelValue":e[8]||(e[8]=t=>u.oldPassword=t),type:"password",placeholder:"请输入旧密码","show-password":""},null,8,["modelValue"])]),_:1}),a(c,{label:"新密码",prop:"newPassword"},{default:s(()=>[a(_,{modelValue:u.newPassword,"onUpdate:modelValue":e[9]||(e[9]=t=>u.newPassword=t),type:"password",placeholder:"请输入新密码（6-20位）","show-password":""},null,8,["modelValue"])]),_:1}),a(c,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[a(_,{modelValue:u.confirmPassword,"onUpdate:modelValue":e[10]||(e[10]=t=>u.confirmPassword=t),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(c,null,{default:s(()=>[a(U,{type:"primary",loading:w.value,onClick:X},{default:s(()=>[...e[20]||(e[20]=[C(" 修改密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),a(S,{label:"我的收藏",name:"favorites"},{default:s(()=>[a(k,null,{default:s(()=>[q((n(),f("div",pa,[!P.value&&x.value.length===0?(n(),I(de,{key:0,description:"暂无收藏"})):(n(),f("div",ca,[(n(!0),f(Pe,null,he(x.value,t=>(n(),I(Qe,{key:t.id,cat:t,onClick:ya=>l.$router.push(`/cats/${t.id}`)},null,8,["cat","onClick"]))),128))])),z.value>0?(n(),f("div",fa,[a(ue,{"current-page":y.page,"onUpdate:currentPage":e[11]||(e[11]=t=>y.page=t),"page-size":y.size,"onUpdate:pageSize":e[12]||(e[12]=t=>y.size=t),total:z.value,layout:"prev, pager, next",onCurrentChange:Z},null,8,["current-page","page-size","total"])])):V("",!0)])),[[O,P.value]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),a(ce,{modelValue:b.value,"onUpdate:modelValue":e[15]||(e[15]=t=>b.value=t),title:"上传头像",width:"400px"},{footer:s(()=>[a(U,{onClick:e[14]||(e[14]=t=>b.value=!1)},{default:s(()=>[...e[21]||(e[21]=[C("取消",-1)])]),_:1})]),default:s(()=>[a(pe,{class:"avatar-uploader",action:J,headers:K,"show-file-list":!1,"on-success":le,"before-upload":ae},{default:s(()=>[E.value?(n(),f("img",{key:0,src:E.value,class:"avatar-preview"},null,8,va)):(n(),I(i,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[a(g(Je))]),_:1}))]),_:1})]),_:1},8,["modelValue"])])}}},La=We(_a,[["__scopeId","data-v-3ac9b417"]]);export{La as default};
