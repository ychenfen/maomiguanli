import{u as F}from"./index-B2-6bV7b.js";/* empty css                   *//* empty css                         *//* empty css                *//* empty css                        *//* empty css                   *//* empty css               */import{r as P,aB as J,c as K,j as Z,z as d,B as s,R as l,K as q,I as c,L as u,J as n,aA as X,A as o,O as m,u as v,P as r,Q as w,a6 as I}from"./vue-vendor-L7KxampG.js";import{e as ee,v as te,E as g,O as se,k as ae,P as ne,m as le,Z as oe,ad as ie,a as re,w as ce,ac as ue,Q as de,B as _e,p as me,ah as pe,ai as ve,g as fe,_ as O}from"./element-plus-o-j_G_-z.js";import{a as ge,u as ye,d as Ee}from"./rescue-BLI-UUW_.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCXpdI6d.js";const ke={class:"detail-page"},Me={class:"container-small"},we={key:0},Ie={class:"status-bar"},Te={class:"rescue-title"},De={class:"rescue-meta"},xe={class:"meta-item"},Re={class:"meta-item"},Se={class:"rescue-description"},Ne={key:0,class:"rescue-images"},Be={class:"images-grid"},Ce={class:"rescue-contact"},Pe={class:"contact-items"},Oe={class:"contact-item"},Ge={class:"contact-info"},ze={class:"contact-value"},Le={key:0,class:"contact-item"},be={class:"contact-info"},Ue={class:"contact-value"},$e={class:"rescue-actions"},He={class:"update-content"},Ve={class:"update-text"},We={key:0,class:"update-images"},Ye={__name:"detail",setup(Ae){const G=J(),M=X(),z=F(),y=P(!1),E=G.params.id,a=P(null),h=K(()=>{var t,e;return z.userInfo.id===((e=(t=a.value)==null?void 0:t.author)==null?void 0:e.id)}),T=async()=>{y.value=!0;try{const t=await ge(E);t.code===200&&(a.value=t.data)}catch{g.error("加载救助详情失败")}finally{y.value=!1}},D=t=>({PENDING:"待救助",IN_PROGRESS:"救助中",COMPLETED:"已完成"})[t]||t,L=t=>({PENDING:"danger",IN_PROGRESS:"warning",COMPLETED:"success"})[t]||"info",b=t=>({LOW:"一般",MEDIUM:"紧急",HIGH:"非常紧急"})[t]||t,U=t=>({LOW:"info",MEDIUM:"warning",HIGH:"danger"})[t]||"info",x=t=>t?fe(t).format("YYYY-MM-DD HH:mm"):"-",$=()=>{var t,e;(e=(t=a.value)==null?void 0:t.author)!=null&&e.id&&M.push(`/user/${a.value.author.id}`)},R=async t=>{try{const e=D(t);await O.confirm(`确定要将救助状态更新为"${e}"吗？`,"更新状态",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),(await ye(E,{status:t})).code===200&&(g.success("状态更新成功"),T())}catch(e){e!=="cancel"&&g.error(e.message||"状态更新失败")}},H=()=>{M.push(`/rescue/edit/${E}`)},V=async()=>{try{await O.confirm("确定要删除这条救助信息吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),(await Ee(E)).code===200&&(g.success("删除成功"),M.push("/rescue"))}catch(t){t!=="cancel"&&g.error(t.message||"删除失败")}};return Z(()=>{T()}),(t,e)=>{const _=ae,f=ee,S=le,W=re,Y=ue,N=de,B=se,A=ve,j=pe,Q=te;return o(),d("div",ke,[s("div",Me,[l(f,{class:"back-btn",onClick:e[0]||(e[0]=i=>t.$router.back())},{default:n(()=>[l(_,null,{default:n(()=>[l(v(ne))]),_:1}),e[3]||(e[3]=m(" 返回 ",-1))]),_:1}),q((o(),c(B,{class:"detail-card"},{default:n(()=>{var i,k;return[!y.value&&a.value?(o(),d("div",we,[s("div",Ie,[l(S,{type:L(a.value.status),size:"large"},{default:n(()=>[m(r(D(a.value.status)),1)]),_:1},8,["type"]),l(S,{type:U(a.value.urgency),size:"large"},{default:n(()=>[m(r(b(a.value.urgency)),1)]),_:1},8,["type"])]),s("h1",Te,r(a.value.title),1),s("div",De,[s("div",xe,[l(_,null,{default:n(()=>[l(v(oe))]),_:1}),s("span",null,r(a.value.location),1)]),s("div",Re,[l(_,null,{default:n(()=>[l(v(ie))]),_:1}),s("span",null,r(x(a.value.createTime)),1)]),s("div",{class:"meta-item",onClick:$,style:{cursor:"pointer"}},[l(W,{size:24,src:(i=a.value.author)==null?void 0:i.avatar},{default:n(()=>[l(_,null,{default:n(()=>[l(v(ce))]),_:1})]),_:1},8,["src"]),s("span",null,r((k=a.value.author)==null?void 0:k.username),1)])]),l(Y),s("div",Se,[e[4]||(e[4]=s("h3",null,"详细情况",-1)),s("p",null,r(a.value.description),1)]),a.value.images&&a.value.images.length>0?(o(),d("div",Ne,[e[5]||(e[5]=s("h3",null,"现场照片",-1)),s("div",Be,[(o(!0),d(w,null,I(a.value.images,(p,C)=>(o(),c(N,{key:C,src:p,"preview-src-list":a.value.images,"initial-index":C,fit:"cover",class:"image-item"},null,8,["src","preview-src-list","initial-index"]))),128))])])):u("",!0),s("div",Ce,[e[8]||(e[8]=s("h3",null,"联系方式",-1)),s("div",Pe,[s("div",Oe,[l(_,null,{default:n(()=>[l(v(_e))]),_:1}),s("div",Ge,[e[6]||(e[6]=s("div",{class:"contact-label"},"联系电话",-1)),s("div",ze,r(a.value.contactPhone),1)])]),a.value.contactWechat?(o(),d("div",Le,[l(_,null,{default:n(()=>[l(v(me))]),_:1}),s("div",be,[e[7]||(e[7]=s("div",{class:"contact-label"},"微信号",-1)),s("div",Ue,r(a.value.contactWechat),1)])])):u("",!0)])]),s("div",$e,[h.value&&a.value.status==="PENDING"?(o(),c(f,{key:0,type:"warning",size:"large",onClick:e[1]||(e[1]=p=>R("IN_PROGRESS"))},{default:n(()=>[...e[9]||(e[9]=[m(" 标记为救助中 ",-1)])]),_:1})):u("",!0),h.value&&a.value.status==="IN_PROGRESS"?(o(),c(f,{key:1,type:"success",size:"large",onClick:e[2]||(e[2]=p=>R("COMPLETED"))},{default:n(()=>[...e[10]||(e[10]=[m(" 标记为已完成 ",-1)])]),_:1})):u("",!0),h.value?(o(),c(f,{key:2,type:"primary",plain:"",size:"large",onClick:H},{default:n(()=>[...e[11]||(e[11]=[m(" 编辑信息 ",-1)])]),_:1})):u("",!0),h.value?(o(),c(f,{key:3,type:"danger",plain:"",size:"large",onClick:V},{default:n(()=>[...e[12]||(e[12]=[m(" 删除信息 ",-1)])]),_:1})):u("",!0)])])):u("",!0)]}),_:1})),[[Q,y.value]]),a.value&&a.value.updates&&a.value.updates.length>0?(o(),c(B,{key:0,class:"updates-card"},{header:n(()=>[...e[13]||(e[13]=[s("h3",null,"救助进展",-1)])]),default:n(()=>[l(j,null,{default:n(()=>[(o(!0),d(w,null,I(a.value.updates,i=>(o(),c(A,{key:i.id,timestamp:x(i.createTime),placement:"top"},{default:n(()=>[s("div",He,[s("div",Ve,r(i.content),1),i.images&&i.images.length>0?(o(),d("div",We,[(o(!0),d(w,null,I(i.images,(k,p)=>(o(),c(N,{key:p,src:k,"preview-src-list":i.images,"initial-index":p,fit:"cover",class:"update-image"},null,8,["src","preview-src-list","initial-index"]))),128))])):u("",!0)])]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):u("",!0)])])}}},nt=he(Ye,[["__scopeId","data-v-98364d16"]]);export{nt as default};
