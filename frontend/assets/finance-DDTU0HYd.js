import{s as w}from"./index-BCcbQRi_.js";/* empty css                   *//* empty css                             *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                       *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css               *//* empty css                */import{G as ce,O as me,$ as ve,E as _,N as fe,k as _e,ax as ge,aF as ye,a7 as Ee,ad as be,aD as Ve,aE as Ce,m as De,e as we,v as ke,F as Ne,I as xe,J as Ie,aG as he,q as Pe,r as Oe,D as Re,af as Te,u as Ue,aH as Me,T as Fe,U as Se,_ as ze}from"./element-plus-o-j_G_-z.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as d,j as Ae,z as Be,R as t,J as a,A as g,B as n,u as U,P as u,K as Ge,I as V,O as s,D as W,L as D}from"./vue-vendor-L7KxampG.js";import"./utils-CCXpdI6d.js";function qe(p){return w.get("/api/finance/page",{params:p})}function Je(p){return w.get(`/api/finance/${p}`)}function Ye(p){return w.post("/api/finance",p)}function Le(p,k){return w.put(`/api/finance/${p}/approve`,null,{params:{status:k}})}function je(p){return w.get("/api/finance/stats",{params:p})}function Xe(p){return w.post("/api/finance/export",p)}const He={class:"finance-manage"},Ke={class:"stat-card"},We={class:"stat-icon income"},Qe={class:"stat-content"},Ze={class:"stat-value"},et={class:"stat-card"},tt={class:"stat-icon expense"},at={class:"stat-content"},lt={class:"stat-value"},ot={class:"stat-card"},nt={class:"stat-icon balance"},st={class:"stat-content"},rt={class:"stat-value"},ut={class:"stat-card"},it={class:"stat-icon pending"},dt={class:"stat-content"},pt={class:"stat-value"},ct={class:"card-header"},mt={class:"header-actions"},vt={__name:"finance",setup(p){const k=d(!1),M=d(!1),B=d([]),P=d(""),O=d(""),m=d([]),F=d(1),S=d(10),G=d(0),N=d({totalIncome:0,totalExpense:0,balance:0,pendingCount:0}),x=d(!1),z=d(!1),r=d(null),I=d(null),i=d({type:"INCOME",category:"",amount:null,transactionDate:"",description:"",remark:""}),Q={type:[{required:!0,message:"请选择类型",trigger:"change"}],category:[{required:!0,message:"请输入分类",trigger:"blur"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"}],transactionDate:[{required:!0,message:"请选择交易日期",trigger:"change"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}]},q=o=>({PENDING:"待审批",APPROVED:"已通过",REJECTED:"已拒绝"})[o]||o,J=o=>({PENDING:"warning",APPROVED:"success",REJECTED:"danger"})[o]||"info",$=async()=>{try{const o=await je({});o.code===200&&(N.value=o.data)}catch(o){console.error("加载统计数据失败",o)}},y=async()=>{k.value=!0;try{const o={page:F.value,pageSize:S.value,type:P.value,status:O.value};m.value&&m.value.length===2&&(o.startTime=m.value[0],o.endTime=m.value[1]);const e=await qe(o);e.code===200&&(B.value=e.data.records||[],G.value=e.data.total||0)}catch{_.error("加载数据失败")}finally{k.value=!1}},Z=()=>{x.value=!0},ee=async()=>{I.value&&await I.value.validate(async o=>{if(o){M.value=!0;try{await Ye(i.value),_.success("添加成功"),x.value=!1,y(),$()}catch{_.error("添加失败")}finally{M.value=!1}}})},te=async o=>{try{const e=await Je(o.id);e.code===200&&(r.value=e.data,z.value=!0)}catch{_.error("加载详情失败")}},Y=async(o,e)=>{const f=e==="APPROVED"?"通过":"拒绝";try{await ze.confirm(`确定要${f}这条财务记录吗？`,"提示",{type:"warning"}),await Le(o.id,e),_.success(`${f}成功`),y(),$()}catch(E){E!=="cancel"&&_.error(`${f}失败`)}},ae=async()=>{try{const o={type:P.value,status:O.value};m.value&&m.value.length===2&&(o.startTime=m.value[0],o.endTime=m.value[1]),(await Xe(o)).code===200&&_.success("导出成功")}catch{_.error("导出失败")}},le=()=>{i.value={type:"INCOME",category:"",amount:null,transactionDate:"",description:"",remark:""},I.value&&I.value.resetFields()};return Ae(()=>{y(),$()}),(o,e)=>{const f=_e,E=me,R=fe,oe=ce,h=Ie,L=xe,j=he,b=we,v=Ce,T=De,ne=Ve,se=Ne,X=Te,re=Re,C=Oe,A=Ue,ue=Me,ie=Pe,H=ve,c=Se,de=Fe,pe=ke;return g(),Be("div",He,[t(oe,{gutter:20,style:{"margin-bottom":"20px"}},{default:a(()=>[t(R,{span:6},{default:a(()=>[t(E,{shadow:"hover"},{default:a(()=>[n("div",Ke,[n("div",We,[t(f,null,{default:a(()=>[t(U(ge))]),_:1})]),n("div",Qe,[n("div",Ze,"¥"+u(N.value.totalIncome||0),1),e[14]||(e[14]=n("div",{class:"stat-label"},"总收入",-1))])])]),_:1})]),_:1}),t(R,{span:6},{default:a(()=>[t(E,{shadow:"hover"},{default:a(()=>[n("div",et,[n("div",tt,[t(f,null,{default:a(()=>[t(U(ye))]),_:1})]),n("div",at,[n("div",lt,"¥"+u(N.value.totalExpense||0),1),e[15]||(e[15]=n("div",{class:"stat-label"},"总支出",-1))])])]),_:1})]),_:1}),t(R,{span:6},{default:a(()=>[t(E,{shadow:"hover"},{default:a(()=>[n("div",ot,[n("div",nt,[t(f,null,{default:a(()=>[t(U(Ee))]),_:1})]),n("div",st,[n("div",rt,"¥"+u(N.value.balance||0),1),e[16]||(e[16]=n("div",{class:"stat-label"},"余额",-1))])])]),_:1})]),_:1}),t(R,{span:6},{default:a(()=>[t(E,{shadow:"hover"},{default:a(()=>[n("div",ut,[n("div",it,[t(f,null,{default:a(()=>[t(U(be))]),_:1})]),n("div",dt,[n("div",pt,u(N.value.pendingCount||0),1),e[17]||(e[17]=n("div",{class:"stat-label"},"待审批",-1))])])]),_:1})]),_:1})]),_:1}),t(E,null,{header:a(()=>[n("div",ct,[e[20]||(e[20]=n("span",null,"财务记录",-1)),n("div",mt,[t(L,{modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=l=>P.value=l),placeholder:"类型",style:{width:"120px"},clearable:"",onChange:y},{default:a(()=>[t(h,{label:"收入",value:"INCOME"}),t(h,{label:"支出",value:"EXPENSE"})]),_:1},8,["modelValue"]),t(L,{modelValue:O.value,"onUpdate:modelValue":e[1]||(e[1]=l=>O.value=l),placeholder:"状态",style:{width:"120px","margin-left":"10px"},clearable:"",onChange:y},{default:a(()=>[t(h,{label:"待审批",value:"PENDING"}),t(h,{label:"已通过",value:"APPROVED"}),t(h,{label:"已拒绝",value:"REJECTED"})]),_:1},8,["modelValue"]),t(j,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px","margin-left":"10px"},onChange:y},null,8,["modelValue"]),t(b,{type:"primary",onClick:Z,style:{"margin-left":"10px"}},{default:a(()=>[...e[18]||(e[18]=[s(" 添加记录 ",-1)])]),_:1}),t(b,{type:"success",onClick:ae,style:{"margin-left":"10px"}},{default:a(()=>[...e[19]||(e[19]=[s(" 导出报表 ",-1)])]),_:1})])])]),default:a(()=>[Ge((g(),V(ne,{data:B.value,style:{width:"100%"}},{default:a(()=>[t(v,{prop:"id",label:"ID",width:"60"}),t(v,{prop:"type",label:"类型",width:"80"},{default:a(({row:l})=>[t(T,{type:l.type==="INCOME"?"success":"danger"},{default:a(()=>[s(u(l.type==="INCOME"?"收入":"支出"),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"category",label:"分类",width:"120"}),t(v,{prop:"amount",label:"金额",width:"120"},{default:a(({row:l})=>[n("span",{style:W({color:l.type==="INCOME"?"#67c23a":"#f56c6c"})},u(l.type==="INCOME"?"+":"-")+"¥"+u(l.amount),5)]),_:1}),t(v,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(v,{prop:"transactionDate",label:"交易日期",width:"120"}),t(v,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(T,{type:J(l.status)},{default:a(()=>[s(u(q(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"createUserName",label:"创建人",width:"100"}),t(v,{label:"操作",fixed:"right",width:"180"},{default:a(({row:l})=>[t(b,{type:"primary",link:"",size:"small",onClick:K=>te(l)},{default:a(()=>[...e[21]||(e[21]=[s(" 查看 ",-1)])]),_:1},8,["onClick"]),l.status==="PENDING"?(g(),V(b,{key:0,type:"success",link:"",size:"small",onClick:K=>Y(l,"APPROVED")},{default:a(()=>[...e[22]||(e[22]=[s(" 通过 ",-1)])]),_:1},8,["onClick"])):D("",!0),l.status==="PENDING"?(g(),V(b,{key:1,type:"danger",link:"",size:"small",onClick:K=>Y(l,"REJECTED")},{default:a(()=>[...e[23]||(e[23]=[s(" 拒绝 ",-1)])]),_:1},8,["onClick"])):D("",!0)]),_:1})]),_:1},8,["data"])),[[pe,k.value]]),t(se,{"current-page":F.value,"onUpdate:currentPage":e[3]||(e[3]=l=>F.value=l),"page-size":S.value,"onUpdate:pageSize":e[4]||(e[4]=l=>S.value=l),total:G.value,layout:"total, prev, pager, next",style:{"margin-top":"20px","justify-content":"flex-end"},onCurrentChange:y},null,8,["current-page","page-size","total"])]),_:1}),t(H,{modelValue:x.value,"onUpdate:modelValue":e[12]||(e[12]=l=>x.value=l),title:"添加财务记录",width:"600px",onClose:le},{footer:a(()=>[t(b,{onClick:e[11]||(e[11]=l=>x.value=!1)},{default:a(()=>[...e[26]||(e[26]=[s("取消",-1)])]),_:1}),t(b,{type:"primary",onClick:ee,loading:M.value},{default:a(()=>[...e[27]||(e[27]=[s(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(ie,{ref_key:"formRef",ref:I,model:i.value,rules:Q,"label-width":"100px"},{default:a(()=>[t(C,{label:"类型",prop:"type"},{default:a(()=>[t(re,{modelValue:i.value.type,"onUpdate:modelValue":e[5]||(e[5]=l=>i.value.type=l)},{default:a(()=>[t(X,{label:"INCOME"},{default:a(()=>[...e[24]||(e[24]=[s("收入",-1)])]),_:1}),t(X,{label:"EXPENSE"},{default:a(()=>[...e[25]||(e[25]=[s("支出",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"分类",prop:"category"},{default:a(()=>[t(A,{modelValue:i.value.category,"onUpdate:modelValue":e[6]||(e[6]=l=>i.value.category=l),placeholder:"请输入分类，如：捐款、医疗费、食品费等"},null,8,["modelValue"])]),_:1}),t(C,{label:"金额",prop:"amount"},{default:a(()=>[t(ue,{modelValue:i.value.amount,"onUpdate:modelValue":e[7]||(e[7]=l=>i.value.amount=l),min:.01,precision:2,step:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(C,{label:"交易日期",prop:"transactionDate"},{default:a(()=>[t(j,{modelValue:i.value.transactionDate,"onUpdate:modelValue":e[8]||(e[8]=l=>i.value.transactionDate=l),type:"date",placeholder:"选择日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(C,{label:"描述",prop:"description"},{default:a(()=>[t(A,{modelValue:i.value.description,"onUpdate:modelValue":e[9]||(e[9]=l=>i.value.description=l),type:"textarea",rows:4,placeholder:"请输入详细描述"},null,8,["modelValue"])]),_:1}),t(C,{label:"备注",prop:"remark"},{default:a(()=>[t(A,{modelValue:i.value.remark,"onUpdate:modelValue":e[10]||(e[10]=l=>i.value.remark=l),type:"textarea",rows:2,placeholder:"可选填备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(H,{modelValue:z.value,"onUpdate:modelValue":e[13]||(e[13]=l=>z.value=l),title:"财务记录详情",width:"600px"},{default:a(()=>[r.value?(g(),V(de,{key:0,column:2,border:""},{default:a(()=>[t(c,{label:"记录ID"},{default:a(()=>[s(u(r.value.id),1)]),_:1}),t(c,{label:"类型"},{default:a(()=>[t(T,{type:r.value.type==="INCOME"?"success":"danger"},{default:a(()=>[s(u(r.value.type==="INCOME"?"收入":"支出"),1)]),_:1},8,["type"])]),_:1}),t(c,{label:"分类"},{default:a(()=>[s(u(r.value.category),1)]),_:1}),t(c,{label:"金额"},{default:a(()=>[n("span",{style:W({color:r.value.type==="INCOME"?"#67c23a":"#f56c6c",fontWeight:"bold"})},u(r.value.type==="INCOME"?"+":"-")+"¥"+u(r.value.amount),5)]),_:1}),t(c,{label:"交易日期"},{default:a(()=>[s(u(r.value.transactionDate),1)]),_:1}),t(c,{label:"状态"},{default:a(()=>[t(T,{type:J(r.value.status)},{default:a(()=>[s(u(q(r.value.status)),1)]),_:1},8,["type"])]),_:1}),t(c,{label:"描述",span:2},{default:a(()=>[s(u(r.value.description),1)]),_:1}),r.value.remark?(g(),V(c,{key:0,label:"备注",span:2},{default:a(()=>[s(u(r.value.remark),1)]),_:1})):D("",!0),t(c,{label:"创建人"},{default:a(()=>[s(u(r.value.createUserName),1)]),_:1}),t(c,{label:"创建时间"},{default:a(()=>[s(u(r.value.createTime),1)]),_:1}),r.value.approveUserName?(g(),V(c,{key:1,label:"审批人"},{default:a(()=>[s(u(r.value.approveUserName),1)]),_:1})):D("",!0),r.value.approveTime?(g(),V(c,{key:2,label:"审批时间"},{default:a(()=>[s(u(r.value.approveTime),1)]),_:1})):D("",!0)]),_:1})):D("",!0)]),_:1},8,["modelValue"])])}}},Mt=$e(vt,[["__scopeId","data-v-15ffe2f5"]]);export{Mt as default};
