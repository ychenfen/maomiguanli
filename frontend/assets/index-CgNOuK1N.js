import{u as ce}from"./index-C7QMbvNI.js";/* empty css                   *//* empty css               *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                 *//* empty css                       *//* empty css                        */import{aA as ae,r as g,c as Z,I as C,A as c,J as n,B as s,L as k,R as a,u as _,P as r,O as y,z as u,E as A,W as te,Q as z,a6 as I,M as de,l as re,j as ue,K as me}from"./vue-vendor-L7KxampG.js";import{g as M,a as ne,k as se,w as ee,d as _e,a1 as ye,b as pe,c as fe,a2 as oe,a3 as ve,m as ge,a4 as he,Q as ke,a5 as Ce,l as Ee,p as we,a6 as De,O as ie,_ as $e,E,e as Te,G as be,N as xe,D as ze,M as Ie,H as Me,F as Le,v as Ne,a7 as Re,a8 as Se}from"./element-plus-o-j_G_-z.js";import{d as Ue,g as Ae,a as Pe,b as Ye,u as Be,l as Oe}from"./community-B9PPt_GH.js";/* empty css                        */import{r as Ve}from"./zh-cn-qMXBDFIZ.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCXpdI6d.js";const He={class:"dynamic-header"},Fe={class:"user-detail"},je={class:"user-name"},Xe={class:"publish-time"},Ge={key:1,class:"dynamic-title"},Qe={key:3,class:"dynamic-images"},qe={class:"cat-info"},Je={class:"cat-name"},Ke={class:"cat-desc"},We={class:"dynamic-actions"},Ze={__name:"index",props:{dynamic:{type:Object,required:!0}},emits:["like","comment","detail","refresh"],setup(l,{emit:w}){M.extend(Ve),M.locale("zh-cn");const d=l,p=w,m=ae(),D=ce(),h=g(!1),L=Z(()=>d.dynamic.content&&d.dynamic.content.length>200),T=Z(()=>d.dynamic.images?d.dynamic.images.slice(0,9):[]),P=Z(()=>{var e;return D.userInfo.id===((e=d.dynamic.author)==null?void 0:e.id)}),$=e=>{if(!e)return"";const t=M(),o=M(e),f=t.diff(o,"hour");return f<24?o.fromNow():f<24*7?o.format("MM-DD HH:mm"):o.format("YYYY-MM-DD")},Y=e=>({ADOPTION:"领养分享",DAILY:"日常记录",RESCUE:"救助故事",EXPERIENCE:"养猫经验"})[e]||e,B=e=>({ADOPTION:"success",DAILY:"primary",RESCUE:"warning",EXPERIENCE:"info"})[e]||"info",O=()=>{h.value=!0},V=()=>{var e;(e=d.dynamic.author)!=null&&e.id&&m.push(`/user/${d.dynamic.author.id}`)},H=()=>{p("detail",d.dynamic.id)},N=()=>{var e;(e=d.dynamic.cat)!=null&&e.id&&m.push(`/cats/${d.dynamic.cat.id}`)},F=()=>{p("like",d.dynamic.id,d.dynamic.isLiked)},j=()=>{p("comment",d.dynamic.id)},X=()=>{const e=`${window.location.origin}/community/${d.dynamic.id}`;navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{E.success("链接已复制到剪贴板")}).catch(()=>{E.warning("复制失败，请手动复制")}):E.info(`分享链接：${e}`)},G=()=>{m.push(`/community/edit/${d.dynamic.id}`)},Q=async()=>{try{await $e.confirm("确定要删除这条动态吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),(await Ue(d.dynamic.id)).code===200&&(E.success("删除成功"),p("refresh"))}catch(e){e!=="cancel"&&E.error(e.message||"删除失败")}};return(e,t)=>{const o=se,f=ne,v=fe,q=pe,J=_e,K=ge,b=ke,x=ie;return c(),C(x,{class:"dynamic-card","body-style":{padding:"0"}},{default:n(()=>{var R,S;return[s("div",He,[s("div",{class:"user-info",onClick:V},[a(f,{size:40,src:(R=l.dynamic.author)==null?void 0:R.avatar},{default:n(()=>[a(o,null,{default:n(()=>[a(_(ee))]),_:1})]),_:1},8,["src"]),s("div",Fe,[s("div",je,r((S=l.dynamic.author)==null?void 0:S.username),1),s("div",Xe,r($(l.dynamic.createTime)),1)])]),P.value?(c(),C(J,{key:0,trigger:"click"},{dropdown:n(()=>[a(q,null,{default:n(()=>[a(v,{onClick:G},{default:n(()=>[a(o,null,{default:n(()=>[a(_(oe))]),_:1}),t[0]||(t[0]=y(" 编辑 ",-1))]),_:1}),a(v,{onClick:Q},{default:n(()=>[a(o,null,{default:n(()=>[a(_(ve))]),_:1}),t[1]||(t[1]=y(" 删除 ",-1))]),_:1})]),_:1})]),default:n(()=>[a(o,{class:"more-icon"},{default:n(()=>[a(_(ye))]),_:1})]),_:1})):k("",!0)]),s("div",{class:"dynamic-content",onClick:H},[l.dynamic.type?(c(),C(K,{key:0,type:B(l.dynamic.type),size:"small",class:"type-tag"},{default:n(()=>[y(r(Y(l.dynamic.type)),1)]),_:1},8,["type"])):k("",!0),l.dynamic.title?(c(),u("h3",Ge,r(l.dynamic.title),1)):k("",!0),s("div",{class:A(["dynamic-text",{expanded:h.value}])},r(l.dynamic.content),3),L.value&&!h.value?(c(),u("div",{key:2,class:"expand-btn",onClick:te(O,["stop"])},[t[2]||(t[2]=y(" 展开全文 ",-1)),a(o,null,{default:n(()=>[a(_(he))]),_:1})])):k("",!0),l.dynamic.images&&l.dynamic.images.length>0?(c(),u("div",Qe,[(c(!0),u(z,null,I(T.value,(W,i)=>(c(),C(b,{key:i,src:W,"preview-src-list":l.dynamic.images,"initial-index":i,fit:"cover",class:A(["image-item",`image-count-${T.value.length}`])},null,8,["src","preview-src-list","initial-index","class"]))),128))])):k("",!0),l.dynamic.cat?(c(),u("div",{key:4,class:"related-cat",onClick:te(N,["stop"])},[a(b,{src:l.dynamic.cat.coverImage,fit:"cover",class:"cat-image"},null,8,["src"]),s("div",qe,[s("div",Je,[a(o,null,{default:n(()=>[a(_(Ce))]),_:1}),y(" "+r(l.dynamic.cat.name),1)]),s("div",Ke,r(l.dynamic.cat.breed)+" · "+r(l.dynamic.cat.age),1)]),a(o,{class:"arrow-icon"},{default:n(()=>[a(_(Ee))]),_:1})])):k("",!0)]),s("div",We,[s("div",{class:"action-item",onClick:F},[a(o,{class:A({liked:l.dynamic.isLiked})},{default:n(()=>[(c(),C(de(l.dynamic.isLiked?"StarFilled":"Star")))]),_:1},8,["class"]),s("span",null,r(l.dynamic.likeCount||0),1)]),s("div",{class:"action-item",onClick:j},[a(o,null,{default:n(()=>[a(_(we))]),_:1}),s("span",null,r(l.dynamic.commentCount||0),1)]),s("div",{class:"action-item",onClick:X},[a(o,null,{default:n(()=>[a(_(De))]),_:1}),t[3]||(t[3]=s("span",null,"分享",-1))])])]}),_:1})}}},et=le(Ze,[["__scopeId","data-v-3a05fcac"]]),tt={class:"community-page"},at={class:"container"},nt={class:"page-header"},st={class:"filter-tabs"},ot={class:"dynamics-list"},it={key:2,class:"pagination-wrapper"},lt={class:"card-header"},ct={class:"hot-topics"},dt=["onClick"],rt={class:"topic-info"},ut={class:"topic-name"},mt={class:"topic-count"},_t={class:"card-header"},yt={class:"active-users"},pt=["onClick"],ft={class:"user-info"},vt={class:"user-name"},gt={class:"user-stats"},ht={class:"card-header"},kt={class:"notices"},Ct={class:"notice-title"},Et={class:"notice-time"},wt={__name:"index",setup(l){const w=ae(),d=g(!1),p=g(""),m=re({page:1,size:10}),D=g([]),h=g(0),L=g([{name:"新手养猫",count:156},{name:"流浪猫救助",count:128},{name:"猫咪健康",count:102},{name:"领养故事",count:89},{name:"喵星人日常",count:76}]),T=g([]),P=g([{id:1,title:"关于加强流浪猫救助管理的通知",createTime:"2024-01-15"},{id:2,title:"校园流浪猫TNR计划启动",createTime:"2024-01-10"},{id:3,title:"寒假期间喂养点安排公告",createTime:"2024-01-05"}]),$=async()=>{d.value=!0;try{const e={page:m.page,size:m.size};p.value&&(e.type=p.value);const t=await Ae(e);t.code===200&&(D.value=t.data.records||[],h.value=t.data.total||0)}catch{E.error("加载动态列表失败")}finally{d.value=!1}},Y=async()=>{try{const e=await Pe({limit:5});e.code===200&&(L.value=e.data||[])}catch(e){console.error("加载热门话题失败",e)}},B=async()=>{try{const e=await Ye({limit:5});e.code===200&&(T.value=e.data||[])}catch(e){console.error("加载活跃用户失败",e)}},O=()=>{m.page=1,$()},V=e=>{m.page=e,$(),window.scrollTo({top:0,behavior:"smooth"})},H=e=>{m.size=e,m.page=1,$()},N=()=>{w.push("/community/publish")},F=async(e,t)=>{try{t?await Be(e):await Oe(e);const o=D.value.find(f=>f.id===e);o&&(o.isLiked=!t,o.likeCount+=t?-1:1)}catch(o){E.error(o.message||"操作失败")}},j=e=>{w.push(`/community/${e}#comment`)},X=e=>{w.push(`/community/${e}`)},G=e=>{w.push(`/community?topic=${encodeURIComponent(e)}`)},Q=e=>e?M(e).format("YYYY-MM-DD"):"-";return ue(()=>{$(),Y(),B()}),(e,t)=>{const o=se,f=Te,v=Ie,q=ze,J=Me,K=Le,b=xe,x=ie,R=ne,S=be,W=Ne;return c(),u("div",tt,[s("div",at,[s("div",nt,[t[4]||(t[4]=s("h1",null,"社区动态",-1)),t[5]||(t[5]=s("p",{class:"desc"},"分享你和毛孩子的温馨故事",-1)),a(f,{type:"primary",size:"large",onClick:N},{default:n(()=>[a(o,null,{default:n(()=>[a(_(oe))]),_:1}),t[3]||(t[3]=y(" 发布动态 ",-1))]),_:1})]),a(S,{gutter:24},{default:n(()=>[a(b,{xs:24,lg:16},{default:n(()=>[s("div",st,[a(q,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=i=>p.value=i),onChange:O},{default:n(()=>[a(v,{label:""},{default:n(()=>[...t[6]||(t[6]=[y("全部动态",-1)])]),_:1}),a(v,{label:"ADOPTION"},{default:n(()=>[...t[7]||(t[7]=[y("领养分享",-1)])]),_:1}),a(v,{label:"DAILY"},{default:n(()=>[...t[8]||(t[8]=[y("日常记录",-1)])]),_:1}),a(v,{label:"RESCUE"},{default:n(()=>[...t[9]||(t[9]=[y("救助故事",-1)])]),_:1}),a(v,{label:"EXPERIENCE"},{default:n(()=>[...t[10]||(t[10]=[y("养猫经验",-1)])]),_:1})]),_:1},8,["modelValue"])]),me((c(),u("div",ot,[!d.value&&D.value.length===0?(c(),C(J,{key:0,description:"暂无动态"},{default:n(()=>[a(f,{type:"primary",onClick:N},{default:n(()=>[...t[11]||(t[11]=[y(" 发布第一条动态 ",-1)])]),_:1})]),_:1})):(c(!0),u(z,{key:1},I(D.value,i=>(c(),C(et,{key:i.id,dynamic:i,onLike:F,onComment:j,onDetail:X},null,8,["dynamic"]))),128)),h.value>0?(c(),u("div",it,[a(K,{"current-page":m.page,"onUpdate:currentPage":t[1]||(t[1]=i=>m.page=i),"page-size":m.size,"onUpdate:pageSize":t[2]||(t[2]=i=>m.size=i),total:h.value,"page-sizes":[10,20,30],layout:"total, sizes, prev, pager, next",onSizeChange:H,onCurrentChange:V},null,8,["current-page","page-size","total"])])):k("",!0)])),[[W,d.value]])]),_:1}),a(b,{xs:24,lg:8},{default:n(()=>[a(x,{class:"side-card"},{header:n(()=>[s("div",lt,[a(o,null,{default:n(()=>[a(_(Re))]),_:1}),t[12]||(t[12]=s("span",null,"热门话题",-1))])]),default:n(()=>[s("div",ct,[(c(!0),u(z,null,I(L.value,(i,U)=>(c(),u("div",{key:U,class:"topic-item",onClick:Dt=>G(i.name)},[s("span",{class:A(["topic-rank",`rank-${U+1}`])},r(U+1),3),s("div",rt,[s("div",ut,"#"+r(i.name)+"#",1),s("div",mt,r(i.count)+" 条动态",1)])],8,dt))),128))])]),_:1}),a(x,{class:"side-card"},{header:n(()=>[s("div",_t,[a(o,null,{default:n(()=>[a(_(ee))]),_:1}),t[13]||(t[13]=s("span",null,"活跃用户",-1))])]),default:n(()=>[s("div",yt,[(c(!0),u(z,null,I(T.value,i=>(c(),u("div",{key:i.id,class:"user-item",onClick:U=>e.$router.push(`/user/${i.id}`)},[a(R,{size:40,src:i.avatar},{default:n(()=>[a(o,null,{default:n(()=>[a(_(ee))]),_:1})]),_:1},8,["src"]),s("div",ft,[s("div",vt,r(i.username),1),s("div",gt,r(i.dynamicCount)+" 条动态",1)])],8,pt))),128))])]),_:1}),a(x,{class:"side-card"},{header:n(()=>[s("div",ht,[a(o,null,{default:n(()=>[a(_(Se))]),_:1}),t[14]||(t[14]=s("span",null,"社区公告",-1))])]),default:n(()=>[s("div",kt,[(c(!0),u(z,null,I(P.value,i=>(c(),u("div",{key:i.id,class:"notice-item"},[s("div",Ct,r(i.title),1),s("div",Et,r(Q(i.createTime)),1)]))),128))])]),_:1})]),_:1})]),_:1})])])}}},Ht=le(wt,[["__scopeId","data-v-df30b915"]]);export{Ht as default};
