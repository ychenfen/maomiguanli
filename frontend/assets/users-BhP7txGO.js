import{s as b}from"./index-C7QMbvNI.js";/* empty css                   *//* empty css                   *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                *//* empty css                      *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";import{r as u,j as L,z as P,R as a,J as s,A as R,K,I as F,O as d,P as N,B as T,a4 as j,u as q}from"./vue-vendor-L7KxampG.js";import{O as J,$ as G,aD as H,aE as Q,m as W,e as X,v as Y,F as Z,u as ee,K as ae,q as le,r as te,I as se,J as oe,_ as ne,E as c}from"./element-plus-o-j_G_-z.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCXpdI6d.js";const re={class:"user-manage"},ie={class:"card-header"},pe={__name:"users",setup(de){const _=u(!1),m=u([]),g=u(""),v=u(1),f=u(10),E=u(0),p=u(!1),n=u({id:null,username:"",role:""}),S=l=>({USER:"info",VOLUNTEER:"success",ADMIN:"warning",SUPER_ADMIN:"danger"})[l]||"info",w=l=>({USER:"用户",VOLUNTEER:"志愿者",ADMIN:"管理员",SUPER_ADMIN:"超级管理员"})[l]||l,r=async()=>{_.value=!0;try{const l=await b.get("/users/page",{params:{page:v.value,pageSize:f.value,keyword:g.value}});l.code===200&&(m.value=l.data.records||l.data,E.value=l.data.total||m.value.length)}catch{m.value=[{id:1,username:"admin",realName:"系统管理员",phone:null,college:null,role:"SUPER_ADMIN",status:1,createTime:"2024-10-16"},{id:2,username:"zhangsan",realName:"张三",phone:"13800138001",college:"计算机学院",role:"USER",status:1,createTime:"2024-11-01"},{id:3,username:"lisi",realName:"李四",phone:"13800138002",college:"文学院",role:"VOLUNTEER",status:1,createTime:"2024-11-05"},{id:4,username:"wangwu",realName:"王五",phone:"13800138003",college:"经济管理学院",role:"USER",status:1,createTime:"2024-11-10"},{id:5,username:"zhaoliu",realName:"赵六",phone:"13800138004",college:"艺术学院",role:"VOLUNTEER",status:1,createTime:"2024-11-15"},{id:6,username:"sunqi",realName:"孙七",phone:"13800138005",college:"医学院",role:"USER",status:1,createTime:"2024-11-20"}],E.value=m.value.length}finally{_.value=!1}},x=l=>{n.value={id:l.id,username:l.username,role:l.role},p.value=!0},k=async()=>{try{await b.put(`/users/${n.value.id}/role`,{role:n.value.role}),c.success("角色修改成功"),p.value=!1,r()}catch{c.success("角色修改成功（模拟）"),p.value=!1}},C=async l=>{const e=l.status===1?"禁用":"启用";try{await ne.confirm(`确定要${e}用户 "${l.realName}" 吗？`,"提示",{type:"warning"}),await b.put(`/users/${l.id}/status`,{status:l.status===1?0:1}),c.success(`${e}成功`),r()}catch(i){i!=="cancel"&&(l.status=l.status===1?0:1,c.success(`${e}成功（模拟）`))}};return L(()=>{r()}),(l,e)=>{const i=X,U=ee,o=Q,V=W,D=H,I=Z,z=J,h=te,y=oe,$=se,M=le,O=G,A=Y;return R(),P("div",re,[a(z,null,{header:s(()=>[T("div",ie,[e[7]||(e[7]=T("span",null,"用户管理",-1)),a(U,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),placeholder:"搜索用户名/姓名",style:{width:"200px"},clearable:"",onClear:r,onKeyup:j(r,["enter"])},{append:s(()=>[a(i,{icon:q(ae),onClick:r},null,8,["icon"])]),_:1},8,["modelValue"])])]),default:s(()=>[K((R(),F(D,{data:m.value,style:{width:"100%"}},{default:s(()=>[a(o,{prop:"id",label:"ID",width:"60"}),a(o,{prop:"username",label:"用户名",width:"120"}),a(o,{prop:"realName",label:"真实姓名",width:"100"}),a(o,{prop:"phone",label:"手机号",width:"130"}),a(o,{prop:"college",label:"学院",width:"150"}),a(o,{prop:"role",label:"角色",width:"100"},{default:s(({row:t})=>[a(V,{type:S(t.role)},{default:s(()=>[d(N(w(t.role)),1)]),_:2},1032,["type"])]),_:1}),a(o,{prop:"status",label:"状态",width:"80"},{default:s(({row:t})=>[a(V,{type:t.status===1?"success":"danger"},{default:s(()=>[d(N(t.status===1?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(o,{prop:"createTime",label:"注册时间",width:"160"}),a(o,{label:"操作",fixed:"right",width:"180"},{default:s(({row:t})=>[a(i,{type:"primary",link:"",size:"small",onClick:B=>x(t)},{default:s(()=>[...e[8]||(e[8]=[d("修改角色",-1)])]),_:1},8,["onClick"]),a(i,{type:t.status===1?"danger":"success",link:"",size:"small",onClick:B=>C(t)},{default:s(()=>[d(N(t.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[A,_.value]]),a(I,{"current-page":v.value,"onUpdate:currentPage":e[1]||(e[1]=t=>v.value=t),"page-size":f.value,"onUpdate:pageSize":e[2]||(e[2]=t=>f.value=t),total:E.value,layout:"total, prev, pager, next",style:{"margin-top":"20px","justify-content":"flex-end"},onCurrentChange:r},null,8,["current-page","page-size","total"])]),_:1}),a(O,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),title:"修改用户角色",width:"400px"},{footer:s(()=>[a(i,{onClick:e[5]||(e[5]=t=>p.value=!1)},{default:s(()=>[...e[9]||(e[9]=[d("取消",-1)])]),_:1}),a(i,{type:"primary",onClick:k},{default:s(()=>[...e[10]||(e[10]=[d("确定",-1)])]),_:1})]),default:s(()=>[a(M,{model:n.value,"label-width":"80px"},{default:s(()=>[a(h,{label:"用户名"},{default:s(()=>[a(U,{modelValue:n.value.username,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.username=t),disabled:""},null,8,["modelValue"])]),_:1}),a(h,{label:"角色"},{default:s(()=>[a($,{modelValue:n.value.role,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.role=t),style:{width:"100%"}},{default:s(()=>[a(y,{label:"普通用户",value:"USER"}),a(y,{label:"志愿者",value:"VOLUNTEER"}),a(y,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},we=ue(pe,[["__scopeId","data-v-8992fca2"]]);export{we as default};
