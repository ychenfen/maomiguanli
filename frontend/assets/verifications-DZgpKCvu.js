import{s as U}from"./index-C7QMbvNI.js";/* empty css                   *//* empty css                     *//* empty css                   *//* empty css                        *//* empty css                             *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";import{r as i,j as Y,z as k,R as t,J as l,a5 as Z,A as d,K as ee,I as g,O as n,P as r,L as f,B as v,a4 as te,u as le}from"./vue-vendor-L7KxampG.js";import{O as ae,$ as oe,E as C,aD as ne,aE as se,m as ie,e as re,v as ue,F as de,u as pe,K as ve,I as me,J as fe,T as ce,U as ye,Q as _e,q as Ee,r as ge}from"./element-plus-o-j_G_-z.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCXpdI6d.js";function be(_){return U.get("/api/verification/page",{params:_})}function Ce(_){return U.get(`/api/verification/${_}`)}function De(_){return U.put("/api/verification/review",_)}const Ve={class:"verification-manage"},ke={class:"card-header"},Te={class:"header-actions"},Pe={style:{"margin-top":"20px"}},Re={style:{display:"flex",gap:"20px","flex-wrap":"wrap"}},xe={key:0},Ne={key:1},Ie={key:2},Oe={__name:"verifications",setup(_){const T=i(!1),P=i(!1),A=i([]),R=i(""),x=i("PENDING"),N=i(1),I=i(10),B=i(0),w=i(!1),b=i(!1),a=i(null),c=i(""),E=i({reviewReason:""}),z=s=>({PENDING:"待审核",APPROVED:"已通过",REJECTED:"已拒绝"})[s]||s,$=s=>({PENDING:"warning",APPROVED:"success",REJECTED:"danger"})[s]||"info",y=async()=>{T.value=!0;try{const s=await be({page:N.value,pageSize:I.value,keyword:R.value,status:x.value});s.code===200&&(A.value=s.data.records||[],B.value=s.data.total||0)}catch{C.error("加载数据失败")}finally{T.value=!1}},G=async s=>{try{const e=await Ce(s.id);e.code===200&&(a.value=e.data,w.value=!0)}catch{C.error("加载详情失败")}},D=(s,e)=>{a.value=s,c.value=e,E.value.reviewReason="",w.value=!1,b.value=!0},K=async()=>{if(c.value==="REJECTED"&&!E.value.reviewReason){C.warning("请填写拒绝原因");return}P.value=!0;try{await De({id:a.value.id,status:c.value,reviewReason:E.value.reviewReason}),C.success(c.value==="APPROVED"?"审核通过":"已拒绝"),b.value=!1,y()}catch{C.error("审核失败")}finally{P.value=!1}};return Y(()=>{y()}),(s,e)=>{const p=re,h=pe,O=fe,L=me,m=se,V=ie,j=ne,M=de,q=ae,u=ye,Q=ce,S=_e,F=oe,H=ge,W=Ee,X=ue;return d(),k("div",Ve,[t(q,null,{header:l(()=>[v("div",ke,[e[11]||(e[11]=v("span",null,"身份认证审核",-1)),v("div",Te,[t(h,{modelValue:R.value,"onUpdate:modelValue":e[0]||(e[0]=o=>R.value=o),placeholder:"搜索姓名/学号",style:{width:"200px"},clearable:"",onClear:y,onKeyup:te(y,["enter"])},{append:l(()=>[t(p,{icon:le(ve),onClick:y},null,8,["icon"])]),_:1},8,["modelValue"]),t(L,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=o=>x.value=o),placeholder:"状态筛选",style:{width:"150px","margin-left":"10px"},clearable:"",onChange:y},{default:l(()=>[t(O,{label:"待审核",value:"PENDING"}),t(O,{label:"已通过",value:"APPROVED"}),t(O,{label:"已拒绝",value:"REJECTED"})]),_:1},8,["modelValue"])])])]),default:l(()=>[ee((d(),g(j,{data:A.value,style:{width:"100%"}},{default:l(()=>[t(m,{prop:"id",label:"ID",width:"60"}),t(m,{prop:"realName",label:"真实姓名",width:"100"}),t(m,{prop:"studentId",label:"学号/工号",width:"120"}),t(m,{prop:"universityName",label:"高校","min-width":"150","show-overflow-tooltip":""}),t(m,{prop:"identityType",label:"身份类型",width:"100"},{default:l(({row:o})=>[t(V,{type:o.identityType==="STUDENT"?"primary":"success"},{default:l(()=>[n(r(o.identityType==="STUDENT"?"学生":"教职工"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"status",label:"状态",width:"100"},{default:l(({row:o})=>[t(V,{type:$(o.status)},{default:l(()=>[n(r(z(o.status)),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"submitTime",label:"提交时间",width:"160"}),t(m,{label:"操作",fixed:"right",width:"150"},{default:l(({row:o})=>[t(p,{type:"primary",link:"",size:"small",onClick:J=>G(o)},{default:l(()=>[...e[12]||(e[12]=[n(" 查看 ",-1)])]),_:1},8,["onClick"]),o.status==="PENDING"?(d(),g(p,{key:0,type:"success",link:"",size:"small",onClick:J=>D(o,"APPROVED")},{default:l(()=>[...e[13]||(e[13]=[n(" 通过 ",-1)])]),_:1},8,["onClick"])):f("",!0),o.status==="PENDING"?(d(),g(p,{key:1,type:"danger",link:"",size:"small",onClick:J=>D(o,"REJECTED")},{default:l(()=>[...e[14]||(e[14]=[n(" 拒绝 ",-1)])]),_:1},8,["onClick"])):f("",!0)]),_:1})]),_:1},8,["data"])),[[X,T.value]]),t(M,{"current-page":N.value,"onUpdate:currentPage":e[2]||(e[2]=o=>N.value=o),"page-size":I.value,"onUpdate:pageSize":e[3]||(e[3]=o=>I.value=o),total:B.value,layout:"total, prev, pager, next",style:{"margin-top":"20px","justify-content":"flex-end"},onCurrentChange:y},null,8,["current-page","page-size","total"])]),_:1}),t(F,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=o=>w.value=o),title:"认证详情",width:"700px"},Z({default:l(()=>[a.value?(d(),g(Q,{key:0,column:2,border:""},{default:l(()=>[t(u,{label:"认证ID"},{default:l(()=>[n(r(a.value.id),1)]),_:1}),t(u,{label:"状态"},{default:l(()=>[t(V,{type:$(a.value.status)},{default:l(()=>[n(r(z(a.value.status)),1)]),_:1},8,["type"])]),_:1}),t(u,{label:"真实姓名"},{default:l(()=>[n(r(a.value.realName),1)]),_:1}),t(u,{label:"学号/工号"},{default:l(()=>[n(r(a.value.studentId),1)]),_:1}),t(u,{label:"高校",span:2},{default:l(()=>[n(r(a.value.universityName),1)]),_:1}),t(u,{label:"身份类型"},{default:l(()=>[t(V,{type:a.value.identityType==="STUDENT"?"primary":"success"},{default:l(()=>[n(r(a.value.identityType==="STUDENT"?"学生":"教职工"),1)]),_:1},8,["type"])]),_:1}),t(u,{label:"联系电话"},{default:l(()=>[n(r(a.value.phone),1)]),_:1}),t(u,{label:"提交时间",span:2},{default:l(()=>[n(r(a.value.submitTime),1)]),_:1}),a.value.reviewTime?(d(),g(u,{key:0,label:"审核时间",span:2},{default:l(()=>[n(r(a.value.reviewTime),1)]),_:1})):f("",!0),a.value.reviewReason?(d(),g(u,{key:1,label:"审核意见",span:2},{default:l(()=>[n(r(a.value.reviewReason),1)]),_:1})):f("",!0)]),_:1})):f("",!0),v("div",Pe,[e[18]||(e[18]=v("h4",null,"证件照片",-1)),v("div",Re,[a.value.idCardFront?(d(),k("div",xe,[e[15]||(e[15]=v("p",null,"身份证正面",-1)),t(S,{src:a.value.idCardFront,"preview-src-list":[a.value.idCardFront],style:{width:"200px",height:"120px"},fit:"cover"},null,8,["src","preview-src-list"])])):f("",!0),a.value.idCardBack?(d(),k("div",Ne,[e[16]||(e[16]=v("p",null,"身份证反面",-1)),t(S,{src:a.value.idCardBack,"preview-src-list":[a.value.idCardBack],style:{width:"200px",height:"120px"},fit:"cover"},null,8,["src","preview-src-list"])])):f("",!0),a.value.studentCard?(d(),k("div",Ie,[e[17]||(e[17]=v("p",null,"学生证/工作证",-1)),t(S,{src:a.value.studentCard,"preview-src-list":[a.value.studentCard],style:{width:"200px",height:"120px"},fit:"cover"},null,8,["src","preview-src-list"])])):f("",!0)])])]),_:2},[a.value&&a.value.status==="PENDING"?{name:"footer",fn:l(()=>[t(p,{onClick:e[4]||(e[4]=o=>w.value=!1)},{default:l(()=>[...e[19]||(e[19]=[n("关闭",-1)])]),_:1}),t(p,{type:"success",onClick:e[5]||(e[5]=o=>D(a.value,"APPROVED"))},{default:l(()=>[...e[20]||(e[20]=[n(" 通过 ",-1)])]),_:1}),t(p,{type:"danger",onClick:e[6]||(e[6]=o=>D(a.value,"REJECTED"))},{default:l(()=>[...e[21]||(e[21]=[n(" 拒绝 ",-1)])]),_:1})]),key:"0"}:void 0]),1032,["modelValue"]),t(F,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=o=>b.value=o),title:c.value==="APPROVED"?"通过认证":"拒绝认证",width:"500px"},{footer:l(()=>[t(p,{onClick:e[9]||(e[9]=o=>b.value=!1)},{default:l(()=>[...e[22]||(e[22]=[n("取消",-1)])]),_:1}),t(p,{type:c.value==="APPROVED"?"success":"danger",onClick:K,loading:P.value},{default:l(()=>[...e[23]||(e[23]=[n(" 确定 ",-1)])]),_:1},8,["type","loading"])]),default:l(()=>[t(W,{model:E.value,"label-width":"100px"},{default:l(()=>[t(H,{label:"审核意见"},{default:l(()=>[t(h,{modelValue:E.value.reviewReason,"onUpdate:modelValue":e[8]||(e[8]=o=>E.value.reviewReason=o),type:"textarea",rows:5,placeholder:c.value==="APPROVED"?"可选填通过原因":"请填写拒绝原因"},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Xe=we(Oe,[["__scopeId","data-v-b7a72143"]]);export{Xe as default};
