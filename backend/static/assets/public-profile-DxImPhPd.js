import{_ as se,f as te}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                    *//* empty css                        *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                */import{c as R,aA as ne,r as u,w as oe,o as le,B as o,E as t,M as w,y as g,D as v,C as c,az as ie,z as n,u as G,R as l,Q as $,O as y,K as H,a5 as J}from"./vue-vendor-UlW9XFxV.js";import{y as re,at as ue,E as N,Y as ce,r as de,l as pe,J as ve,B as _e,au as me,m as ge,Q as ye,_ as fe,a as he}from"./element-plus-5e6ZgU0u.js";import{D as Ee}from"./index-CqstUhxi.js";import{i as ke,l as ze}from"./community-C3gF1jKv.js";import{g as De}from"./rescue-BHuK3UKq.js";import"./utils-Yxd-MeZx.js";const Le={class:"public-profile-page"},Ne={class:"banner"},Se={class:"container"},Ce={class:"user-header"},Ie={class:"user-meta"},be={class:"user-title"},Te={class:"username"},Re={class:"sub"},we={key:0},Ae={key:1},Pe={key:2},Ue={class:"stats"},xe={class:"stat"},Ve={class:"num"},Me={class:"stat"},Oe={class:"num"},Be={class:"container content"},Ye={key:1,class:"dyn-list"},Ge={key:2,class:"pagination-wrapper"},$e={key:1,class:"rescue-list"},He={class:"rescue-item-inner"},Je={class:"info"},Qe={class:"title"},je={class:"text"},Fe={class:"desc"},Ke={class:"meta"},qe={key:2,class:"pagination-wrapper"},We={__name:"public-profile",setup(Xe){const A=ne(),P=ie(),m=R(()=>Number(A.params.id)),U=u("dynamics"),S=u(!1),i=u({}),E=u(!1),r=u([]),d=u({page:1,size:10}),C=R(()=>r.value.length),Q=R(()=>{const e=(d.value.page-1)*d.value.size;return r.value.slice(e,e+d.value.size)}),k=u(!1),I=u([]),z=u(0),_=u({page:1,size:10}),j=e=>{if(!e)return[];if(Array.isArray(e))return e;try{const a=JSON.parse(e);return Array.isArray(a)?a:[]}catch{return[]}},F=e=>e?he(e).format("YYYY-MM-DD HH:mm"):"-",K=e=>({USER:"普通用户",VOLUNTEER:"志愿者",ADMIN:"管理员",SUPER_ADMIN:"超级管理员"})[e]||"用户",q=e=>({USER:"",VOLUNTEER:"success",ADMIN:"warning",SUPER_ADMIN:"danger"})[e]||"",W=e=>({PENDING:"待救助",PROCESSING:"处理中",RESOLVED:"已解决",CLOSED:"已关闭"})[e]||e,X=e=>({PENDING:"warning",PROCESSING:"primary",RESOLVED:"success",CLOSED:"info"})[e]||"info",x=async()=>{if(m.value){S.value=!0;try{const e=await te(m.value);e.code===200&&(i.value=e.data||{})}catch{N.error("加载用户信息失败")}finally{S.value=!1}}},V=async()=>{if(m.value){E.value=!0;try{const e=await ke(m.value);e.code===200&&(r.value=Array.isArray(e.data)?e.data:[])}catch{N.error("加载动态失败")}finally{E.value=!1}}},D=async()=>{if(m.value){k.value=!0;try{const e=await De({pageNum:_.value.page,pageSize:_.value.size,userId:m.value});e.code===200&&(I.value=(e.data.records||[]).map(a=>({...a,imagesList:j(a.images)})),z.value=e.data.total||0)}catch{N.error("加载救助信息失败")}finally{k.value=!1}}},Z=async e=>{try{const a=await ze(e);if(a.code!==200)return;const p=r.value.findIndex(L=>L.id===e);if(p===-1)return;const f=!!a.data,h=!!r.value[p].isLiked;r.value[p].isLiked=f,f&&!h&&(r.value[p].likeCount=(r.value[p].likeCount||0)+1),!f&&h&&(r.value[p].likeCount=Math.max(0,(r.value[p].likeCount||0)-1))}catch{N.error("操作失败")}},M=e=>{P.push(`/community/${e}`)};return oe(()=>A.params.id,()=>{d.value.page=1,_.value.page=1,x(),V(),D()}),le(()=>{x(),V(),D()}),(e,a)=>{const p=pe,f=de,h=_e,L=ce,O=ge,B=ye,Y=me,ee=fe,ae=ue,b=re;return n(),o("div",Le,[t("div",Ne,[t("div",Se,[w((n(),g(L,{class:"user-card",shadow:"never"},{default:v(()=>[t("div",Ce,[c(f,{size:84,src:i.value.avatar},{default:v(()=>[c(p,null,{default:v(()=>[c(G(ve))]),_:1})]),_:1},8,["src"]),t("div",Ie,[t("div",be,[t("h1",Te,l(i.value.username||"-"),1),c(h,{size:"small",type:q(i.value.role)},{default:v(()=>[$(l(K(i.value.role)),1)]),_:1},8,["type"])]),t("div",Re,[i.value.realName?(n(),o("span",we,"实名："+l(i.value.realName),1)):y("",!0),i.value.studentId?(n(),o("span",Ae,"学号/工号："+l(i.value.studentId),1)):y("",!0),i.value.phone?(n(),o("span",Pe,"电话："+l(i.value.phone),1)):y("",!0)]),t("div",Ue,[t("div",xe,[t("div",Ve,l(C.value),1),a[5]||(a[5]=t("div",{class:"label"},"动态",-1))]),t("div",Me,[t("div",Oe,l(z.value),1),a[6]||(a[6]=t("div",{class:"label"},"救助",-1))])])])])]),_:1})),[[b,S.value]])])]),t("div",Be,[c(ae,{modelValue:U.value,"onUpdate:modelValue":a[4]||(a[4]=s=>U.value=s)},{default:v(()=>[c(Y,{label:"TA的动态",name:"dynamics"},{default:v(()=>[w((n(),o("div",null,[!E.value&&r.value.length===0?(n(),g(O,{key:0,description:"暂无动态"})):(n(),o("div",Ye,[(n(!0),o(H,null,J(Q.value,s=>(n(),g(Ee,{key:s.id,dynamic:s,onLike:Z,onComment:M,onDetail:M},null,8,["dynamic"]))),128))])),C.value>d.value.size?(n(),o("div",Ge,[c(B,{"current-page":d.value.page,"onUpdate:currentPage":a[0]||(a[0]=s=>d.value.page=s),"page-size":d.value.size,"onUpdate:pageSize":a[1]||(a[1]=s=>d.value.size=s),total:C.value,"page-sizes":[5,10,20],layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])])):y("",!0)])),[[b,E.value]])]),_:1}),c(Y,{label:"TA的救助",name:"rescues"},{default:v(()=>[w((n(),o("div",null,[!k.value&&I.value.length===0?(n(),g(O,{key:0,description:"暂无救助信息"})):(n(),o("div",$e,[(n(!0),o(H,null,J(I.value,s=>(n(),g(L,{key:s.id,class:"rescue-item",shadow:"hover",onClick:T=>G(P).push(`/rescue/${s.id}`)},{default:v(()=>{var T;return[t("div",He,[(T=s.imagesList)!=null&&T.length?(n(),g(ee,{key:0,class:"thumb",src:s.imagesList[0],fit:"cover"},null,8,["src"])):y("",!0),t("div",Je,[t("div",Qe,[t("span",je,l(s.title||"-"),1),c(h,{size:"small",type:X(s.status)},{default:v(()=>[$(l(W(s.status)),1)]),_:2},1032,["type"])]),t("div",Fe,l(s.description||"-"),1),t("div",Ke,[t("span",null,l(s.location||"-"),1),t("span",null,l(F(s.createTime)),1)])])])]}),_:2},1032,["onClick"]))),128))])),z.value>0?(n(),o("div",qe,[c(B,{"current-page":_.value.page,"onUpdate:currentPage":a[2]||(a[2]=s=>_.value.page=s),"page-size":_.value.size,"onUpdate:pageSize":a[3]||(a[3]=s=>_.value.size=s),total:z.value,"page-sizes":[5,10,20],layout:"total, sizes, prev, pager, next",onSizeChange:D,onCurrentChange:D},null,8,["current-page","page-size","total"])])):y("",!0)])),[[b,k.value]])]),_:1})]),_:1},8,["modelValue"])])])}}},_a=se(We,[["__scopeId","data-v-002cfe44"]]);export{_a as default};
