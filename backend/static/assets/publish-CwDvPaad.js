import{_ as N,g as A}from"./index-59OIMCbR.js";/* empty css                *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                        */import{r as p,l as $,B as V,E as u,C as t,D as l,az as q,z as v,Q as i,u as w,K as W,a5 as j,y as G,R as I}from"./vue-vendor-UlW9XFxV.js";import{Y as K,F as Q,H as Y,P as J,W as X,I as Z,a9 as ee,l as te,aa as le,S as oe,T as ae,r as se,ab as ne,B as re,e as ie,E as m}from"./element-plus-5e6ZgU0u.js";import{p as de}from"./community-C3gF1jKv.js";import{g as ue}from"./cat-CoDgQuJ0.js";import"./utils-Yxd-MeZx.js";const pe={class:"publish-page"},me={class:"container-small"},ce={class:"card-header"},fe={class:"cat-option"},_e={__name:"publish",setup(ge){const x=q(),b=p(null),c=p(!1),o=$({type:"PHOTO",title:"",content:"",images:[],catId:null}),U={type:[{required:!0,message:"请选择动态类型",trigger:"change"}],content:[{required:!0,message:"请输入动态内容",trigger:"blur"},{min:10,message:"内容至少10个字符",trigger:"blur"}]},y=p([]),B="https://your-domain.com/api/files/upload/image",k={Authorization:`Bearer ${A()}`},f=p(!1),_=p([]),z=s=>{const e=s.type.startsWith("image/"),n=s.size/1024/1024<5;return e?n?!0:(m.error("图片大小不能超过 5MB"),!1):(m.error("只能上传图片文件"),!1)},O=(s,e,n)=>{if(s.code===200)o.images.push(s.data.fileUrl);else{m.error("上传失败");const r=n.findIndex(g=>g.uid===e.uid);r>-1&&n.splice(r,1)}},R=(s,e)=>{if(s.response&&s.response.code===200){const n=s.response.data.fileUrl,r=o.images.indexOf(n);r>-1&&o.images.splice(r,1)}},T=async s=>{if(!s){_.value=[];return}f.value=!0;try{const e=await ue({keyword:s,pageNum:1,pageSize:20});e.code===200&&(_.value=e.data.records||[])}catch(e){console.error("搜索猫咪失败",e)}finally{f.value=!1}},C=async()=>{if(await b.value.validate().catch(()=>!1)){c.value=!0;try{const e={type:o.type,content:o.content,images:o.images.length>0?o.images:void 0,catId:o.catId||void 0};(await de(e)).code===200&&(m.success("发布成功"),x.push("/community"))}catch(e){m.error(e.message||"发布失败")}finally{c.value=!1}}};return(s,e)=>{const n=ie,r=X,g=J,d=Y,E=Z,h=te,L=ee,S=se,D=re,F=ae,H=oe,P=Q,M=K;return v(),V("div",pe,[u("div",me,[t(M,null,{header:l(()=>[u("div",ce,[e[7]||(e[7]=u("h2",null,"发布动态",-1)),t(n,{onClick:e[0]||(e[0]=a=>s.$router.back())},{default:l(()=>[...e[6]||(e[6]=[i("返回",-1)])]),_:1})])]),default:l(()=>[t(P,{ref_key:"formRef",ref:b,model:o,rules:U,"label-width":"100px","label-position":"top"},{default:l(()=>[t(d,{label:"动态类型",prop:"type"},{default:l(()=>[t(g,{modelValue:o.type,"onUpdate:modelValue":e[1]||(e[1]=a=>o.type=a),size:"large"},{default:l(()=>[t(r,{label:"FEED"},{default:l(()=>[...e[8]||(e[8]=[i("投喂记录",-1)])]),_:1}),t(r,{label:"PHOTO"},{default:l(()=>[...e[9]||(e[9]=[i("猫咪照片",-1)])]),_:1}),t(r,{label:"UPDATE"},{default:l(()=>[...e[10]||(e[10]=[i("近况更新",-1)])]),_:1}),t(r,{label:"OTHER"},{default:l(()=>[...e[11]||(e[11]=[i("其他动态",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"标题（选填）",prop:"title"},{default:l(()=>[t(E,{modelValue:o.title,"onUpdate:modelValue":e[2]||(e[2]=a=>o.title=a),placeholder:"给你的动态起个标题吧（可选）",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(d,{label:"内容",prop:"content"},{default:l(()=>[t(E,{modelValue:o.content,"onUpdate:modelValue":e[3]||(e[3]=a=>o.content=a),type:"textarea",rows:10,placeholder:"分享你和猫咪的故事...",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(d,{label:"图片（最多9张）"},{default:l(()=>[t(L,{"file-list":y.value,"onUpdate:fileList":e[4]||(e[4]=a=>y.value=a),action:B,headers:k,"list-type":"picture-card",limit:9,"on-success":O,"on-remove":R,"before-upload":z},{default:l(()=>[t(h,null,{default:l(()=>[t(w(le))]),_:1})]),_:1},8,["file-list"]),e[12]||(e[12]=u("div",{class:"upload-tip"},"支持jpg、png、gif格式，单张图片不超过5MB",-1))]),_:1}),t(d,{label:"关联猫咪（选填）"},{default:l(()=>[t(H,{modelValue:o.catId,"onUpdate:modelValue":e[5]||(e[5]=a=>o.catId=a),placeholder:"选择要关联的猫咪",clearable:"",filterable:"",remote:"","remote-method":T,loading:f.value,style:{width:"100%"}},{default:l(()=>[(v(!0),V(W,null,j(_.value,a=>(v(),G(F,{key:a.id,label:a.name,value:a.id},{default:l(()=>[u("div",fe,[t(S,{size:32,src:a.coverImage,shape:"square"},{default:l(()=>[t(h,null,{default:l(()=>[t(w(ne))]),_:1})]),_:1},8,["src"]),u("span",null,I(a.name),1),t(D,{size:"small",type:"info"},{default:l(()=>[i(I(a.breed),1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(d,null,{default:l(()=>[t(n,{type:"primary",size:"large",loading:c.value,onClick:C,style:{width:"100%"}},{default:l(()=>[...e[13]||(e[13]=[i(" 发布动态 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])])}}},Te=N(_e,[["__scopeId","data-v-13361114"]]);export{Te as default};
