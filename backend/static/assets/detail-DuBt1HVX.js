import{_ as se,r as ae,u as ne}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                 *//* empty css                *//* empty css                        *//* empty css               *//* empty css                   */import{az as le,r as w,B as m,z as o,K as P,a5 as F,E as s,C as e,D as n,u as _,O as C,R as v,Q as y,aA as ye,c as he,o as ke,M as X,y as x,G as ge,P as Ce}from"./vue-vendor-UlW9XFxV.js";import{a as T,l as oe,J as V,r as ie,q as j,ac as q,I as re,e as ce,y as we,Y as $e,E as f,Z as De,o as Ee,ad as Te,h as Ie,k as xe,ae as be,B as Me,_ as Le,af as He,A as ze,ag as Oe,m as Be,a5 as ee}from"./element-plus-5e6ZgU0u.js";import{c as Re,d as Ue,e as Se,u as Ve,l as Ae,f as te,h as Ne}from"./community-C3gF1jKv.js";import"./utils-Yxd-MeZx.js";const Ye={class:"comment-list"},Pe={class:"comment-main"},Fe={class:"comment-content"},je={class:"comment-header"},qe=["onClick"],Ge={class:"comment-time"},Je={class:"comment-text"},Ke={class:"comment-actions"},Qe=["onClick"],Ze=["onClick"],We={key:0,class:"reply-input-area"},Xe={class:"reply-actions"},et={key:1,class:"reply-list"},tt={class:"reply-content"},st={class:"reply-header"},at=["onClick"],nt={key:0,class:"reply-to"},lt={class:"reply-to-name"},ot={class:"reply-time"},it={class:"reply-text"},rt={class:"reply-actions"},ct=["onClick"],dt=["onClick"],ut={__name:"index",props:{comments:{type:Array,default:()=>[]}},emits:["reply","delete","refresh"],setup(G,{emit:A}){T.extend(ae),T.locale("zh-cn");const b=A,z=le(),M=ne(),$=w(null),h=w(""),k=w(null),a=u=>{if(!u)return"";const i=T(),p=T(u),E=i.diff(p,"hour");return E<1?p.fromNow():E<24?p.format("HH:mm"):E<24*7?p.format("MM-DD HH:mm"):p.format("YYYY-MM-DD")},D=u=>M.userInfo.id===u.userId,g=u=>{u&&z.push(`/user/${u}`)},O=(u,i=null)=>{$.value=u.id,k.value=i||u.id,h.value=""},B=()=>{$.value=null,k.value=null,h.value=""},I=u=>{h.value.trim()&&(b("reply",k.value||u,h.value),B())},R=u=>{b("delete",u)};return(u,i)=>{const p=oe,E=ie,N=re,U=ce;return o(),m("div",Ye,[(o(!0),m(P,null,F(G.comments,c=>(o(),m("div",{key:c.id,class:"comment-item"},[s("div",Pe,[e(E,{size:36,src:c.userAvatar,onClick:r=>g(c.userId),class:"comment-avatar"},{default:n(()=>[e(p,null,{default:n(()=>[e(_(V))]),_:1})]),_:1},8,["src","onClick"]),s("div",Fe,[s("div",je,[s("span",{class:"author-name",onClick:r=>g(c.userId)},v(c.username),9,qe),s("span",Ge,v(a(c.createTime)),1)]),s("div",Je,v(c.content),1),s("div",Ke,[s("span",{class:"action-btn",onClick:r=>O(c)},[e(p,null,{default:n(()=>[e(_(j))]),_:1}),i[1]||(i[1]=y(" 回复 ",-1))],8,Qe),D(c)?(o(),m("span",{key:0,class:"action-btn delete-btn",onClick:r=>R(c.id)},[e(p,null,{default:n(()=>[e(_(q))]),_:1}),i[2]||(i[2]=y(" 删除 ",-1))],8,Ze)):C("",!0)]),$.value===c.id?(o(),m("div",We,[e(N,{modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=r=>h.value=r),type:"textarea",rows:2,placeholder:`回复 @${c.username}`,maxlength:"500"},null,8,["modelValue","placeholder"]),s("div",Xe,[e(U,{size:"small",onClick:B},{default:n(()=>[...i[3]||(i[3]=[y("取消",-1)])]),_:1}),e(U,{type:"primary",size:"small",disabled:!h.value.trim(),onClick:r=>I(c.id)},{default:n(()=>[...i[4]||(i[4]=[y(" 回复 ",-1)])]),_:1},8,["disabled","onClick"])])])):C("",!0),c.children&&c.children.length>0?(o(),m("div",et,[(o(!0),m(P,null,F(c.children,r=>(o(),m("div",{key:r.id,class:"reply-item"},[e(E,{size:28,src:r.userAvatar,onClick:L=>g(r.userId),class:"reply-avatar"},{default:n(()=>[e(p,null,{default:n(()=>[e(_(V))]),_:1})]),_:1},8,["src","onClick"]),s("div",tt,[s("div",st,[s("span",{class:"author-name",onClick:L=>g(r.userId)},v(r.username),9,at),r.replyToUsername?(o(),m("span",nt,[i[5]||(i[5]=y(" 回复 ",-1)),s("span",lt," @"+v(r.replyToUsername),1)])):C("",!0),s("span",ot,v(a(r.createTime)),1)]),s("div",it,v(r.content),1),s("div",rt,[s("span",{class:"action-btn",onClick:L=>O(r,c.id)},[e(p,null,{default:n(()=>[e(_(j))]),_:1}),i[6]||(i[6]=y(" 回复 ",-1))],8,ct),D(r)?(o(),m("span",{key:0,class:"action-btn delete-btn",onClick:L=>R(r.id)},[e(p,null,{default:n(()=>[e(_(q))]),_:1}),i[7]||(i[7]=y(" 删除 ",-1))],8,dt)):C("",!0)])])]))),128))])):C("",!0)])])]))),128))])}}},mt=se(ut,[["__scopeId","data-v-6b12a2b8"]]),_t={class:"detail-page"},vt={class:"container-small"},pt={key:0},ft={class:"dynamic-header"},yt={class:"user-detail"},ht={class:"user-name"},kt={class:"publish-time"},gt={class:"dynamic-content"},Ct={class:"dynamic-text"},wt={key:1,class:"dynamic-images"},$t={class:"cat-info"},Dt={class:"cat-name"},Et={class:"dynamic-actions"},Tt={class:"action-item"},It={class:"comment-header"},xt={class:"comment-input-area"},bt={class:"input-wrapper"},Mt={class:"comment-list"},Lt={__name:"detail",setup(G){T.extend(ae),T.locale("zh-cn");const A=ye(),b=le(),z=ne(),M=w(!1),$=w(!1),h=w(!1),k=A.params.id,a=w(null),D=w([]),g=w(""),O=he(()=>{var t;return z.userInfo.id===((t=a.value)==null?void 0:t.userId)}),B=async()=>{M.value=!0;try{const t=await Re(k);t.code===200&&(a.value=t.data)}catch{f.error("加载动态详情失败")}finally{M.value=!1}},I=async()=>{$.value=!0;try{const t=await Ue({dynamicId:k,page:1,size:999});t.code===200&&(D.value=t.data.records||[])}catch{f.error("加载评论失败")}finally{$.value=!1}},R=t=>{if(!t)return"";const l=T(),d=T(t),H=l.diff(d,"hour");return H<24?d.fromNow():H<24*7?d.format("MM-DD HH:mm"):d.format("YYYY-MM-DD HH:mm")},u=t=>({FEED:"投喂记录",PHOTO:"猫咪照片",UPDATE:"近况更新",HELP:"求助",LOST:"寻猫",FOUND:"招领",OTHER:"其他动态"})[t]||t,i=t=>({FEED:"success",PHOTO:"primary",UPDATE:"warning",HELP:"danger",LOST:"warning",FOUND:"success",OTHER:"info"})[t]||"info",p=()=>{var t;(t=a.value)!=null&&t.userId&&b.push(`/user/${a.value.userId}`)},E=()=>{var t;(t=a.value)!=null&&t.catId&&b.push(`/cats/${a.value.catId}`)},N=async()=>{try{a.value.isLiked?await Ve(k):await Ae(k),a.value.isLiked=!a.value.isLiked,a.value.likeCount+=a.value.isLiked?1:-1}catch(t){f.error(t.message||"操作失败")}},U=()=>{const t=window.location.href;navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{f.success("链接已复制到剪贴板")}).catch(()=>{f.warning("复制失败，请手动复制")}):f.info(`分享链接：${t}`)},c=async()=>{try{await ee.confirm("确定要删除这条动态吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),(await Se(k)).code===200&&(f.success("删除成功"),b.push("/community"))}catch(t){t!=="cancel"&&f.error(t.message||"删除失败")}},r=async()=>{if(g.value.trim()){h.value=!0;try{(await te({dynamicId:k,content:g.value})).code===200&&(f.success("评论成功"),g.value="",I())}catch(t){f.error(t.message||"评论失败")}finally{h.value=!1}}},L=async(t,l)=>{try{(await te({dynamicId:k,parentId:t,content:l})).code===200&&(f.success("回复成功"),I())}catch(d){f.error(d.message||"回复失败")}},de=async t=>{try{await ee.confirm("确定要删除这条评论吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await Ne(t)).code===200&&(f.success("删除成功"),I())}catch(l){l!=="cancel"&&f.error(l.message||"删除失败")}};return ke(()=>{B(),I()}),(t,l)=>{const d=oe,H=ce,J=ie,ue=xe,me=Ie,_e=Ee,Y=be,ve=Me,K=Le,Q=$e,pe=re,fe=Be,Z=we;return o(),m("div",_t,[s("div",vt,[e(H,{class:"back-btn",onClick:l[0]||(l[0]=S=>t.$router.back())},{default:n(()=>[e(d,null,{default:n(()=>[e(_(De))]),_:1}),l[2]||(l[2]=y(" 返回 ",-1))]),_:1}),X((o(),x(Q,{class:"detail-card"},{default:n(()=>[!M.value&&a.value?(o(),m("div",pt,[s("div",ft,[s("div",{class:"user-info",onClick:p},[e(J,{size:50,src:a.value.userAvatar},{default:n(()=>[e(d,null,{default:n(()=>[e(_(V))]),_:1})]),_:1},8,["src"]),s("div",yt,[s("div",ht,v(a.value.username),1),s("div",kt,v(a.value.formattedTime||R(a.value.createTime)),1)])]),O.value?(o(),x(_e,{key:0,trigger:"click"},{dropdown:n(()=>[e(me,null,{default:n(()=>[e(ue,{onClick:c},{default:n(()=>[e(d,null,{default:n(()=>[e(_(q))]),_:1}),l[3]||(l[3]=y(" 删除 ",-1))]),_:1})]),_:1})]),default:n(()=>[e(d,{class:"more-icon"},{default:n(()=>[e(_(Te))]),_:1})]),_:1})):C("",!0)]),e(Y),s("div",gt,[a.value.type?(o(),x(ve,{key:0,type:i(a.value.type),size:"small"},{default:n(()=>[y(v(u(a.value.type)),1)]),_:1},8,["type"])):C("",!0),s("div",Ct,v(a.value.content),1),a.value.images&&a.value.images.length>0?(o(),m("div",wt,[(o(!0),m(P,null,F(a.value.images,(S,W)=>(o(),x(K,{key:W,src:S,"preview-src-list":a.value.images,"initial-index":W,fit:"cover",class:"image-item"},null,8,["src","preview-src-list","initial-index"]))),128))])):C("",!0),a.value.catId?(o(),m("div",{key:2,class:"related-cat",onClick:E},[e(K,{src:a.value.catImage,fit:"cover",class:"cat-image"},null,8,["src"]),s("div",$t,[s("div",Dt,[e(d,null,{default:n(()=>[e(_(He))]),_:1}),y(" "+v(a.value.catName),1)]),l[4]||(l[4]=s("div",{class:"cat-desc"},"查看猫咪档案",-1))]),e(d,{class:"arrow-icon"},{default:n(()=>[e(_(ze))]),_:1})])):C("",!0)]),e(Y),s("div",Et,[s("div",{class:"action-item",onClick:N},[e(d,{class:ge({liked:a.value.isLiked})},{default:n(()=>[(o(),x(Ce(a.value.isLiked?"StarFilled":"Star")))]),_:1},8,["class"]),s("span",null,v(a.value.likeCount||0),1)]),s("div",Tt,[e(d,null,{default:n(()=>[e(_(j))]),_:1}),s("span",null,v(D.value.length),1)]),s("div",{class:"action-item",onClick:U},[e(d,null,{default:n(()=>[e(_(Oe))]),_:1}),l[5]||(l[5]=s("span",null,"分享",-1))])])])):C("",!0)]),_:1})),[[Z,M.value]]),e(Q,{class:"comment-card",id:"comment"},{header:n(()=>[s("div",It,[s("h3",null,"评论 "+v(D.value.length),1)])]),default:n(()=>[s("div",xt,[e(J,{size:40,src:_(z).userInfo.avatar},{default:n(()=>[e(d,null,{default:n(()=>[e(_(V))]),_:1})]),_:1},8,["src"]),s("div",bt,[e(pe,{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=S=>g.value=S),type:"textarea",rows:3,placeholder:"写下你的评论...",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),e(H,{type:"primary",loading:h.value,disabled:!g.value.trim(),onClick:r},{default:n(()=>[...l[6]||(l[6]=[y(" 发表评论 ",-1)])]),_:1},8,["loading","disabled"])])]),e(Y),X((o(),m("div",Mt,[!$.value&&D.value.length===0?(o(),x(fe,{key:0,description:"暂无评论，快来抢沙发吧"})):(o(),x(mt,{key:1,comments:D.value,onReply:L,onDelete:de,onRefresh:I},null,8,["comments"]))])),[[Z,$.value]])]),_:1})])])}}},Pt=se(Lt,[["__scopeId","data-v-c16efeef"]]);export{Pt as default};
