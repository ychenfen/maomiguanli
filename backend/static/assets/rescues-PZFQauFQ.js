import{_ as H,s as V}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                     *//* empty css                 *//* empty css                  *//* empty css                   *//* empty css                             *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";import{Y as K,a6 as W,ar as X,as as Z,B as ee,e as te,y as ae,Q as le,S as oe,T as se,a1 as ne,a2 as ie,F as ue,H as re,I as pe,a5 as de,E as y}from"./element-plus-5e6ZgU0u.js";import{r,w as ce,o as me,B as ve,C as e,D as t,z as E,M as fe,y as C,Q as s,R as i,O as T,E as G}from"./vue-vendor-UlW9XFxV.js";import"./utils-Yxd-MeZx.js";const _e={class:"rescue-manage"},ye={class:"card-header"},Ee={__name:"rescues",setup(ge){const D=r(!1),v=r([]),g=r(""),N=r(1),R=r(10),I=r(0),b=r(!1),f=r(!1),n=r({}),d=r({id:null,note:""}),O=o=>({INJURED:"danger",LOST:"warning",MATERIAL:"info",EMERGENCY:"danger"})[o]||"info",k=o=>({INJURED:"受伤",LOST:"走失",MATERIAL:"物资",EMERGENCY:"紧急"})[o]||o,w=o=>({PENDING:"danger",PROCESSING:"warning",RESOLVED:"success",CLOSED:"info"})[o]||"info",P=o=>({PENDING:"待处理",PROCESSING:"处理中",RESOLVED:"已解决",CLOSED:"已关闭"})[o]||o,_=async()=>{D.value=!0;try{const o=await V.get("/rescue-info/page",{params:{pageNum:N.value,pageSize:R.value,status:g.value||void 0}});o.code===200&&(v.value=o.data.records||o.data,I.value=o.data.total||v.value.length)}catch{v.value=[{id:1,title:"发现受伤流浪猫",type:"INJURED",userName:"王五",location:"图书馆后面草坪",contactPhone:"13800138003",description:"在图书馆后面发现一只流浪猫，腿部好像受伤了。",priority:1,status:"RESOLVED",resolveNote:"已带去宠物医院检查，是轻微扭伤，已处理。",createTime:"2024-10-01 15:00:00"},{id:2,title:"食堂附近有猫咪需要帮助",type:"INJURED",userName:"孙七",location:"第二食堂门口",contactPhone:"13800138005",description:"看到一只猫咪眼睛好像有问题，一直流泪。",priority:1,status:"PROCESSING",createTime:"2024-11-20 09:00:00"},{id:3,title:"宿舍楼下发现小奶猫",type:"LOST",userName:"王五",location:"7号宿舍楼绿化带",contactPhone:"13800138003",description:"在7号宿舍楼下发现一窝小奶猫，大概4只。",priority:0,status:"RESOLVED",resolveNote:"已全部救助，等断奶后开放领养。",createTime:"2024-09-15 18:00:00"},{id:4,title:"需要猫粮物资",type:"MATERIAL",userName:"孙七",location:"志愿者活动中心",contactPhone:"13800138005",description:"最近救助的猫咪比较多，猫粮消耗很快。",priority:0,status:"PENDING",createTime:"2024-12-20 10:00:00"}],I.value=v.value.length}finally{D.value=!1}},z=o=>{n.value=o,b.value=!0},U=async o=>{try{await de.confirm(`确定响应救助信息 "${o.title}" 吗？`,"确认",{type:"info"}),await V.post(`/rescue-info/${o.id}/respond`),y.success("已响应"),_()}catch(a){a!=="cancel"&&(o.status="PROCESSING",y.success("已响应（模拟）"))}},M=o=>{d.value={id:o.id,note:""},n.value=o,f.value=!0},B=async()=>{if(!d.value.note){y.warning("请输入解决说明");return}try{await V.put(`/rescue-info/${d.value.id}/close`,null,{params:{resolveNote:d.value.note}}),y.success("已标记为解决")}catch{y.success("已标记为解决（模拟）")}f.value=!1,_()};return ce(g,()=>{N.value=1,_()}),me(()=>{_()}),(o,a)=>{const S=se,$=oe,p=Z,c=ee,m=te,h=X,A=le,F=K,u=ie,J=ne,x=W,Y=pe,Q=re,j=ue,q=ae;return E(),ve("div",_e,[e(F,null,{header:t(()=>[G("div",ye,[a[8]||(a[8]=G("span",null,"救助处理",-1)),e($,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=l=>g.value=l),placeholder:"状态筛选",clearable:"",style:{width:"120px"}},{default:t(()=>[e(S,{label:"待处理",value:"PENDING"}),e(S,{label:"处理中",value:"PROCESSING"}),e(S,{label:"已解决",value:"RESOLVED"}),e(S,{label:"已关闭",value:"CLOSED"})]),_:1},8,["modelValue"])])]),default:t(()=>[fe((E(),C(h,{data:v.value,style:{width:"100%"}},{default:t(()=>[e(p,{prop:"id",label:"ID",width:"60"}),e(p,{prop:"title",label:"标题","show-overflow-tooltip":""}),e(p,{prop:"type",label:"类型",width:"100"},{default:t(({row:l})=>[e(c,{type:O(l.type)},{default:t(()=>[s(i(k(l.type)),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"发布人",width:"120"},{default:t(({row:l})=>[s(i(l.realName||l.username||"-"),1)]),_:1}),e(p,{prop:"location",label:"地点",width:"150"}),e(p,{prop:"priority",label:"优先级",width:"80"},{default:t(({row:l})=>[e(c,{type:l.priority===1?"danger":"info",size:"small"},{default:t(()=>[s(i(l.priority===1?"紧急":"普通"),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[e(c,{type:w(l.status)},{default:t(()=>[s(i(P(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"createTime",label:"发布时间",width:"160"}),e(p,{label:"操作",fixed:"right",width:"200"},{default:t(({row:l})=>[e(m,{type:"primary",link:"",size:"small",onClick:L=>z(l)},{default:t(()=>[...a[9]||(a[9]=[s("详情",-1)])]),_:1},8,["onClick"]),l.status==="PENDING"?(E(),C(m,{key:0,type:"success",link:"",size:"small",onClick:L=>U(l)},{default:t(()=>[...a[10]||(a[10]=[s("响应",-1)])]),_:1},8,["onClick"])):T("",!0),l.status==="PROCESSING"?(E(),C(m,{key:1,type:"warning",link:"",size:"small",onClick:L=>M(l)},{default:t(()=>[...a[11]||(a[11]=[s("解决",-1)])]),_:1},8,["onClick"])):T("",!0)]),_:1})]),_:1},8,["data"])),[[q,D.value]]),e(A,{"current-page":N.value,"onUpdate:currentPage":a[1]||(a[1]=l=>N.value=l),"page-size":R.value,"onUpdate:pageSize":a[2]||(a[2]=l=>R.value=l),total:I.value,layout:"total, prev, pager, next",style:{"margin-top":"20px","justify-content":"flex-end"},onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1}),e(x,{modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=l=>b.value=l),title:"救助详情",width:"600px"},{footer:t(()=>[e(m,{onClick:a[3]||(a[3]=l=>b.value=!1)},{default:t(()=>[...a[12]||(a[12]=[s("关闭",-1)])]),_:1})]),default:t(()=>[e(J,{column:2,border:""},{default:t(()=>[e(u,{label:"标题",span:2},{default:t(()=>[s(i(n.value.title),1)]),_:1}),e(u,{label:"类型"},{default:t(()=>[e(c,{type:O(n.value.type)},{default:t(()=>[s(i(k(n.value.type)),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"优先级"},{default:t(()=>[e(c,{type:n.value.priority===1?"danger":"info"},{default:t(()=>[s(i(n.value.priority===1?"紧急":"普通"),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"发布人"},{default:t(()=>[s(i(n.value.userName),1)]),_:1}),e(u,{label:"联系电话"},{default:t(()=>[s(i(n.value.contactPhone),1)]),_:1}),e(u,{label:"地点",span:2},{default:t(()=>[s(i(n.value.location),1)]),_:1}),e(u,{label:"描述",span:2},{default:t(()=>[s(i(n.value.description),1)]),_:1}),e(u,{label:"状态"},{default:t(()=>[e(c,{type:w(n.value.status)},{default:t(()=>[s(i(P(n.value.status)),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"发布时间"},{default:t(()=>[s(i(n.value.createTime),1)]),_:1}),n.value.resolveNote?(E(),C(u,{key:0,label:"解决说明",span:2},{default:t(()=>[s(i(n.value.resolveNote),1)]),_:1})):T("",!0)]),_:1})]),_:1},8,["modelValue"]),e(x,{modelValue:f.value,"onUpdate:modelValue":a[7]||(a[7]=l=>f.value=l),title:"标记为已解决",width:"400px"},{footer:t(()=>[e(m,{onClick:a[6]||(a[6]=l=>f.value=!1)},{default:t(()=>[...a[13]||(a[13]=[s("取消",-1)])]),_:1}),e(m,{type:"primary",onClick:B},{default:t(()=>[...a[14]||(a[14]=[s("确认解决",-1)])]),_:1})]),default:t(()=>[e(j,{model:d.value,"label-width":"80px"},{default:t(()=>[e(Q,{label:"解决说明",required:""},{default:t(()=>[e(Y,{modelValue:d.value.note,"onUpdate:modelValue":a[5]||(a[5]=l=>d.value.note=l),type:"textarea",rows:4,placeholder:"请输入解决说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ue=H(Ee,[["__scopeId","data-v-43e77e5f"]]);export{Ue as default};
