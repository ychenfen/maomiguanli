import{_ as L}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                        *//* empty css                   *//* empty css                             *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                             */import{r as c,o as K,B as I,C as t,D as l,z as _,M as Q,E as b,y as g,Q as o,R as s,am as q,O as X}from"./vue-vendor-UlW9XFxV.js";import{d as j,e as H,f as W}from"./finance-BMtOE0MK.js";import{Y as Z,aL as ee,E as P,ar as ae,as as te,B as le,e as oe,y as ne,Q as se,S as ie,T as de,I as ue,aq as pe,a1 as re,a2 as ce,ae as me,_ as _e,m as ve,a5 as fe}from"./element-plus-5e6ZgU0u.js";import"./utils-Yxd-MeZx.js";const ye={class:"finance-admin"},ge={class:"header"},Ee={class:"filters"},be={key:1},ke={class:"pager"},De={__name:"finance",setup(we){const k=c(!1),V=c([]),N=c(0),m=c({page:1,size:10}),u=c({status:"PENDING",type:"",keyword:""}),v=c([]),T=i=>({PENDING:"warning",APPROVED:"success",REJECTED:"danger"})[i]||"info",E=async()=>{var i;k.value=!0;try{const e={pageNum:m.value.page,pageSize:m.value.size,status:u.value.status||void 0,type:u.value.type||void 0,keyword:u.value.keyword||void 0};((i=v.value)==null?void 0:i.length)===2&&(e.startDate=v.value[0],e.endDate=v.value[1]);const d=await j(e);d.code===200&&(V.value=d.data.records||[],N.value=d.data.total||0)}catch(e){P.error((e==null?void 0:e.message)||"加载失败")}finally{k.value=!1}},f=()=>{m.value.page=1,E()},z=i=>window.open(i,"_blank"),D=c(!1),n=c(null),R=async i=>{D.value=!0,n.value=i;try{const e=await H(i.id);e.code===200&&(n.value=e.data)}catch{}},x=async(i,e)=>{const d=e==="APPROVED"?"通过":"拒绝";try{await fe.confirm(`确定要${d}该财务记录吗？`,"提示",{type:"warning"}),(await W(i.id,e)).code===200&&(P.success("已更新"),E())}catch{}};return K(()=>{E()}),(i,e)=>{const d=de,w=ie,B=ue,M=pe,y=oe,p=te,h=le,O=ae,U=se,S=Z,r=ce,G=re,Y=me,$=_e,A=ve,F=ee,J=ne;return _(),I("div",ye,[t(S,null,{header:l(()=>[b("div",ge,[e[8]||(e[8]=b("span",null,"财务管理",-1)),b("div",Ee,[t(w,{modelValue:u.value.status,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.status=a),clearable:"",placeholder:"状态",style:{width:"140px"},onChange:f},{default:l(()=>[t(d,{label:"待审批",value:"PENDING"}),t(d,{label:"已审批",value:"APPROVED"}),t(d,{label:"已拒绝",value:"REJECTED"})]),_:1},8,["modelValue"]),t(w,{modelValue:u.value.type,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.type=a),clearable:"",placeholder:"类型",style:{width:"120px"},onChange:f},{default:l(()=>[t(d,{label:"收入",value:"INCOME"}),t(d,{label:"支出",value:"EXPENSE"})]),_:1},8,["modelValue"]),t(B,{modelValue:u.value.keyword,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.keyword=a),placeholder:"描述关键词",clearable:"",style:{width:"220px"},onKeyup:q(f,["enter"])},null,8,["modelValue"]),t(M,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=a=>v.value=a),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:f},null,8,["modelValue"]),t(y,{type:"primary",onClick:f},{default:l(()=>[...e[7]||(e[7]=[o("查询",-1)])]),_:1})])])]),default:l(()=>[Q((_(),g(O,{data:V.value,style:{width:"100%"}},{default:l(()=>[t(p,{prop:"id",label:"ID",width:"80"}),t(p,{label:"日期",width:"120"},{default:l(({row:a})=>[o(s(a.occurDate||"-"),1)]),_:1}),t(p,{label:"类型",width:"100"},{default:l(({row:a})=>[t(h,{type:a.type==="INCOME"?"success":"danger"},{default:l(()=>[o(s(a.typeText||a.type),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"category",label:"分类",width:"140"}),t(p,{prop:"description",label:"描述","min-width":"220","show-overflow-tooltip":""}),t(p,{label:"金额",width:"140",align:"right"},{default:l(({row:a})=>[o("¥"+s(a.amount??0),1)]),_:1}),t(p,{label:"状态",width:"120"},{default:l(({row:a})=>[t(h,{type:T(a.status)},{default:l(()=>[o(s(a.statusText||a.status),1)]),_:2},1032,["type"])]),_:1}),t(p,{label:"凭证",width:"90",align:"center"},{default:l(({row:a})=>[a.receiptImage?(_(),g(y,{key:0,link:"",type:"primary",onClick:C=>z(a.receiptImage)},{default:l(()=>[...e[9]||(e[9]=[o("查看",-1)])]),_:1},8,["onClick"])):(_(),I("span",be,"-"))]),_:1}),t(p,{label:"操作",width:"220",fixed:"right"},{default:l(({row:a})=>[t(y,{link:"",type:"primary",onClick:C=>R(a)},{default:l(()=>[...e[10]||(e[10]=[o("详情",-1)])]),_:1},8,["onClick"]),t(y,{link:"",type:"success",disabled:a.status!=="PENDING",onClick:C=>x(a,"APPROVED")},{default:l(()=>[...e[11]||(e[11]=[o("通过",-1)])]),_:1},8,["disabled","onClick"]),t(y,{link:"",type:"danger",disabled:a.status!=="PENDING",onClick:C=>x(a,"REJECTED")},{default:l(()=>[...e[12]||(e[12]=[o("拒绝",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[J,k.value]]),b("div",ke,[t(U,{"current-page":m.value.page,"onUpdate:currentPage":e[4]||(e[4]=a=>m.value.page=a),"page-size":m.value.size,"onUpdate:pageSize":e[5]||(e[5]=a=>m.value.size=a),total:N.value,layout:"total, prev, pager, next",onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),t(F,{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=a=>D.value=a),title:"财务详情",size:"720px"},{default:l(()=>{var a;return[n.value?(_(),g(G,{key:0,column:2,border:""},{default:l(()=>[t(r,{label:"类型"},{default:l(()=>[o(s(n.value.typeText||n.value.type),1)]),_:1}),t(r,{label:"分类"},{default:l(()=>[o(s(n.value.category),1)]),_:1}),t(r,{label:"金额"},{default:l(()=>[o("¥"+s(n.value.amount??0),1)]),_:1}),t(r,{label:"状态"},{default:l(()=>[o(s(n.value.statusText||n.value.status),1)]),_:1}),t(r,{label:"发生日期"},{default:l(()=>[o(s(n.value.occurDate||"-"),1)]),_:1}),t(r,{label:"创建时间"},{default:l(()=>[o(s(n.value.createTime||"-"),1)]),_:1}),t(r,{label:"创建人"},{default:l(()=>[o(s(n.value.createUserName||"-"),1)]),_:1}),t(r,{label:"审批人"},{default:l(()=>[o(s(n.value.approverName||"-"),1)]),_:1}),t(r,{label:"描述",span:2},{default:l(()=>[o(s(n.value.description||"-"),1)]),_:1})]),_:1})):X("",!0),t(Y),(a=n.value)!=null&&a.receiptImage?(_(),g($,{key:1,src:n.value.receiptImage,fit:"contain",style:{width:"100%","max-height":"420px"}},null,8,["src"])):(_(),g(A,{key:2,description:"无凭证图片"}))]}),_:1},8,["modelValue"])])}}},Je=L(De,[["__scopeId","data-v-c2b59558"]]);export{Je as default};
