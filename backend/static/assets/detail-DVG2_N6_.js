import{u as le}from"./index-B8C77IZt.js";/* empty css                   *//* empty css                 *//* empty css                 *//* empty css                *//* empty css                        *//* empty css               *//* empty css                   */import{aA as ie,r as E,z as v,A as i,Q,a6 as X,B as a,R as t,J as o,u as _,L as w,P as u,O as h,aB as ge,c as Ce,j as we,K as se,I as L,E as $e,M as Ee}from"./vue-vendor-L7KxampG.js";import{g as I,k as re,w as P,a as ce,p as J,a3 as K,u as de,e as ue,v as De,O as xe,E as f,P as be,d as Ie,a1 as Te,b as Me,c as Le,a2 as Re,ac as ze,m as Be,Q as Ne,a5 as Se,l as Ve,a6 as Ye,H as He,_ as ne}from"./element-plus-o-j_G_-z.js";import{c as Ae,e as Oe,d as Pe,u as Ue,l as je,f as oe,h as Fe}from"./community-Chh_JOHn.js";import{r as me}from"./zh-cn-qMXBDFIZ.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCXpdI6d.js";const Qe={class:"comment-list"},Xe={class:"comment-main"},Je={class:"comment-content"},Ke={class:"comment-header"},qe=["onClick"],Ge={class:"comment-time"},We={class:"comment-text"},Ze={class:"comment-actions"},et=["onClick"],tt=["onClick"],at={key:0,class:"reply-input-area"},st={class:"reply-actions"},nt={key:1,class:"reply-list"},ot={class:"reply-content"},lt={class:"reply-header"},it=["onClick"],rt={key:0,class:"reply-to"},ct=["onClick"],dt={class:"reply-time"},ut={class:"reply-text"},mt={class:"reply-actions"},_t=["onClick"],vt=["onClick"],pt={__name:"index",props:{comments:{type:Array,default:()=>[]}},emits:["reply","delete","refresh"],setup(q,{emit:U}){I.extend(me),I.locale("zh-cn");const T=U,B=ie(),R=le(),D=E(null),g=E(""),y=E(null),s=m=>{if(!m)return"";const l=I(),p=I(m),b=l.diff(p,"hour");return b<1?p.fromNow():b<24?p.format("HH:mm"):b<24*7?p.format("MM-DD HH:mm"):p.format("YYYY-MM-DD")},x=m=>{var l;return R.userInfo.id===((l=m.author)==null?void 0:l.id)},k=m=>{m&&B.push(`/user/${m}`)},N=(m,l=null)=>{D.value=m.id,y.value=l||m.id,g.value=""},S=()=>{D.value=null,y.value=null,g.value=""},M=m=>{g.value.trim()&&(T("reply",y.value||m,g.value),S())},V=m=>{T("delete",m)};return(m,l)=>{const p=re,b=ce,j=de,Y=ue;return i(),v("div",Qe,[(i(!0),v(Q,null,X(q.comments,d=>{var H,A,O;return i(),v("div",{key:d.id,class:"comment-item"},[a("div",Xe,[t(b,{size:36,src:(H=d.author)==null?void 0:H.avatar,onClick:r=>{var e;return k((e=d.author)==null?void 0:e.id)},class:"comment-avatar"},{default:o(()=>[t(p,null,{default:o(()=>[t(_(P))]),_:1})]),_:1},8,["src","onClick"]),a("div",Je,[a("div",Ke,[a("span",{class:"author-name",onClick:r=>{var e;return k((e=d.author)==null?void 0:e.id)}},u((A=d.author)==null?void 0:A.username),9,qe),a("span",Ge,u(s(d.createTime)),1)]),a("div",We,u(d.content),1),a("div",Ze,[a("span",{class:"action-btn",onClick:r=>N(d)},[t(p,null,{default:o(()=>[t(_(J))]),_:1}),l[1]||(l[1]=h(" 回复 ",-1))],8,et),x(d)?(i(),v("span",{key:0,class:"action-btn delete-btn",onClick:r=>V(d.id)},[t(p,null,{default:o(()=>[t(_(K))]),_:1}),l[2]||(l[2]=h(" 删除 ",-1))],8,tt)):w("",!0)]),D.value===d.id?(i(),v("div",at,[t(j,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=r=>g.value=r),type:"textarea",rows:2,placeholder:`回复 @${(O=d.author)==null?void 0:O.username}`,maxlength:"500"},null,8,["modelValue","placeholder"]),a("div",st,[t(Y,{size:"small",onClick:S},{default:o(()=>[...l[3]||(l[3]=[h("取消",-1)])]),_:1}),t(Y,{type:"primary",size:"small",disabled:!g.value.trim(),onClick:r=>M(d.id)},{default:o(()=>[...l[4]||(l[4]=[h(" 回复 ",-1)])]),_:1},8,["disabled","onClick"])])])):w("",!0),d.replies&&d.replies.length>0?(i(),v("div",nt,[(i(!0),v(Q,null,X(d.replies,r=>{var e,n,c;return i(),v("div",{key:r.id,class:"reply-item"},[t(b,{size:28,src:(e=r.author)==null?void 0:e.avatar,onClick:$=>{var C;return k((C=r.author)==null?void 0:C.id)},class:"reply-avatar"},{default:o(()=>[t(p,null,{default:o(()=>[t(_(P))]),_:1})]),_:1},8,["src","onClick"]),a("div",ot,[a("div",lt,[a("span",{class:"author-name",onClick:$=>{var C;return k((C=r.author)==null?void 0:C.id)}},u((n=r.author)==null?void 0:n.username),9,it),r.replyTo?(i(),v("span",rt,[l[5]||(l[5]=h(" 回复 ",-1)),a("span",{class:"reply-to-name",onClick:$=>{var C;return k((C=r.replyTo)==null?void 0:C.id)}}," @"+u((c=r.replyTo)==null?void 0:c.username),9,ct)])):w("",!0),a("span",dt,u(s(r.createTime)),1)]),a("div",ut,u(r.content),1),a("div",mt,[a("span",{class:"action-btn",onClick:$=>N(r,d.id)},[t(p,null,{default:o(()=>[t(_(J))]),_:1}),l[6]||(l[6]=h(" 回复 ",-1))],8,_t),x(r)?(i(),v("span",{key:0,class:"action-btn delete-btn",onClick:$=>V(r.id)},[t(p,null,{default:o(()=>[t(_(K))]),_:1}),l[7]||(l[7]=h(" 删除 ",-1))],8,vt)):w("",!0)])])])}),128))])):w("",!0)])])])}),128))])}}},ft=_e(pt,[["__scopeId","data-v-20a2a630"]]),ht={class:"detail-page"},yt={class:"container-small"},kt={key:0},gt={class:"dynamic-header"},Ct={class:"user-detail"},wt={class:"user-name"},$t={class:"publish-time"},Et={class:"dynamic-content"},Dt={key:1,class:"dynamic-title"},xt={class:"dynamic-text"},bt={key:2,class:"dynamic-images"},It={class:"cat-info"},Tt={class:"cat-name"},Mt={class:"cat-desc"},Lt={class:"dynamic-actions"},Rt={class:"action-item"},zt={class:"comment-header"},Bt={class:"comment-input-area"},Nt={class:"input-wrapper"},St={class:"comment-list"},Vt={__name:"detail",setup(q){I.extend(me),I.locale("zh-cn");const U=ge(),T=ie(),B=le(),R=E(!1),D=E(!1),g=E(!1),y=U.params.id,s=E(null),x=E([]),k=E(""),N=Ce(()=>{var e,n;return B.userInfo.id===((n=(e=s.value)==null?void 0:e.author)==null?void 0:n.id)}),S=async()=>{R.value=!0;try{const e=await Ae(y);e.code===200&&(s.value=e.data)}catch{f.error("加载动态详情失败")}finally{R.value=!1}},M=async()=>{D.value=!0;try{const e=await Oe({dynamicId:y,page:1,size:999});e.code===200&&(x.value=e.data.records||[])}catch{f.error("加载评论失败")}finally{D.value=!1}},V=e=>{if(!e)return"";const n=I(),c=I(e),$=n.diff(c,"hour");return $<24?c.fromNow():$<24*7?c.format("MM-DD HH:mm"):c.format("YYYY-MM-DD HH:mm")},m=e=>({ADOPTION:"领养分享",DAILY:"日常记录",RESCUE:"救助故事",EXPERIENCE:"养猫经验"})[e]||e,l=e=>({ADOPTION:"success",DAILY:"primary",RESCUE:"warning",EXPERIENCE:"info"})[e]||"info",p=()=>{var e,n;(n=(e=s.value)==null?void 0:e.author)!=null&&n.id&&T.push(`/user/${s.value.author.id}`)},b=()=>{var e,n;(n=(e=s.value)==null?void 0:e.cat)!=null&&n.id&&T.push(`/cats/${s.value.cat.id}`)},j=async()=>{try{s.value.isLiked?await Ue(y):await je(y),s.value.isLiked=!s.value.isLiked,s.value.likeCount+=s.value.isLiked?1:-1}catch(e){f.error(e.message||"操作失败")}},Y=()=>{const e=window.location.href;navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{f.success("链接已复制到剪贴板")}).catch(()=>{f.warning("复制失败，请手动复制")}):f.info(`分享链接：${e}`)},d=()=>{T.push(`/community/edit/${y}`)},H=async()=>{try{await ne.confirm("确定要删除这条动态吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),(await Pe(y)).code===200&&(f.success("删除成功"),T.push("/community"))}catch(e){e!=="cancel"&&f.error(e.message||"删除失败")}},A=async()=>{if(k.value.trim()){g.value=!0;try{(await oe({dynamicId:y,content:k.value})).code===200&&(f.success("评论成功"),k.value="",M())}catch(e){f.error(e.message||"评论失败")}finally{g.value=!1}}},O=async(e,n)=>{try{(await oe({dynamicId:y,parentId:e,content:n})).code===200&&(f.success("回复成功"),M())}catch(c){f.error(c.message||"回复失败")}},r=async e=>{try{await ne.confirm("确定要删除这条评论吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await Fe(e)).code===200&&(f.success("删除成功"),M())}catch(n){n!=="cancel"&&f.error(n.message||"删除失败")}};return we(()=>{S(),M()}),(e,n)=>{const c=re,$=ue,C=ce,G=Le,ve=Me,pe=Ie,F=ze,fe=Be,W=Ne,Z=xe,he=de,ye=He,ee=De;return i(),v("div",ht,[a("div",yt,[t($,{class:"back-btn",onClick:n[0]||(n[0]=z=>e.$router.back())},{default:o(()=>[t(c,null,{default:o(()=>[t(_(be))]),_:1}),n[2]||(n[2]=h(" 返回 ",-1))]),_:1}),se((i(),L(Z,{class:"detail-card"},{default:o(()=>{var z,te;return[!R.value&&s.value?(i(),v("div",kt,[a("div",gt,[a("div",{class:"user-info",onClick:p},[t(C,{size:50,src:(z=s.value.author)==null?void 0:z.avatar},{default:o(()=>[t(c,null,{default:o(()=>[t(_(P))]),_:1})]),_:1},8,["src"]),a("div",Ct,[a("div",wt,u((te=s.value.author)==null?void 0:te.username),1),a("div",$t,u(V(s.value.createTime)),1)])]),N.value?(i(),L(pe,{key:0,trigger:"click"},{dropdown:o(()=>[t(ve,null,{default:o(()=>[t(G,{onClick:d},{default:o(()=>[t(c,null,{default:o(()=>[t(_(Re))]),_:1}),n[3]||(n[3]=h(" 编辑 ",-1))]),_:1}),t(G,{onClick:H},{default:o(()=>[t(c,null,{default:o(()=>[t(_(K))]),_:1}),n[4]||(n[4]=h(" 删除 ",-1))]),_:1})]),_:1})]),default:o(()=>[t(c,{class:"more-icon"},{default:o(()=>[t(_(Te))]),_:1})]),_:1})):w("",!0)]),t(F),a("div",Et,[s.value.type?(i(),L(fe,{key:0,type:l(s.value.type),size:"small"},{default:o(()=>[h(u(m(s.value.type)),1)]),_:1},8,["type"])):w("",!0),s.value.title?(i(),v("h1",Dt,u(s.value.title),1)):w("",!0),a("div",xt,u(s.value.content),1),s.value.images&&s.value.images.length>0?(i(),v("div",bt,[(i(!0),v(Q,null,X(s.value.images,(ke,ae)=>(i(),L(W,{key:ae,src:ke,"preview-src-list":s.value.images,"initial-index":ae,fit:"cover",class:"image-item"},null,8,["src","preview-src-list","initial-index"]))),128))])):w("",!0),s.value.cat?(i(),v("div",{key:3,class:"related-cat",onClick:b},[t(W,{src:s.value.cat.coverImage,fit:"cover",class:"cat-image"},null,8,["src"]),a("div",It,[a("div",Tt,[t(c,null,{default:o(()=>[t(_(Se))]),_:1}),h(" "+u(s.value.cat.name),1)]),a("div",Mt,u(s.value.cat.breed)+" · "+u(s.value.cat.age),1)]),t(c,{class:"arrow-icon"},{default:o(()=>[t(_(Ve))]),_:1})])):w("",!0)]),t(F),a("div",Lt,[a("div",{class:"action-item",onClick:j},[t(c,{class:$e({liked:s.value.isLiked})},{default:o(()=>[(i(),L(Ee(s.value.isLiked?"StarFilled":"Star")))]),_:1},8,["class"]),a("span",null,u(s.value.likeCount||0),1)]),a("div",Rt,[t(c,null,{default:o(()=>[t(_(J))]),_:1}),a("span",null,u(x.value.length),1)]),a("div",{class:"action-item",onClick:Y},[t(c,null,{default:o(()=>[t(_(Ye))]),_:1}),n[5]||(n[5]=a("span",null,"分享",-1))])])])):w("",!0)]}),_:1})),[[ee,R.value]]),t(Z,{class:"comment-card",id:"comment"},{header:o(()=>[a("div",zt,[a("h3",null,"评论 "+u(x.value.length),1)])]),default:o(()=>[a("div",Bt,[t(C,{size:40,src:_(B).userInfo.avatar},{default:o(()=>[t(c,null,{default:o(()=>[t(_(P))]),_:1})]),_:1},8,["src"]),a("div",Nt,[t(he,{modelValue:k.value,"onUpdate:modelValue":n[1]||(n[1]=z=>k.value=z),type:"textarea",rows:3,placeholder:"写下你的评论...",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),t($,{type:"primary",loading:g.value,disabled:!k.value.trim(),onClick:A},{default:o(()=>[...n[6]||(n[6]=[h(" 发表评论 ",-1)])]),_:1},8,["loading","disabled"])])]),t(F),se((i(),v("div",St,[!D.value&&x.value.length===0?(i(),L(ye,{key:0,description:"暂无评论，快来抢沙发吧"})):(i(),L(ft,{key:1,comments:x.value,onReply:O,onDelete:r,onRefresh:M},null,8,["comments"]))])),[[ee,D.value]])]),_:1})])])}}},Wt=_e(Vt,[["__scopeId","data-v-8620ca68"]]);export{Wt as default};
