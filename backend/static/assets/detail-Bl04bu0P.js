import{_ as _e}from"./index-59OIMCbR.js";/* empty css                   *//* empty css               *//* empty css                    *//* empty css                 *//* empty css                    *//* empty css                *//* empty css                    *//* empty css                        *//* empty css                           */import{r as _,c as ve,o as pe,aA as fe,M,B as m,E as s,C as t,D as o,az as ge,z as i,Q as b,u as d,G as P,R as r,O as N,K as V,a5 as I,y as k,S}from"./vue-vendor-UlW9XFxV.js";import{y as ye,an as he,R as be,E as v,ao as ke,X as Ae,Y as we,_ as Ce,l as Ee,ab as De,al as Te,J as x,ah as Me,r as Ne,A as Ve,m as Ie,at as xe,au as Le,I as ze,L as Re,e as Ue,av as Ye,G as Be,q as $e,ag as Pe,aw as Se,a as L}from"./element-plus-5e6ZgU0u.js";import{b as Fe}from"./crowdfunding-Dg2TszRA.js";import{g as He,a as Oe,c as Ke}from"./donation-CRMemvw3.js";import"./utils-Yxd-MeZx.js";const We={class:"crowdfunding-detail"},qe={class:"container"},Ge={class:"cover-wrapper"},Je={class:"image-error"},Qe={class:"project-info"},Xe={class:"project-title"},Ze={class:"progress-section"},je={class:"amount-info"},es={class:"raised"},ss={class:"number"},ts={class:"target"},as={class:"stats-row"},os={class:"stat-item"},ns={class:"stat-item"},ls={class:"creator-info"},rs={class:"creator-detail"},us={class:"creator-name"},is={class:"create-time"},cs={class:"detail-content"},ds={class:"description-section"},ms=["innerHTML"],_s={key:0,class:"cat-section"},vs={class:"cat-info"},ps={class:"cat-name"},fs={key:1,class:"images-section"},gs={class:"project-images"},ys={class:"progress-content"},hs={class:"progress-text"},bs={class:"progress-meta"},ks={class:"supporters-content"},As={key:0,class:"supporters-list"},ws={class:"supporter-info"},Cs={class:"supporter-name"},Es={key:0,class:"supporter-message"},Ds={class:"supporter-amount"},Ts={class:"supporter-time"},Ms={class:"amount-options"},Ns=["onClick"],Vs={class:"card-header"},Is={class:"ranking-list"},xs={class:"name"},Ls={class:"amount"},zs={class:"share-buttons"},Rs={__name:"detail",setup(Us){const F=fe(),q=ge(),z=_(!1),l=_({}),p=_("detail"),R=_([]),A=_([]),G=[10,30,50,100,200,500],g=_(50),y=_(""),w=_(""),C=_(!1),J=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],E=ve(()=>g.value||y.value||0),H=async()=>{z.value=!0;try{const a=F.params.id,e=await Fe(a);e.code===200&&(l.value=e.data,Q())}catch(a){console.error("加载项目详情失败",a),v.error("加载项目详情失败"),l.value={}}finally{z.value=!1}},Q=async()=>{try{const[a,e]=await Promise.all([He(l.value.id),Oe(l.value.id,10)]);a.code===200&&(R.value=Array.isArray(a.data)?a.data:[]),e.code===200?A.value=(Array.isArray(e.data)?e.data:[]).map(c=>({userId:c.userId,username:c.username,userAvatar:c.userAvatar,isAnonymous:!!c.isAnonymous,totalAmount:Number(c.amount||0)})):A.value=[]}catch(a){console.error("加载支持记录失败",a)}},X=a=>{g.value=a,y.value=""},Z=async()=>{if(!E.value||E.value<=0){v.warning("请选择或输入支持金额");return}try{(await Ke({crowdfundingId:l.value.id,amount:E.value,message:w.value||"",isAnonymous:C.value,paymentMethod:"MOCK"})).code===200&&(v.success("感谢您的支持！"),w.value="",y.value="",g.value=50,C.value=!1,await H())}catch(a){v.error((a==null?void 0:a.message)||"支持失败")}},j=a=>{if(a.progress!=null)return Number(a.progress)||0;const e=Number(a.targetAmount||0),c=Number(a.currentAmount||0);return e?Math.min(Math.round(c/e*100),100):0},ee=a=>{const e=a==null?void 0:a.remainingDays;if(e!=null){const u=Number(e);return Number.isFinite(u)?u<=0?"已结束":`剩余 ${u} 天`:"—"}const c=a==null?void 0:a.endDate;if(!c)return"—";const D=L(c).diff(L(),"day");return D<=0?"已结束":`剩余 ${D} 天`},se=a=>({DRAFT:"草稿",ACTIVE:"进行中",COMPLETED:"已完成",FAILED:"未达标",CANCELLED:"已取消"})[a]||a,O=a=>a?L(a).format("YYYY-MM-DD"):"",te=a=>a?L(a).format("YYYY-MM-DD HH:mm"):"",ae=a=>a?a.replace(/\n/g,"<br>"):"",oe=a=>{q.push(`/cats/${a}`)},ne=()=>{v.info("请使用微信扫描分享")},le=()=>{v.info("分享到微博")},re=()=>{var e;const a=window.location.href;(e=navigator.clipboard)==null||e.writeText(a),v.success("链接已复制")};return pe(()=>{H(),F.query.action==="donate"&&(p.value="detail")}),(a,e)=>{const c=ke,D=he,u=Ee,U=Ce,ue=Te,Y=Ne,f=we,B=Le,ie=xe,$=Ie,K=Ae,W=ze,ce=Re,T=Ue,de=be,me=ye;return M((i(),m("div",We,[s("div",qe,[t(D,{separator:"/",class:"breadcrumb"},{default:o(()=>[t(c,{to:{path:"/crowdfunding"}},{default:o(()=>[...e[6]||(e[6]=[b("爱心众筹",-1)])]),_:1}),t(c,null,{default:o(()=>[...e[7]||(e[7]=[b("项目详情",-1)])]),_:1})]),_:1}),t(de,{gutter:32},{default:o(()=>[t(K,{xs:24,lg:16},{default:o(()=>[t(f,{class:"project-header"},{default:o(()=>[s("div",Ge,[t(U,{src:l.value.coverImage,fit:"cover",class:"cover-image"},{error:o(()=>[s("div",Je,[t(u,{size:"60"},{default:o(()=>[t(d(De))]),_:1})])]),_:1},8,["src"]),s("div",{class:P(["status-tag",`status-${(l.value.status||"UNKNOWN").toLowerCase()}`])},r(se(l.value.status)),3)]),s("div",Qe,[s("h1",Xe,r(l.value.title),1),s("div",Ze,[s("div",je,[s("span",es,[e[8]||(e[8]=s("span",{class:"currency"},"¥",-1)),s("span",ss,r(Number(l.value.currentAmount||0).toLocaleString()),1)]),s("span",ts,"目标 ¥"+r(Number(l.value.targetAmount||0).toLocaleString()),1)]),t(ue,{percentage:j(l.value),"stroke-width":12,color:J},null,8,["percentage"]),s("div",as,[s("div",os,[t(u,null,{default:o(()=>[t(d(x))]),_:1}),s("span",null,r(l.value.supporterCount||0)+" 人支持",1)]),s("div",ns,[t(u,null,{default:o(()=>[t(d(Me))]),_:1}),s("span",null,r(ee(l.value)),1)])])]),s("div",ls,[t(Y,{size:48,src:l.value.creatorAvatar},{default:o(()=>[t(u,null,{default:o(()=>[t(d(x))]),_:1})]),_:1},8,["src"]),s("div",rs,[s("span",us,r(l.value.creatorName||"匿名"),1),e[9]||(e[9]=s("span",{class:"creator-label"},"发起人",-1))]),s("span",is,r(O(l.value.createTime))+" 发起",1)])])]),_:1}),t(f,{class:"content-card"},{header:o(()=>[t(ie,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=n=>p.value=n)},{default:o(()=>[t(B,{label:"项目详情",name:"detail"}),t(B,{label:"项目进展",name:"progress"}),t(B,{label:"支持记录",name:"supporters"})]),_:1},8,["modelValue"])]),default:o(()=>[M(s("div",cs,[s("div",ds,[e[10]||(e[10]=s("h3",null,"项目描述",-1)),s("div",{class:"description-text",innerHTML:ae(l.value.description)},null,8,ms)]),l.value.catId?(i(),m("div",_s,[e[11]||(e[11]=s("h3",null,"关联猫咪",-1)),s("div",{class:"cat-card",onClick:e[1]||(e[1]=n=>oe(l.value.catId))},[t(U,{src:l.value.catCoverImage,fit:"cover",class:"cat-image"},null,8,["src"]),s("div",vs,[s("span",ps,r(l.value.catName),1)]),t(u,{class:"arrow"},{default:o(()=>[t(d(Ve))]),_:1})])])):N("",!0),Array.isArray(l.value.imageUrls)&&l.value.imageUrls.length?(i(),m("div",fs,[e[12]||(e[12]=s("h3",null,"项目图片",-1)),s("div",gs,[(i(!0),m(V,null,I(l.value.imageUrls,(n,h)=>(i(),k(U,{key:h,src:n,fit:"cover","preview-src-list":l.value.imageUrls,class:"project-image"},null,8,["src","preview-src-list"]))),128))])])):N("",!0)],512),[[S,p.value==="detail"]]),M(s("div",ys,[l.value.updateMessage?(i(),k(f,{key:1,class:"progress-card"},{default:o(()=>[s("div",hs,r(l.value.updateMessage),1),s("div",bs,[s("span",null,"更新时间："+r(te(l.value.updateTime)),1)])]),_:1})):(i(),k($,{key:0,description:"暂无项目进展"}))],512),[[S,p.value==="progress"]]),M(s("div",ks,[R.value.length>0?(i(),m("div",As,[(i(!0),m(V,null,I(R.value,n=>(i(),m("div",{key:n.id,class:"supporter-item"},[t(Y,{size:40,src:n.userAvatar},{default:o(()=>[t(u,null,{default:o(()=>[t(d(x))]),_:1})]),_:1},8,["src"]),s("div",ws,[s("span",Cs,r(n.isAnonymous?"匿名好心人":n.username),1),n.message?(i(),m("span",Es,r(n.message),1)):N("",!0)]),s("div",Ds," ¥"+r(n.amount),1),s("span",Ts,r(O(n.createTime)),1)]))),128))])):(i(),k($,{key:1,description:"暂无支持记录"}))],512),[[S,p.value==="supporters"]])]),_:1})]),_:1}),t(K,{xs:24,lg:8},{default:o(()=>[t(f,{class:"donate-panel"},{default:o(()=>[e[15]||(e[15]=s("h3",null,"支持此项目",-1)),s("div",Ms,[(i(),m(V,null,I(G,n=>s("div",{key:n,class:P(["amount-option",{active:g.value===n}]),onClick:h=>X(n)}," ¥"+r(n),11,Ns)),64))]),t(W,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=n=>y.value=n),modelModifiers:{number:!0},placeholder:"自定义金额",class:"custom-amount",onFocus:e[3]||(e[3]=n=>g.value=null)},{prefix:o(()=>[...e[13]||(e[13]=[b("¥",-1)])]),_:1},8,["modelValue"]),t(W,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=n=>w.value=n),type:"textarea",rows:3,placeholder:"给发起人留言（选填）",maxlength:"200","show-word-limit":"",class:"donate-message"},null,8,["modelValue"]),t(ce,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=n=>C.value=n),class:"anonymous-check"},{default:o(()=>[...e[14]||(e[14]=[b(" 匿名支持 ",-1)])]),_:1},8,["modelValue"]),t(T,{type:"primary",size:"large",round:"",class:"donate-btn",disabled:l.value.status!=="ACTIVE",onClick:Z},{default:o(()=>[t(u,null,{default:o(()=>[t(d(Ye))]),_:1}),b(" 立即支持 ¥"+r(E.value||0),1)]),_:1},8,["disabled"]),e[16]||(e[16]=s("p",{class:"donate-tip"},"支持即表示同意《用户协议》和《隐私政策》",-1))]),_:1}),t(f,{class:"ranking-card"},{header:o(()=>[s("div",Vs,[t(u,null,{default:o(()=>[t(d(Be))]),_:1}),e[17]||(e[17]=s("span",null,"爱心排行榜",-1))])]),default:o(()=>[s("div",Is,[(i(!0),m(V,null,I(A.value,(n,h)=>(i(),m("div",{key:n.id,class:"ranking-item"},[s("span",{class:P(["rank",`rank-${h+1}`])},r(h+1),3),t(Y,{size:32,src:n.userAvatar},{default:o(()=>[t(u,null,{default:o(()=>[t(d(x))]),_:1})]),_:1},8,["src"]),s("span",xs,r(n.isAnonymous?"匿名":n.username),1),s("span",Ls,"¥"+r(n.totalAmount),1)]))),128)),A.value.length===0?(i(),k($,{key:0,description:"暂无数据","image-size":60})):N("",!0)])]),_:1}),t(f,{class:"share-card"},{header:o(()=>[...e[18]||(e[18]=[s("span",null,"分享项目",-1)])]),default:o(()=>[s("div",zs,[t(T,{circle:"",onClick:ne},{default:o(()=>[t(u,null,{default:o(()=>[t(d($e))]),_:1})]),_:1}),t(T,{circle:"",onClick:le},{default:o(()=>[t(u,null,{default:o(()=>[t(d(Pe))]),_:1})]),_:1}),t(T,{circle:"",onClick:re},{default:o(()=>[t(u,null,{default:o(()=>[t(d(Se))]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})])])),[[me,z.value]])}}},Zs=_e(Rs,[["__scopeId","data-v-b5ab5245"]]);export{Zs as default};
