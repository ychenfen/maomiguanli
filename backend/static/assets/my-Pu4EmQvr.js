import{_ as ae}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                    *//* empty css                        *//* empty css               *//* empty css                */import{r as u,c as B,o as le,B as b,E as n,C as a,M as N,D as s,u as g,az as ne,y as w,z as r,Q as o,R as d,O as S}from"./vue-vendor-UlW9XFxV.js";import{d as oe,e as ie,f as de,h as ue,i as re}from"./crowdfunding-Dg2TszRA.js";import{e as pe,y as ce,a6 as me,R as ve,Y as ge,E as f,X as fe,m as _e,ar as ye,as as Ce,_ as Ee,al as ke,B as be,Q as we,F as xe,H as De,I as Te,a5 as U}from"./element-plus-5e6ZgU0u.js";import"./utils-Yxd-MeZx.js";const Ae={class:"crowdfunding-my"},Ve={class:"container"},ze={class:"page-header"},Le={class:"actions"},Ie={class:"num"},$e={class:"num"},Pe={class:"num"},Fe={class:"num"},Me={class:"card-header"},Re=["onClick"],Be={class:"meta"},Ne={class:"name"},Se={class:"sub"},Ue={class:"muted"},he={key:0},Oe={key:1},Qe={key:2},je={key:2,class:"pagination-wrapper"},He={__name:"my",setup(Xe){const m=ne(),x=u(!1),A=u(!1),D=u([]),v=u({}),p=u({page:1,size:10}),I=B(()=>D.value.length),$=B(()=>{const l=(p.value.page-1)*p.value.size;return D.value.slice(l,l+p.value.size)}),h=l=>({DRAFT:"草稿",ACTIVE:"进行中",COMPLETED:"已完成",FAILED:"未达标",CANCELLED:"已取消"})[l]||l,O=l=>({DRAFT:"info",ACTIVE:"success",COMPLETED:"success",FAILED:"danger",CANCELLED:"info"})[l]||"info",Q=async()=>{A.value=!0;try{const l=await oe();l.code===200&&(v.value=l.data||{})}catch{v.value={}}finally{A.value=!1}},j=async()=>{x.value=!0;try{const l=await ie(200);l.code===200&&(D.value=Array.isArray(l.data)?l.data:[])}catch(l){D.value=[],f.error((l==null?void 0:l.message)||"加载失败")}finally{x.value=!1}},_=async()=>{await Promise.all([Q(),j()])},H=async l=>{try{await U.confirm("激活后项目将开始筹款，且无法再编辑（只能更新进展）。确定继续吗？","提示",{type:"warning"}),(await de(l.id)).code===200&&(f.success("已激活"),await _())}catch{}},X=async l=>{try{await U.confirm("确定要取消该项目吗？","提示",{type:"warning"}),(await ue(l.id)).code===200&&(f.success("已取消"),await _())}catch{}},y=u(!1),V=u(!1),z=u(null),L=u(""),C=u(""),Y=l=>{z.value=l.id,L.value=l.title,C.value=l.updateMessage||"",y.value=!0},q=async()=>{if(z.value){if(!C.value){f.warning("请填写进展内容");return}V.value=!0;try{(await re(z.value,C.value)).code===200&&(f.success("已更新"),y.value=!1,await _())}catch(l){f.error((l==null?void 0:l.message)||"更新失败")}finally{V.value=!1}}};return le(()=>{_()}),(l,e)=>{const i=pe,E=ge,T=fe,G=ve,J=_e,c=Ce,K=Ee,W=ke,P=be,Z=ye,ee=we,F=Te,M=De,te=xe,se=me,R=ce;return r(),b("div",Ae,[n("div",Ve,[n("div",ze,[e[11]||(e[11]=n("div",null,[n("h1",null,"我的众筹"),n("p",{class:"desc"},"草稿可编辑，激活后开始筹款；可随时更新最新进展。")],-1)),n("div",Le,[a(i,{onClick:e[0]||(e[0]=t=>g(m).push("/crowdfunding"))},{default:s(()=>[...e[9]||(e[9]=[o("返回列表",-1)])]),_:1}),a(i,{type:"primary",onClick:e[1]||(e[1]=t=>g(m).push("/crowdfunding/create"))},{default:s(()=>[...e[10]||(e[10]=[o("发起众筹",-1)])]),_:1})])]),N((r(),w(G,{gutter:16},{default:s(()=>[a(T,{xs:24,sm:6},{default:s(()=>[a(E,{class:"stat-card",shadow:"never"},{default:s(()=>[n("div",Ie,d(v.value.totalCount??"-"),1),e[12]||(e[12]=n("div",{class:"label"},"总项目",-1))]),_:1})]),_:1}),a(T,{xs:24,sm:6},{default:s(()=>[a(E,{class:"stat-card",shadow:"never"},{default:s(()=>[n("div",$e,d(v.value.activeCount??"-"),1),e[13]||(e[13]=n("div",{class:"label"},"进行中",-1))]),_:1})]),_:1}),a(T,{xs:24,sm:6},{default:s(()=>[a(E,{class:"stat-card",shadow:"never"},{default:s(()=>[n("div",Pe,d(v.value.successCount??"-"),1),e[14]||(e[14]=n("div",{class:"label"},"已完成",-1))]),_:1})]),_:1}),a(T,{xs:24,sm:6},{default:s(()=>[a(E,{class:"stat-card",shadow:"never"},{default:s(()=>[n("div",Fe,d(v.value.successRate??"-")+"%",1),e[15]||(e[15]=n("div",{class:"label"},"成功率",-1))]),_:1})]),_:1})]),_:1})),[[R,A.value]]),N((r(),w(E,{class:"list-card"},{header:s(()=>[n("div",Me,[e[17]||(e[17]=n("span",null,"项目列表",-1)),a(i,{link:"",type:"primary",onClick:_},{default:s(()=>[...e[16]||(e[16]=[o("刷新",-1)])]),_:1})])]),default:s(()=>[!x.value&&$.value.length===0?(r(),w(J,{key:0,description:"暂无项目"},{default:s(()=>[a(i,{type:"primary",onClick:e[2]||(e[2]=t=>g(m).push("/crowdfunding/create"))},{default:s(()=>[...e[18]||(e[18]=[o("发起众筹",-1)])]),_:1})]),_:1})):(r(),w(Z,{key:1,data:$.value,style:{width:"100%"}},{default:s(()=>[a(c,{prop:"id",label:"ID",width:"80"}),a(c,{label:"标题","min-width":"220"},{default:s(({row:t})=>[n("div",{class:"title-cell",onClick:k=>g(m).push(`/crowdfunding/${t.id}`)},[a(K,{class:"cover",src:t.coverImage,fit:"cover"},null,8,["src"]),n("div",Be,[n("div",Ne,d(t.title),1),n("div",Se,d(t.category||"-"),1)])],8,Re)]),_:1}),a(c,{label:"进度",width:"160"},{default:s(({row:t})=>[a(W,{percentage:t.progress||0,"stroke-width":8},null,8,["percentage"])]),_:1}),a(c,{label:"金额",width:"180"},{default:s(({row:t})=>[n("div",null,"¥"+d(t.currentAmount??0)+" / ¥"+d(t.targetAmount??0),1),n("div",Ue,"剩余 ¥"+d(t.remainingAmount??0),1)]),_:1}),a(c,{label:"状态",width:"120"},{default:s(({row:t})=>[a(P,{type:O(t.status)},{default:s(()=>[o(d(t.statusText||h(t.status)),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"剩余",width:"120"},{default:s(({row:t})=>[t.remainingDays==null?(r(),b("span",he,"-")):t.remainingDays<0?(r(),b("span",Oe,"已结束")):(r(),b("span",Qe,d(t.remainingDays)+" 天",1)),t.isEndingSoon?(r(),w(P,{key:3,size:"small",type:"warning",style:{"margin-left":"6px"}},{default:s(()=>[...e[19]||(e[19]=[o("即将结束",-1)])]),_:1})):S("",!0)]),_:1}),a(c,{label:"操作",width:"300",fixed:"right"},{default:s(({row:t})=>[a(i,{link:"",type:"primary",onClick:k=>g(m).push(`/crowdfunding/${t.id}`)},{default:s(()=>[...e[20]||(e[20]=[o("详情",-1)])]),_:1},8,["onClick"]),a(i,{link:"",type:"primary",disabled:t.status!=="DRAFT",onClick:k=>g(m).push(`/crowdfunding/edit/${t.id}`)},{default:s(()=>[...e[21]||(e[21]=[o(" 编辑 ",-1)])]),_:1},8,["disabled","onClick"]),a(i,{link:"",type:"success",disabled:t.status!=="DRAFT",onClick:k=>H(t)},{default:s(()=>[...e[22]||(e[22]=[o("激活",-1)])]),_:1},8,["disabled","onClick"]),a(i,{link:"",type:"warning",disabled:t.status!=="ACTIVE",onClick:k=>Y(t)},{default:s(()=>[...e[23]||(e[23]=[o("更新进展",-1)])]),_:1},8,["disabled","onClick"]),a(i,{link:"",type:"danger",disabled:t.status==="CANCELLED",onClick:k=>X(t)},{default:s(()=>[...e[24]||(e[24]=[o("取消",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),I.value>p.value.size?(r(),b("div",je,[a(ee,{"current-page":p.value.page,"onUpdate:currentPage":e[3]||(e[3]=t=>p.value.page=t),"page-size":p.value.size,"onUpdate:pageSize":e[4]||(e[4]=t=>p.value.size=t),total:I.value,"page-sizes":[5,10,20],layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])])):S("",!0)]),_:1})),[[R,x.value]])]),a(se,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=t=>y.value=t),title:"更新项目进展",width:"520px"},{footer:s(()=>[a(i,{onClick:e[7]||(e[7]=t=>y.value=!1)},{default:s(()=>[...e[25]||(e[25]=[o("取消",-1)])]),_:1}),a(i,{type:"primary",loading:V.value,onClick:q},{default:s(()=>[...e[26]||(e[26]=[o("保存",-1)])]),_:1},8,["loading"])]),default:s(()=>[a(te,{"label-width":"90px"},{default:s(()=>[a(M,{label:"项目"},{default:s(()=>[a(F,{modelValue:L.value,"onUpdate:modelValue":e[5]||(e[5]=t=>L.value=t),disabled:""},null,8,["modelValue"])]),_:1}),a(M,{label:"进展内容"},{default:s(()=>[a(F,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=t=>C.value=t),type:"textarea",rows:4,maxlength:"300","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},mt=ae(He,[["__scopeId","data-v-930d82eb"]]);export{mt as default};
