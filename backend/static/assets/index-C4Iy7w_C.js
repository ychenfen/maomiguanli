import{_ as ee,g as ae}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                  *//* empty css                    *//* empty css                 *//* empty css               *//* empty css               *//* empty css                  *//* empty css                *//* empty css                        *//* empty css                   *//* empty css                             */import{y as te,a6 as le,e as se,Y as re,m as ie,a1 as oe,a2 as de,B as ue,a as ne,ae as ce,_ as me,F as pe,R as ve,X as fe,H as _e,S as ge,T as ye,I as Ce,a9 as be,E as C,a5 as we}from"./element-plus-5e6ZgU0u.js";import{g as Ee}from"./university-BzVaJqCX.js";import{g as ke,c as Te,s as Ve,r as Ie,w as Ne}from"./verification-CTiRPKuY.js";import{r as g,c as Be,o as De,B as p,E as n,C as e,M as he,y as b,O as B,D as a,z as u,Q as o,K as A,R as c,a5 as xe}from"./vue-vendor-UlW9XFxV.js";import"./utils-Yxd-MeZx.js";const Fe={class:"verification-page"},Ue={class:"container"},Re={class:"page-header"},Se={class:"actions"},qe={key:0,class:"reject"},Me={class:"images"},Pe={class:"img-item"},He={class:"img-item"},Ye={class:"img-item"},je=["src"],Ae={key:1,class:"placeholder"},ze=["src"],Le={key:1,class:"placeholder"},Oe=["src"],$e={key:1,class:"placeholder"},Ge={__name:"index",setup(Je){const w=g(!1),l=g(null),D=Be(()=>l.value?[l.value.idCardFront,l.value.idCardBack,l.value.studentCard].filter(Boolean):[]),M=r=>r?ne(r).format("YYYY-MM-DD HH:mm"):"-",z=r=>({PENDING:"warning",APPROVED:"success",REJECTED:"danger"})[r]||"info",E=async()=>{w.value=!0;try{const r=await ke();r.code===200&&(l.value=r.data||null)}catch{l.value=null}finally{w.value=!1}},h=g([]),L=async()=>{try{const r=await Ee({pageNum:1,pageSize:200,status:1});r.code===200&&(h.value=r.data.records||[])}catch{h.value=[]}},x="https://your-domain.com/api/files/upload/image",F={Authorization:`Bearer ${ae()}`},y=g(!1),k=g("submit"),U=g(!1),P=g(null),s=g({universityId:null,realName:"",studentId:"",department:"",idCard:"",idCardFront:"",idCardBack:"",studentCard:"",verificationType:"STUDENT"}),O={universityId:[{required:!0,message:"请选择高校",trigger:"change"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],studentId:[{required:!0,message:"请输入学号/工号",trigger:"blur"}],department:[{required:!0,message:"请输入院系/部门",trigger:"blur"}],idCard:[{required:!0,message:"请输入身份证号",trigger:"blur"}],idCardFront:[{required:!0,message:"请上传身份证正面",trigger:"change"}],idCardBack:[{required:!0,message:"请上传身份证背面",trigger:"change"}],studentCard:[{required:!0,message:"请上传学生证/工作证",trigger:"change"}],verificationType:[{required:!0,message:"请选择认证类型",trigger:"change"}]},R=(r,t)=>{var m;(t==null?void 0:t.code)===200?s.value[r]=((m=t.data)==null?void 0:m.fileUrl)||"":C.error("上传失败")},$=()=>{k.value="submit",s.value={universityId:null,realName:"",studentId:"",department:"",idCard:"",idCardFront:"",idCardBack:"",studentCard:"",verificationType:"STUDENT"},y.value=!0},G=()=>{k.value="resubmit";const r=l.value||{};s.value={universityId:r.universityId||null,realName:r.realName||"",studentId:r.studentId||"",department:r.department||"",idCard:"",idCardFront:r.idCardFront||"",idCardBack:r.idCardBack||"",studentCard:r.studentCard||"",verificationType:r.verificationType||"STUDENT"},y.value=!0},J=async()=>{var t,m,T;if(await((m=(t=P.value)==null?void 0:t.validate)==null?void 0:m.call(t).catch(()=>!1))){U.value=!0;try{const _=await Te(s.value.studentId,s.value.universityId);if(_.code===200&&_.data===!0){C.error("该学号/工号已被认证，请检查输入或联系管理员");return}if(k.value==="submit")(await Ve(s.value)).code===200&&(C.success("提交成功"),y.value=!1,await E());else{const d=(T=l.value)==null?void 0:T.id;if(!d)return;(await Ie(d,s.value)).code===200&&(C.success("重新提交成功"),y.value=!1,await E())}}catch(_){C.error((_==null?void 0:_.message)||"提交失败")}finally{U.value=!1}}},K=async()=>{var t;const r=(t=l.value)==null?void 0:t.id;if(r)try{await we.confirm("确定要撤回当前认证申请吗？","提示",{type:"warning"}),(await Ne(r)).code===200&&(C.success("已撤回"),await E())}catch{}};return De(()=>{L(),E()}),(r,t)=>{const m=se,T=ie,_=ue,d=de,H=oe,Y=ce,S=me,Q=re,V=ye,j=ge,v=_e,f=fe,I=ve,N=Ce,q=be,W=pe,X=le,Z=te;return u(),p("div",Fe,[n("div",Ue,[n("div",Re,[t[11]||(t[11]=n("div",null,[n("h1",null,"身份认证"),n("p",{class:"desc"},"通过认证后，你将获得更可信的身份标识，并解锁更多权限。")],-1)),n("div",Se,[l.value&&l.value.status==="PENDING"?(u(),b(m,{key:0,type:"warning",onClick:K},{default:a(()=>[...t[8]||(t[8]=[o(" 撤回申请 ",-1)])]),_:1})):B("",!0),l.value&&l.value.status==="REJECTED"?(u(),b(m,{key:1,type:"primary",onClick:G},{default:a(()=>[...t[9]||(t[9]=[o(" 重新提交 ",-1)])]),_:1})):B("",!0),l.value?B("",!0):(u(),b(m,{key:2,type:"primary",onClick:$},{default:a(()=>[...t[10]||(t[10]=[o("提交认证",-1)])]),_:1}))])]),he((u(),b(Q,null,{default:a(()=>[!w.value&&!l.value?(u(),b(T,{key:0,description:"你还没有提交认证申请"})):(u(),p(A,{key:1},[e(H,{column:2,border:""},{default:a(()=>[e(d,{label:"状态"},{default:a(()=>[e(_,{type:z(l.value.status)},{default:a(()=>[o(c(l.value.statusText||l.value.status),1)]),_:1},8,["type"]),l.value.rejectReason?(u(),p("span",qe,"（"+c(l.value.rejectReason)+"）",1)):B("",!0)]),_:1}),e(d,{label:"认证类型"},{default:a(()=>[o(c(l.value.verificationTypeText||l.value.verificationType),1)]),_:1}),e(d,{label:"高校"},{default:a(()=>[o(c(l.value.universityName||"-"),1)]),_:1}),e(d,{label:"真实姓名"},{default:a(()=>[o(c(l.value.realName||"-"),1)]),_:1}),e(d,{label:"学号/工号"},{default:a(()=>[o(c(l.value.studentId||"-"),1)]),_:1}),e(d,{label:"院系/部门"},{default:a(()=>[o(c(l.value.department||"-"),1)]),_:1}),e(d,{label:"身份证号"},{default:a(()=>[o(c(l.value.idCard||"-"),1)]),_:1}),e(d,{label:"审核人"},{default:a(()=>[o(c(l.value.reviewUserName||"-"),1)]),_:1}),e(d,{label:"审核时间"},{default:a(()=>[o(c(M(l.value.reviewTime)),1)]),_:1}),e(d,{label:"过期时间"},{default:a(()=>[o(c(l.value.expireTime||"-"),1)]),_:1}),e(d,{label:"剩余天数"},{default:a(()=>[o(c(l.value.remainingDays??"-"),1)]),_:1}),e(d,{label:"提交时间"},{default:a(()=>[o(c(M(l.value.createTime)),1)]),_:1})]),_:1}),e(Y),n("div",Me,[n("div",Pe,[t[12]||(t[12]=n("div",{class:"label"},"身份证正面",-1)),e(S,{src:l.value.idCardFront,fit:"cover","preview-src-list":D.value},null,8,["src","preview-src-list"])]),n("div",He,[t[13]||(t[13]=n("div",{class:"label"},"身份证背面",-1)),e(S,{src:l.value.idCardBack,fit:"cover","preview-src-list":D.value},null,8,["src","preview-src-list"])]),n("div",Ye,[t[14]||(t[14]=n("div",{class:"label"},"学生证/工作证",-1)),e(S,{src:l.value.studentCard,fit:"cover","preview-src-list":D.value},null,8,["src","preview-src-list"])])])],64))]),_:1})),[[Z,w.value]])]),e(X,{modelValue:y.value,"onUpdate:modelValue":t[7]||(t[7]=i=>y.value=i),title:k.value==="submit"?"提交认证":"重新提交认证",width:"720px"},{footer:a(()=>[e(m,{onClick:t[6]||(t[6]=i=>y.value=!1)},{default:a(()=>[...t[16]||(t[16]=[o("取消",-1)])]),_:1}),e(m,{type:"primary",loading:U.value,onClick:J},{default:a(()=>[...t[17]||(t[17]=[o("提交",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(W,{ref_key:"formRef",ref:P,model:s.value,rules:O,"label-width":"110px"},{default:a(()=>[e(I,{gutter:16},{default:a(()=>[e(f,{span:12},{default:a(()=>[e(v,{label:"高校",prop:"universityId"},{default:a(()=>[e(j,{modelValue:s.value.universityId,"onUpdate:modelValue":t[0]||(t[0]=i=>s.value.universityId=i),filterable:"",placeholder:"请选择高校",style:{width:"100%"}},{default:a(()=>[(u(!0),p(A,null,xe(h.value,i=>(u(),b(V,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:a(()=>[e(v,{label:"认证类型",prop:"verificationType"},{default:a(()=>[e(j,{modelValue:s.value.verificationType,"onUpdate:modelValue":t[1]||(t[1]=i=>s.value.verificationType=i),placeholder:"请选择类型",style:{width:"100%"}},{default:a(()=>[e(V,{label:"学生",value:"STUDENT"}),e(V,{label:"教师",value:"TEACHER"}),e(V,{label:"职工",value:"STAFF"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,{gutter:16},{default:a(()=>[e(f,{span:12},{default:a(()=>[e(v,{label:"真实姓名",prop:"realName"},{default:a(()=>[e(N,{modelValue:s.value.realName,"onUpdate:modelValue":t[2]||(t[2]=i=>s.value.realName=i),maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:a(()=>[e(v,{label:"学号/工号",prop:"studentId"},{default:a(()=>[e(N,{modelValue:s.value.studentId,"onUpdate:modelValue":t[3]||(t[3]=i=>s.value.studentId=i),maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,{gutter:16},{default:a(()=>[e(f,{span:12},{default:a(()=>[e(v,{label:"院系/部门",prop:"department"},{default:a(()=>[e(N,{modelValue:s.value.department,"onUpdate:modelValue":t[4]||(t[4]=i=>s.value.department=i),maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:a(()=>[e(v,{label:"身份证号",prop:"idCard"},{default:a(()=>[e(N,{modelValue:s.value.idCard,"onUpdate:modelValue":t[5]||(t[5]=i=>s.value.idCard=i),maxlength:"18"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Y,{"content-position":"left"},{default:a(()=>[...t[15]||(t[15]=[o("上传材料",-1)])]),_:1}),e(I,{gutter:16},{default:a(()=>[e(f,{span:8},{default:a(()=>[e(v,{label:"身份证正面",prop:"idCardFront"},{default:a(()=>[e(q,{class:"uploader",action:x,headers:F,"show-file-list":!1,"on-success":i=>R("idCardFront",i)},{default:a(()=>[s.value.idCardFront?(u(),p("img",{key:0,src:s.value.idCardFront,class:"preview"},null,8,je)):(u(),p("div",Ae,"点击上传"))]),_:1},8,["on-success"])]),_:1})]),_:1}),e(f,{span:8},{default:a(()=>[e(v,{label:"身份证背面",prop:"idCardBack"},{default:a(()=>[e(q,{class:"uploader",action:x,headers:F,"show-file-list":!1,"on-success":i=>R("idCardBack",i)},{default:a(()=>[s.value.idCardBack?(u(),p("img",{key:0,src:s.value.idCardBack,class:"preview"},null,8,ze)):(u(),p("div",Le,"点击上传"))]),_:1},8,["on-success"])]),_:1})]),_:1}),e(f,{span:8},{default:a(()=>[e(v,{label:"学生证/工作证",prop:"studentCard"},{default:a(()=>[e(q,{class:"uploader",action:x,headers:F,"show-file-list":!1,"on-success":i=>R("studentCard",i)},{default:a(()=>[s.value.studentCard?(u(),p("img",{key:0,src:s.value.studentCard,class:"preview"},null,8,Oe)):(u(),p("div",$e,"点击上传"))]),_:1},8,["on-success"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},_a=ee(Ge,[["__scopeId","data-v-c3fe3567"]]);export{_a as default};
