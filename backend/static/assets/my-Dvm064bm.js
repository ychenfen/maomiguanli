import{_ as Y}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        */import{r as p,c as h,w as z,o as G,B as I,E as o,M as P,C as l,D as s,u as W,az as H,y as C,z as m,Q as r,O as k,R as u}from"./vue-vendor-UlW9XFxV.js";import{e as Q,y as j,E as K,Y as q,S as J,T as X,I as Z,m as ee,ar as te,as as ae,_ as le,B as se,a as oe,Q as ne}from"./element-plus-5e6ZgU0u.js";import{b as ie}from"./donation-CRMemvw3.js";import"./utils-Yxd-MeZx.js";const re={class:"my-donations-page"},ue={class:"container"},de={class:"page-header"},ce={class:"card-header"},pe={class:"filters"},me={class:"target-cell"},ve=["onClick"],_e={class:"name"},ge={class:"sub"},fe={key:2,class:"pagination-wrapper"},ye={__name:"my",setup(Ce){const E=H(),g=p(!1),b=p([]),v=p(""),_=p(""),f=p(""),n=p({page:1,size:10}),V=e=>({PENDING:"warning",SUCCESS:"success",FAILED:"danger",REFUNDED:"info"})[e]||"info",x=e=>e?oe(e).format("YYYY-MM-DD HH:mm"):"-",U=h(()=>b.value.map(e=>{const t=!!e.catId,i=!!e.crowdfundingId;return{...e,targetType:t?"CAT":i?"CROWDFUNDING":"UNKNOWN",targetTypeText:t?"猫咪":i?"众筹项目":"未知",targetName:t?e.catName:i?e.crowdfundingTitle:"",targetCover:t?e.catCoverImage:""}})),y=h(()=>{const e=f.value.trim();return U.value.filter(t=>!(v.value&&t.targetType!==v.value||_.value&&t.status!==_.value||e&&!`${t.targetName||""} ${t.message||""}`.toLowerCase().includes(e.toLowerCase())))}),S=h(()=>{const e=(n.value.page-1)*n.value.size;return y.value.slice(e,e+n.value.size)}),N=e=>{e.catId?E.push(`/cats/${e.catId}`):e.crowdfundingId&&E.push(`/crowdfunding/${e.crowdfundingId}`)},T=async()=>{g.value=!0;try{const e=await ie(200);e.code===200&&(b.value=Array.isArray(e.data)?e.data:[])}catch(e){K.error((e==null?void 0:e.message)||"加载失败"),b.value=[]}finally{g.value=!1}};return z(()=>[v.value,_.value,f.value],()=>{n.value.page=1}),z(()=>n.value.size,()=>{n.value.page=1}),G(()=>{T()}),(e,t)=>{const i=Q,d=X,D=J,A=Z,B=ee,$=le,c=ae,w=se,F=te,L=ne,M=q,R=j;return m(),I("div",re,[o("div",ue,[o("div",de,[t[7]||(t[7]=o("div",null,[o("h1",null,"我的打赏"),o("p",{class:"desc"},"查看你对猫咪/众筹项目的打赏记录。")],-1)),l(i,{onClick:t[0]||(t[0]=a=>W(E).push("/finance"))},{default:s(()=>[...t[6]||(t[6]=[r("去看财务公示",-1)])]),_:1})]),P((m(),C(M,null,{header:s(()=>[o("div",ce,[t[9]||(t[9]=o("span",null,"打赏记录",-1)),l(i,{link:"",type:"primary",onClick:T},{default:s(()=>[...t[8]||(t[8]=[r("刷新",-1)])]),_:1})])]),default:s(()=>[o("div",pe,[l(D,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=a=>v.value=a),clearable:"",placeholder:"打赏对象",style:{width:"160px"}},{default:s(()=>[l(d,{label:"猫咪",value:"CAT"}),l(d,{label:"众筹项目",value:"CROWDFUNDING"})]),_:1},8,["modelValue"]),l(D,{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=a=>_.value=a),clearable:"",placeholder:"支付状态",style:{width:"160px"}},{default:s(()=>[l(d,{label:"待支付",value:"PENDING"}),l(d,{label:"成功",value:"SUCCESS"}),l(d,{label:"失败",value:"FAILED"}),l(d,{label:"已退款",value:"REFUNDED"})]),_:1},8,["modelValue"]),l(A,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=a=>f.value=a),clearable:"",placeholder:"关键词（猫咪名/项目名/留言）",style:{width:"260px"}},null,8,["modelValue"])]),!g.value&&y.value.length===0?(m(),C(B,{key:0,description:"暂无打赏记录"})):(m(),C(F,{key:1,data:S.value,style:{width:"100%"}},{default:s(()=>[l(c,{label:"对象","min-width":"240"},{default:s(({row:a})=>[o("div",me,[a.targetCover?(m(),C($,{key:0,class:"cover",src:a.targetCover,fit:"cover",onClick:O=>N(a)},null,8,["src","onClick"])):k("",!0),o("div",{class:"meta",onClick:O=>N(a)},[o("div",_e,u(a.targetName||"-"),1),o("div",ge,u(a.targetTypeText),1)],8,ve)])]),_:1}),l(c,{label:"金额",width:"140",align:"right"},{default:s(({row:a})=>[r("¥"+u(a.amount),1)]),_:1}),l(c,{label:"匿名",width:"90",align:"center"},{default:s(({row:a})=>[l(w,{size:"small",type:a.isAnonymous?"info":"success"},{default:s(()=>[r(u(a.isAnonymous?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(c,{label:"状态",width:"120"},{default:s(({row:a})=>[l(w,{size:"small",type:V(a.status)},{default:s(()=>[r(u(a.statusText||a.status),1)]),_:2},1032,["type"])]),_:1}),l(c,{label:"留言","min-width":"220","show-overflow-tooltip":""},{default:s(({row:a})=>[r(u(a.message||"-"),1)]),_:1}),l(c,{label:"时间",width:"170"},{default:s(({row:a})=>[r(u(x(a.createTime)),1)]),_:1})]),_:1},8,["data"])),y.value.length>n.value.size?(m(),I("div",fe,[l(L,{"current-page":n.value.page,"onUpdate:currentPage":t[4]||(t[4]=a=>n.value.page=a),"page-size":n.value.size,"onUpdate:pageSize":t[5]||(t[5]=a=>n.value.size=a),total:y.value.length,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])])):k("",!0)]),_:1})),[[R,g.value]])])])}}},Be=Y(ye,[["__scopeId","data-v-fdc73151"]]);export{Be as default};
