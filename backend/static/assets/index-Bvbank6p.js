import{s as m}from"./index-CjZhQ3nS.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                 *//* empty css                     *//* empty css                */import{r as _,j as Q,z as y,R as e,J as n,A as r,B as s,u as x,O as d,P as u,K as X,I as g,L as E,Q as Z,a6 as ee,E as te,M as ae,W as z}from"./vue-vendor-L7KxampG.js";import{g as I,O as oe,E as p,e as ne,an as le,m as se,q as ie,r as re,I as ce,J as de,H as ue,k as pe,w as fe,ad as _e,v as me,F as ve,_ as L,X as ye,s as ge,p as Ee,Y as Ne,ao as he,a8 as V}from"./element-plus-B9MrEl8w.js";import{r as Ce}from"./zh-cn-zKIttnm5.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-DtAJ10D1.js";function be(f){return m({url:"/notifications/page",method:"post",data:f})}function U(f){return m({url:`/notifications/${f}/read`,method:"put"})}function Oe(){return m({url:"/notifications/read-all",method:"put"})}function ke(f){return m({url:`/notifications/${f}`,method:"delete"})}function Re(){return m({url:"/notifications/unread-count",method:"get"})}function Me(){return m({url:"/notifications/statistics",method:"get"})}const we={class:"notification-container"},xe={class:"header-content"},Ie={class:"header-actions"},Se={class:"stats-row"},Ae={class:"notification-list"},ze=["onClick"],Le={class:"notification-icon"},Ve={class:"notification-body"},Ue={class:"notification-title"},Be={class:"title-text"},Pe={class:"notification-content-text"},De={class:"notification-meta"},Fe={key:0,class:"sender"},He={class:"time"},Ge={class:"notification-actions"},$e={__name:"index",setup(f){I.extend(Ce),I.locale("zh-cn");const h=_(!1),C=_([]),T=_(0),N=_(0),b=_({}),i=_({pageNum:1,pageSize:10,type:"",isRead:null,priority:""}),c=async()=>{h.value=!0;try{const t=await be(i.value);t.code===200&&(C.value=t.data.records,T.value=t.data.total)}catch{p.error("加载通知失败")}finally{h.value=!1}},v=async()=>{try{const[t,a]=await Promise.all([Re(),Me()]);t.code===200&&(N.value=t.data),a.code===200&&(b.value=a.data)}catch(t){console.error("加载统计信息失败",t)}},B=async t=>{try{(await U(t)).code===200&&(p.success("已标记为已读"),c(),v())}catch{p.error("操作失败")}},P=async()=>{if(N.value!==0)try{await L.confirm(`确定要将所有 ${N.value} 条未读通知标记为已读吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await Oe()).code===200&&(p.success("全部标记为已读"),c(),v())}catch(t){t!=="cancel"&&p.error("操作失败")}},D=async t=>{try{await L.confirm("确定要删除这条通知吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await ke(t)).code===200&&(p.success("删除成功"),c(),v())}catch(a){a!=="cancel"&&p.error("删除失败")}},F=async t=>{t.isRead===0&&(await U(t.id),v()),console.log("跳转到相关页面",t)},H=t=>({SYSTEM:V,ADOPTION:he,RESCUE:Ne,COMMENT:Ee,LIKE:ge,DONATION:ye})[t]||V,G=t=>({SYSTEM:"#909399",ADOPTION:"#409EFF",RESCUE:"#E6A23C",COMMENT:"#67C23A",LIKE:"#F56C6C",DONATION:"#409EFF"})[t]||"#909399",$=t=>({LOW:"info",NORMAL:"",HIGH:"warning",URGENT:"danger"})[t]||"",K=t=>({LOW:"低",NORMAL:"普通",HIGH:"高",URGENT:"紧急"})[t]||"",W=t=>I(t).fromNow();return Q(()=>{c(),v()}),(t,a)=>{const O=ne,k=se,S=oe,l=de,R=ce,M=re,Y=ie,j=ue,w=pe,q=ve,J=me;return r(),y("div",we,[e(S,{class:"notification-header"},{default:n(()=>[s("div",xe,[a[6]||(a[6]=s("h2",null,"消息中心",-1)),s("div",Ie,[e(O,{type:"primary",icon:x(le),onClick:P,disabled:N.value===0},{default:n(()=>[...a[5]||(a[5]=[d(" 全部标记为已读 ",-1)])]),_:1},8,["icon","disabled"])])]),s("div",Se,[e(k,{type:"info"},{default:n(()=>[d("全部通知: "+u(b.value.total||0),1)]),_:1}),e(k,{type:"warning"},{default:n(()=>[d("未读: "+u(b.value.unread||0),1)]),_:1})])]),_:1}),e(S,{class:"notification-content"},{default:n(()=>[e(Y,{inline:!0,class:"filter-form"},{default:n(()=>[e(M,{label:"通知类型"},{default:n(()=>[e(R,{modelValue:i.value.type,"onUpdate:modelValue":a[0]||(a[0]=o=>i.value.type=o),placeholder:"全部类型",clearable:"",onChange:c},{default:n(()=>[e(l,{label:"全部",value:""}),e(l,{label:"系统通知",value:"SYSTEM"}),e(l,{label:"领养通知",value:"ADOPTION"}),e(l,{label:"救助通知",value:"RESCUE"}),e(l,{label:"评论通知",value:"COMMENT"}),e(l,{label:"点赞通知",value:"LIKE"}),e(l,{label:"捐赠通知",value:"DONATION"})]),_:1},8,["modelValue"])]),_:1}),e(M,{label:"已读状态"},{default:n(()=>[e(R,{modelValue:i.value.isRead,"onUpdate:modelValue":a[1]||(a[1]=o=>i.value.isRead=o),placeholder:"全部状态",clearable:"",onChange:c},{default:n(()=>[e(l,{label:"全部",value:null}),e(l,{label:"未读",value:0}),e(l,{label:"已读",value:1})]),_:1},8,["modelValue"])]),_:1}),e(M,{label:"优先级"},{default:n(()=>[e(R,{modelValue:i.value.priority,"onUpdate:modelValue":a[2]||(a[2]=o=>i.value.priority=o),placeholder:"全部优先级",clearable:"",onChange:c},{default:n(()=>[e(l,{label:"全部",value:""}),e(l,{label:"低",value:"LOW"}),e(l,{label:"普通",value:"NORMAL"}),e(l,{label:"高",value:"HIGH"}),e(l,{label:"紧急",value:"URGENT"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),X((r(),y("div",Ae,[C.value.length===0?(r(),g(j,{key:0,description:"暂无通知"})):E("",!0),(r(!0),y(Z,null,ee(C.value,o=>(r(),y("div",{key:o.id,class:te(["notification-item",{"is-unread":o.isRead===0}]),onClick:A=>F(o)},[s("div",Le,[e(w,{size:24,color:G(o.type)},{default:n(()=>[(r(),g(ae(H(o.type))))]),_:2},1032,["color"])]),s("div",Ve,[s("div",Ue,[s("span",Be,u(o.title),1),o.priority!=="NORMAL"?(r(),g(k,{key:0,type:$(o.priority),size:"small"},{default:n(()=>[d(u(K(o.priority)),1)]),_:2},1032,["type"])):E("",!0)]),s("div",Pe,u(o.content),1),s("div",De,[o.senderName?(r(),y("span",Fe,[e(w,null,{default:n(()=>[e(x(fe))]),_:1}),d(" "+u(o.senderName),1)])):E("",!0),s("span",He,[e(w,null,{default:n(()=>[e(x(_e))]),_:1}),d(" "+u(W(o.createTime)),1)])])]),s("div",Ge,[o.isRead===0?(r(),g(O,{key:0,size:"small",onClick:z(A=>B(o.id),["stop"])},{default:n(()=>[...a[7]||(a[7]=[d(" 标记已读 ",-1)])]),_:1},8,["onClick"])):E("",!0),e(O,{size:"small",type:"danger",plain:"",onClick:z(A=>D(o.id),["stop"])},{default:n(()=>[...a[8]||(a[8]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])])],10,ze))),128))])),[[J,h.value]]),T.value>0?(r(),g(q,{key:0,class:"pagination","current-page":i.value.pageNum,"onUpdate:currentPage":a[3]||(a[3]=o=>i.value.pageNum=o),"page-size":i.value.pageSize,"onUpdate:pageSize":a[4]||(a[4]=o=>i.value.pageSize=o),"page-sizes":[10,20,50,100],total:T.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])):E("",!0)]),_:1})])}}},lt=Te($e,[["__scopeId","data-v-01e7d1d7"]]);export{lt as default};
