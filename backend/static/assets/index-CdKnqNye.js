import{_ as X}from"./index-59OIMCbR.js";/* empty css                   *//* empty css               *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                       *//* empty css                        */import{r as c,l as Z,c as ee,aA as te,w as ae,o as se,B as d,E as o,C as a,D as s,az as oe,z as l,Q as u,u as v,M as ne,y as $,O as le,K as E,a5 as z,G as ie,R as m}from"./vue-vendor-UlW9XFxV.js";import{e as re,R as de,E as x,l as ce,a7 as ue,X as me,P as pe,W as _e,m as ve,Q as fe,y as ge,Y as ye,a8 as he,r as Ce,J as B,f as ke,a as Ee}from"./element-plus-5e6ZgU0u.js";import{g as ze,a as we,b as De,u as be,l as Te}from"./community-C3gF1jKv.js";import{D as Ne}from"./index-CqstUhxi.js";import"./utils-Yxd-MeZx.js";/* empty css                        */const Re={class:"community-page"},Ue={class:"container"},Ve={class:"page-header"},$e={class:"filter-tabs"},xe={class:"dynamics-list"},Be={key:2,class:"pagination-wrapper"},Pe={class:"card-header"},Se={class:"hot-topics"},Ae=["onClick"],Me={class:"topic-info"},Ye={class:"topic-name"},Fe={class:"topic-count"},He={class:"card-header"},Ie={class:"active-users"},Le=["onClick"],Oe={class:"user-info"},qe={class:"user-name"},Ge={class:"user-stats"},Qe={class:"card-header"},je={class:"notices"},Je={class:"notice-title"},Ke={class:"notice-time"},We={__name:"index",setup(Xe){const b=te(),f=oe(),g=c(!1),y=c(""),i=Z({page:1,size:10}),h=c([]),w=c(0),T=ee(()=>{const t=b.query.author,e=t?Number(t):NaN;return Number.isFinite(e)?e:null}),N=c([{name:"新手养猫",count:156},{name:"流浪猫救助",count:128},{name:"猫咪健康",count:102},{name:"领养故事",count:89},{name:"喵星人日常",count:76}]),R=c([]),P=c([{id:1,title:"关于加强流浪猫救助管理的通知",createTime:"2024-01-15"},{id:2,title:"校园流浪猫TNR计划启动",createTime:"2024-01-10"},{id:3,title:"寒假期间喂养点安排公告",createTime:"2024-01-05"}]),p=async()=>{g.value=!0;try{const t={pageNum:i.page,pageSize:i.size};y.value&&(t.type=y.value),T.value&&(t.userId=T.value);const e=await ze(t);e.code===200&&(h.value=e.data.records||[],w.value=e.data.total||0)}catch{x.error("加载动态列表失败")}finally{g.value=!1}},S=async()=>{try{const t=await we({limit:5});t.code===200&&t.data&&t.data.length>0&&(N.value=t.data.map(e=>({name:e.topic||e.name||"日常",count:e.dynamicCount||e.count||0})))}catch(t){console.error("加载热门话题失败",t)}},A=async()=>{try{const t=await De({limit:5});t.code===200&&t.data&&t.data.length>0&&(R.value=t.data.map(e=>({id:e.userId||e.id,username:e.username,avatar:e.avatar,dynamicCount:e.dynamicCount||0})))}catch(t){console.error("加载活跃用户失败",t)}},M=()=>{i.page=1,p()};ae(()=>b.query.author,()=>{i.page=1,p()});const Y=t=>{i.page=t,p(),window.scrollTo({top:0,behavior:"smooth"})},F=t=>{i.size=t,i.page=1,p()},U=()=>{f.push("/community/publish")},H=async(t,e)=>{try{e?await be(t):await Te(t);const r=h.value.find(C=>C.id===t);r&&(r.isLiked=!e,r.likeCount+=e?-1:1)}catch(r){x.error(r.message||"操作失败")}},I=t=>{f.push(`/community/${t}#comment`)},L=t=>{f.push(`/community/${t}`)},O=t=>{f.push(`/community?topic=${encodeURIComponent(t)}`)},q=t=>t?Ee(t).format("YYYY-MM-DD"):"-";return se(()=>{p(),S(),A()}),(t,e)=>{const r=ce,C=re,_=_e,G=pe,Q=ve,j=fe,V=me,D=ye,J=Ce,K=de,W=ge;return l(),d("div",Re,[o("div",Ue,[o("div",Ve,[e[4]||(e[4]=o("h1",null,"社区动态",-1)),e[5]||(e[5]=o("p",{class:"desc"},"分享你和毛孩子的温馨故事",-1)),a(C,{type:"primary",size:"large",onClick:U},{default:s(()=>[a(r,null,{default:s(()=>[a(v(ue))]),_:1}),e[3]||(e[3]=u(" 发布动态 ",-1))]),_:1})]),a(K,{gutter:24},{default:s(()=>[a(V,{xs:24,lg:16},{default:s(()=>[o("div",$e,[a(G,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),onChange:M},{default:s(()=>[a(_,{label:""},{default:s(()=>[...e[6]||(e[6]=[u("全部动态",-1)])]),_:1}),a(_,{label:"FEED"},{default:s(()=>[...e[7]||(e[7]=[u("投喂记录",-1)])]),_:1}),a(_,{label:"PHOTO"},{default:s(()=>[...e[8]||(e[8]=[u("猫咪照片",-1)])]),_:1}),a(_,{label:"UPDATE"},{default:s(()=>[...e[9]||(e[9]=[u("近况更新",-1)])]),_:1}),a(_,{label:"OTHER"},{default:s(()=>[...e[10]||(e[10]=[u("其他动态",-1)])]),_:1})]),_:1},8,["modelValue"])]),ne((l(),d("div",xe,[!g.value&&h.value.length===0?(l(),$(Q,{key:0,description:"暂无动态"},{default:s(()=>[a(C,{type:"primary",onClick:U},{default:s(()=>[...e[11]||(e[11]=[u(" 发布第一条动态 ",-1)])]),_:1})]),_:1})):(l(!0),d(E,{key:1},z(h.value,n=>(l(),$(Ne,{key:n.id,dynamic:n,onLike:H,onComment:I,onDetail:L},null,8,["dynamic"]))),128)),w.value>0?(l(),d("div",Be,[a(j,{"current-page":i.page,"onUpdate:currentPage":e[1]||(e[1]=n=>i.page=n),"page-size":i.size,"onUpdate:pageSize":e[2]||(e[2]=n=>i.size=n),total:w.value,"page-sizes":[10,20,30],layout:"total, sizes, prev, pager, next",onSizeChange:F,onCurrentChange:Y},null,8,["current-page","page-size","total"])])):le("",!0)])),[[W,g.value]])]),_:1}),a(V,{xs:24,lg:8},{default:s(()=>[a(D,{class:"side-card"},{header:s(()=>[o("div",Pe,[a(r,null,{default:s(()=>[a(v(he))]),_:1}),e[12]||(e[12]=o("span",null,"热门话题",-1))])]),default:s(()=>[o("div",Se,[(l(!0),d(E,null,z(N.value,(n,k)=>(l(),d("div",{key:k,class:"topic-item",onClick:Ze=>O(n.name)},[o("span",{class:ie(["topic-rank",`rank-${k+1}`])},m(k+1),3),o("div",Me,[o("div",Ye,"#"+m(n.name)+"#",1),o("div",Fe,m(n.count)+" 条动态",1)])],8,Ae))),128))])]),_:1}),a(D,{class:"side-card"},{header:s(()=>[o("div",He,[a(r,null,{default:s(()=>[a(v(B))]),_:1}),e[13]||(e[13]=o("span",null,"活跃用户",-1))])]),default:s(()=>[o("div",Ie,[(l(!0),d(E,null,z(R.value,n=>(l(),d("div",{key:n.id,class:"user-item",onClick:k=>t.$router.push(`/user/${n.id}`)},[a(J,{size:40,src:n.avatar},{default:s(()=>[a(r,null,{default:s(()=>[a(v(B))]),_:1})]),_:1},8,["src"]),o("div",Oe,[o("div",qe,m(n.username),1),o("div",Ge,m(n.dynamicCount)+" 条动态",1)])],8,Le))),128))])]),_:1}),a(D,{class:"side-card"},{header:s(()=>[o("div",Qe,[a(r,null,{default:s(()=>[a(v(ke))]),_:1}),e[14]||(e[14]=o("span",null,"社区公告",-1))])]),default:s(()=>[o("div",je,[(l(!0),d(E,null,z(P.value,n=>(l(),d("div",{key:n.id,class:"notice-item"},[o("div",Je,m(n.title),1),o("div",Ke,m(q(n.createTime)),1)]))),128))])]),_:1})]),_:1})]),_:1})])])}}},ft=X(We,[["__scopeId","data-v-3f50e9ce"]]);export{ft as default};
