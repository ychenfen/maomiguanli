import{s as w,_ as te}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";import{r as i,c as B,w as $,o as ae,B as D,C as e,D as a,z,M as oe,O as se,y as ne,F as ue,Q as p,R as E,E as h,am as re}from"./vue-vendor-UlW9XFxV.js";import{Y as ie,a6 as de,E as _,ar as pe,as as me,B as ce,a as ve,e as fe,y as ge,Q as _e,S as ye,T as be,I as Ve,F as Te,R as Ae,X as Ce,H as Ee,ap as we,aK as ke,a5 as xe}from"./element-plus-5e6ZgU0u.js";import"./utils-Yxd-MeZx.js";function Ie(d){return w({url:`/cat-tags/type/${d}`,method:"get"})}function Ue(d){return w({url:"/cat-tags",method:"post",data:d})}function ze(d,v){return w({url:`/cat-tags/${d}`,method:"put",data:v})}function he(d){return w({url:`/cat-tags/${d}`,method:"delete"})}function Se(d,v){return w({url:`/cat-tags/${d}/toggle`,method:"put",params:{active:v}})}const Oe={class:"cat-tag-admin"},Re={class:"header"},Ye={class:"actions"},Be={key:0,class:"pager"},$e={__name:"cat-tags",setup(d){const v=i(!1),I=i(!1),A=i("ACTIVITY"),y=i(null),k=i(""),x=i([]),r=i({page:1,size:10}),S=B(()=>x.value.length),N=B(()=>{const o=(r.value.page-1)*r.value.size;return x.value.slice(o,o+r.value.size)}),F=o=>({ACTIVITY:"活动标签",STATUS:"状态标签",CHARACTER:"性格标签"})[o]||o,H=o=>o?ve(o).format("YYYY-MM-DD HH:mm"):"-",c=async()=>{v.value=!0;try{const o=await Ie(A.value);if(o.code===200){const n=(Array.isArray(o.data)?o.data:[]).filter(u=>{if((y.value===0||y.value===1)&&u.isActive!==y.value)return!1;if(k.value){const m=k.value.trim();if(m&&!String(u.name||"").includes(m))return!1}return!0});x.value=n.sort((u,m)=>Number(u.sortOrder||0)-Number(m.sortOrder||0))}}catch(o){_.error((o==null?void 0:o.message)||"加载失败"),x.value=[]}finally{v.value=!1}};$(()=>[A.value,y.value],()=>{r.value.page=1}),$(()=>[r.value.size],()=>{r.value.page=1});const f=i(!1),C=i(!1),O=i(null),s=i({id:null,name:"",type:"ACTIVITY",color:"",icon:"",sortOrder:0,isActive:1}),M={name:[{required:!0,message:"请输入名称",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],isActive:[{required:!0,message:"请选择启用状态",trigger:"change"}]},q=()=>{C.value=!1,s.value={id:null,name:"",type:A.value,color:"",icon:"",sortOrder:0,isActive:1},f.value=!0},K=o=>{C.value=!0,s.value={id:o.id,name:o.name,type:o.type,color:o.color||"",icon:o.icon||"",sortOrder:o.sortOrder||0,isActive:o.isActive??1},f.value=!0},L=async()=>{var l,n;if(await((n=(l=O.value)==null?void 0:l.validate)==null?void 0:n.call(l).catch(()=>!1))){I.value=!0;try{C.value?(await ze(s.value.id,s.value)).code===200&&(_.success("保存成功"),f.value=!1,await c()):(await Ue(s.value)).code===200&&(_.success("创建成功"),f.value=!1,await c())}catch(u){_.error((u==null?void 0:u.message)||"操作失败")}finally{I.value=!1}}},P=async o=>{const l=o.isActive!==1;try{(await Se(o.id,l)).code===200&&(_.success("已更新"),await c())}catch(n){_.error((n==null?void 0:n.message)||"操作失败")}},Q=async o=>{try{await xe.confirm(`确定要删除标签「${o.name}」吗？`,"提示",{type:"warning"}),(await he(o.id)).code===200&&(_.success("已删除"),await c())}catch{}};return ae(()=>{c()}),(o,l)=>{const n=be,u=ye,m=Ve,b=fe,g=me,R=ce,j=pe,X=_e,G=ie,V=Ee,T=Ce,U=Ae,J=we,W=ke,Z=Te,ee=de,le=ge;return z(),D("div",Oe,[e(G,null,{header:a(()=>[h("div",Re,[l[14]||(l[14]=h("span",null,"猫咪标签管理",-1)),h("div",Ye,[e(u,{modelValue:A.value,"onUpdate:modelValue":l[0]||(l[0]=t=>A.value=t),style:{width:"160px"},onChange:c},{default:a(()=>[e(n,{label:"活动标签",value:"ACTIVITY"}),e(n,{label:"状态标签",value:"STATUS"}),e(n,{label:"性格标签",value:"CHARACTER"})]),_:1},8,["modelValue"]),e(u,{modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=t=>y.value=t),clearable:"",placeholder:"启用状态",style:{width:"140px"},onChange:c},{default:a(()=>[e(n,{label:"启用",value:1}),e(n,{label:"禁用",value:0})]),_:1},8,["modelValue"]),e(m,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=t=>k.value=t),placeholder:"搜索名称",clearable:"",style:{width:"220px"},onKeyup:re(c,["enter"])},null,8,["modelValue"]),e(b,{type:"primary",onClick:q},{default:a(()=>[...l[13]||(l[13]=[p("新增标签",-1)])]),_:1})])])]),default:a(()=>[oe((z(),ne(j,{data:N.value,style:{width:"100%"}},{default:a(()=>[e(g,{prop:"id",label:"ID",width:"80"}),e(g,{label:"名称","min-width":"180"},{default:a(({row:t})=>[e(R,{color:t.color||void 0,style:ue(t.color?"color:#fff;border:none":"")},{default:a(()=>[p(E(t.name),1)]),_:2},1032,["color","style"])]),_:1}),e(g,{prop:"typeText",label:"类型",width:"120"},{default:a(({row:t})=>[p(E(t.typeText||F(t.type)),1)]),_:1}),e(g,{prop:"sortOrder",label:"排序",width:"90"}),e(g,{label:"状态",width:"120"},{default:a(({row:t})=>[e(R,{type:t.isActive===1?"success":"info"},{default:a(()=>[p(E(t.isActive===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(g,{prop:"createTime",label:"创建时间",width:"170"},{default:a(({row:t})=>[p(E(H(t.createTime)),1)]),_:1}),e(g,{label:"操作",width:"260",fixed:"right"},{default:a(({row:t})=>[e(b,{link:"",type:"primary",onClick:Y=>K(t)},{default:a(()=>[...l[15]||(l[15]=[p("编辑",-1)])]),_:1},8,["onClick"]),e(b,{link:"",type:"warning",onClick:Y=>P(t)},{default:a(()=>[p(E(t.isActive===1?"禁用":"启用"),1)]),_:2},1032,["onClick"]),e(b,{link:"",type:"danger",onClick:Y=>Q(t)},{default:a(()=>[...l[16]||(l[16]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,v.value]]),S.value>r.value.size?(z(),D("div",Be,[e(X,{"current-page":r.value.page,"onUpdate:currentPage":l[3]||(l[3]=t=>r.value.page=t),"page-size":r.value.size,"onUpdate:pageSize":l[4]||(l[4]=t=>r.value.size=t),total:S.value,layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50]},null,8,["current-page","page-size","total"])])):se("",!0)]),_:1}),e(ee,{modelValue:f.value,"onUpdate:modelValue":l[12]||(l[12]=t=>f.value=t),title:C.value?"编辑标签":"新增标签",width:"620px"},{footer:a(()=>[e(b,{onClick:l[11]||(l[11]=t=>f.value=!1)},{default:a(()=>[...l[17]||(l[17]=[p("取消",-1)])]),_:1}),e(b,{type:"primary",loading:I.value,onClick:L},{default:a(()=>[...l[18]||(l[18]=[p("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(Z,{ref_key:"formRef",ref:O,model:s.value,rules:M,"label-width":"90px"},{default:a(()=>[e(U,{gutter:16},{default:a(()=>[e(T,{span:12},{default:a(()=>[e(V,{label:"名称",prop:"name"},{default:a(()=>[e(m,{modelValue:s.value.name,"onUpdate:modelValue":l[5]||(l[5]=t=>s.value.name=t),maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{span:12},{default:a(()=>[e(V,{label:"类型",prop:"type"},{default:a(()=>[e(u,{modelValue:s.value.type,"onUpdate:modelValue":l[6]||(l[6]=t=>s.value.type=t),style:{width:"100%"},disabled:C.value},{default:a(()=>[e(n,{label:"活动标签",value:"ACTIVITY"}),e(n,{label:"状态标签",value:"STATUS"}),e(n,{label:"性格标签",value:"CHARACTER"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(U,{gutter:16},{default:a(()=>[e(T,{span:12},{default:a(()=>[e(V,{label:"颜色"},{default:a(()=>[e(m,{modelValue:s.value.color,"onUpdate:modelValue":l[7]||(l[7]=t=>s.value.color=t),placeholder:"#409EFF",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{span:12},{default:a(()=>[e(V,{label:"图标"},{default:a(()=>[e(m,{modelValue:s.value.icon,"onUpdate:modelValue":l[8]||(l[8]=t=>s.value.icon=t),placeholder:"可选",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(U,{gutter:16},{default:a(()=>[e(T,{span:12},{default:a(()=>[e(V,{label:"排序"},{default:a(()=>[e(J,{modelValue:s.value.sortOrder,"onUpdate:modelValue":l[9]||(l[9]=t=>s.value.sortOrder=t),min:0,step:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{span:12},{default:a(()=>[e(V,{label:"启用",prop:"isActive"},{default:a(()=>[e(W,{modelValue:s.value.isActive,"onUpdate:modelValue":l[10]||(l[10]=t=>s.value.isActive=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},al=te($e,[["__scopeId","data-v-f2bd6ca3"]]);export{al as default};
