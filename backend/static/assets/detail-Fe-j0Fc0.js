import{_ as Q,u as Z}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                *//* empty css                        *//* empty css                   *//* empty css               */import{r as E,aA as W,c as V,o as X,B as N,E as s,C as l,M as ee,D as o,y as _,az as te,z as n,Q as u,u as f,O as v,R as i,K as se,a5 as ae}from"./vue-vendor-UlW9XFxV.js";import{e as le,y as oe,a6 as ne,E as c,Y as re,l as ue,Z as ie,B as ce,a4 as de,ah as ve,r as me,J as pe,ae as _e,_ as fe,N as ge,F as ye,H as Ee,I as Ne,a as ke,a5 as we}from"./element-plus-5e6ZgU0u.js";import{a as Ce,r as De,d as Ie,c as Re}from"./rescue-BHuK3UKq.js";import"./utils-Yxd-MeZx.js";const he={class:"detail-page"},Se={class:"container-small"},Ve={key:0},xe={class:"status-bar"},Be={class:"rescue-title"},be={class:"rescue-meta"},Oe={class:"meta-item"},ze={class:"meta-item"},Ae={class:"rescue-description"},Le={key:0,class:"rescue-images"},Te={class:"images-grid"},Me={class:"rescue-contact"},Pe={class:"contact-items"},Fe={class:"contact-item"},Ge={class:"contact-info"},Ye={class:"contact-value"},Ue={key:1,class:"resolve-note"},$e={class:"rescue-actions"},He={__name:"detail",setup(Je){const x=W(),I=te(),R=Z(),k=E(!1),r=E(!1),w=x.params.id,a=E(null),g=E(!1),m=E({resolveNote:""}),B=V(()=>{var e;return R.userInfo.id===((e=a.value)==null?void 0:e.userId)}),b=e=>{if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}},C=V(()=>{var e;return b((e=a.value)==null?void 0:e.images)}),O=e=>({PENDING:"待处理",PROCESSING:"处理中",RESOLVED:"已解决",CLOSED:"已关闭"})[e]||e,z=e=>({PENDING:"danger",PROCESSING:"warning",RESOLVED:"success",CLOSED:"info"})[e]||"info",A=e=>e?ke(e).format("YYYY-MM-DD HH:mm"):"-",D=async()=>{k.value=!0;try{const e=await Ce(w);e.code===200&&(a.value=e.data)}catch{c.error("加载救助详情失败")}finally{k.value=!1}},L=()=>{var e;(e=a.value)!=null&&e.userId&&I.push(`/user/${a.value.userId}`)},T=async()=>{try{r.value=!0,(await De(w)).code===200&&(c.success("已响应"),D())}catch(e){c.error(e.message||"响应失败")}finally{r.value=!1}},M=()=>{var e;m.value.resolveNote=((e=a.value)==null?void 0:e.resolveNote)||"",g.value=!0},P=async()=>{var e;if(!((e=m.value.resolveNote)!=null&&e.trim())){c.warning("请填写解决说明");return}try{r.value=!0,(await Re(w,m.value.resolveNote.trim())).code===200&&(c.success("已标记为已解决"),g.value=!1,D())}catch(t){c.error(t.message||"操作失败")}finally{r.value=!1}},F=async()=>{try{await we.confirm("确定要取消这条救助信息吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),r.value=!0,(await Ie(w)).code===200&&(c.success("已取消"),I.push("/rescue"))}catch(e){e!=="cancel"&&c.error(e.message||"取消失败")}finally{r.value=!1}};return X(()=>{D()}),(e,t)=>{const y=ue,p=le,h=ce,G=me,Y=_e,U=fe,$=re,H=Ne,J=Ee,j=ye,q=ne,K=oe;return n(),N("div",he,[s("div",Se,[l(p,{class:"back-btn",onClick:t[0]||(t[0]=d=>e.$router.back())},{default:o(()=>[l(y,null,{default:o(()=>[l(f(ie))]),_:1}),t[4]||(t[4]=u(" 返回 ",-1))]),_:1}),ee((n(),_($,{class:"detail-card"},{default:o(()=>[!k.value&&a.value?(n(),N("div",Ve,[s("div",xe,[l(h,{type:z(a.value.status),size:"large"},{default:o(()=>[u(i(O(a.value.status)),1)]),_:1},8,["type"]),a.value.priority===1?(n(),_(h,{key:0,type:"danger",size:"large"},{default:o(()=>[...t[5]||(t[5]=[u("紧急",-1)])]),_:1})):v("",!0)]),s("h1",Be,i(a.value.title),1),s("div",be,[s("div",Oe,[l(y,null,{default:o(()=>[l(f(de))]),_:1}),s("span",null,i(a.value.location),1)]),s("div",ze,[l(y,null,{default:o(()=>[l(f(ve))]),_:1}),s("span",null,i(A(a.value.createTime)),1)]),s("div",{class:"meta-item user",onClick:L},[l(G,{size:24,src:a.value.userAvatar},{default:o(()=>[l(y,null,{default:o(()=>[l(f(pe))]),_:1})]),_:1},8,["src"]),s("span",null,i(a.value.username),1)])]),l(Y),s("div",Ae,[t[6]||(t[6]=s("h3",null,"详细情况",-1)),s("p",null,i(a.value.description),1)]),C.value.length>0?(n(),N("div",Le,[t[7]||(t[7]=s("h3",null,"现场照片",-1)),s("div",Te,[(n(!0),N(se,null,ae(C.value,(d,S)=>(n(),_(U,{key:S,src:d,"preview-src-list":C.value,"initial-index":S,fit:"cover",class:"image-item"},null,8,["src","preview-src-list","initial-index"]))),128))])])):v("",!0),s("div",Me,[t[9]||(t[9]=s("h3",null,"联系方式",-1)),s("div",Pe,[s("div",Fe,[l(y,null,{default:o(()=>[l(f(ge))]),_:1}),s("div",Ge,[t[8]||(t[8]=s("div",{class:"contact-label"},"联系电话",-1)),s("div",Ye,i(a.value.contactPhone),1)])])])]),a.value.resolveNote?(n(),N("div",Ue,[t[10]||(t[10]=s("h3",null,"处理结果",-1)),s("p",null,i(a.value.resolveNote),1)])):v("",!0),s("div",$e,[f(R).isVolunteer&&a.value.canRespond?(n(),_(p,{key:0,type:"success",size:"large",loading:r.value,onClick:T},{default:o(()=>[...t[11]||(t[11]=[u(" 我来响应 ",-1)])]),_:1},8,["loading"])):v("",!0),a.value.canClose?(n(),_(p,{key:1,type:"warning",size:"large",onClick:M},{default:o(()=>[...t[12]||(t[12]=[u(" 标记已解决 ",-1)])]),_:1})):v("",!0),B.value&&a.value.status==="PENDING"?(n(),_(p,{key:2,type:"danger",plain:"",size:"large",onClick:F},{default:o(()=>[...t[13]||(t[13]=[u(" 取消救助信息 ",-1)])]),_:1})):v("",!0)])])):v("",!0)]),_:1})),[[K,k.value]]),l(q,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=d=>g.value=d),title:"标记为已解决",width:"420px"},{footer:o(()=>[l(p,{onClick:t[2]||(t[2]=d=>g.value=!1)},{default:o(()=>[...t[14]||(t[14]=[u("取消",-1)])]),_:1}),l(p,{type:"primary",loading:r.value,onClick:P},{default:o(()=>[...t[15]||(t[15]=[u("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(j,{model:m.value,"label-width":"90px"},{default:o(()=>[l(J,{label:"解决说明",required:""},{default:o(()=>[l(H,{modelValue:m.value.resolveNote,"onUpdate:modelValue":t[1]||(t[1]=d=>m.value.resolveNote=d),type:"textarea",rows:4,placeholder:"请简要说明处理结果",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])])}}},rt=Q(He,[["__scopeId","data-v-4a81069f"]]);export{rt as default};
