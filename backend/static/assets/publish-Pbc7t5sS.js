import{_ as q,g as z}from"./index-59OIMCbR.js";/* empty css                *//* empty css                     *//* empty css                  *//* empty css                    *//* empty css                       *//* empty css               *//* empty css                  *//* empty css                 */import{r as f,l as L,B as T,E as r,C as l,D as o,az as $,z as A,Q as m,u as v}from"./vue-vendor-UlW9XFxV.js";import{Y as S,F as D,H as F,I as O,S as G,T as H,P as J,aj as Y,a9 as j,l as Q,aa as W,N as K,ak as X,e as Z,E as u}from"./element-plus-5e6ZgU0u.js";import{p as ee}from"./rescue-BHuK3UKq.js";import"./utils-Yxd-MeZx.js";const le={class:"publish-page"},te={class:"container-small"},oe={class:"card-header"},ae={__name:"publish",setup(se){const E=$(),g=f(null),c=f(!1),t=L({title:"",description:"",location:"",type:"INJURED",priority:0,images:[],contactPhone:""}),V={title:[{required:!0,message:"请输入救助标题",trigger:"blur"},{min:5,message:"标题至少5个字符",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"},{min:20,message:"描述至少20个字符，以便志愿者了解情况",trigger:"blur"}],location:[{required:!0,message:"请输入发现地点",trigger:"blur"}],type:[{required:!0,message:"请选择救助类型",trigger:"change"}],contactPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},_=f([]),h="https://your-domain.com/api/files/upload/image",U={Authorization:`Bearer ${z()}`},w=s=>{const e=s.type.startsWith("image/"),i=s.size/1024/1024<5;return e?i?!0:(u.error("图片大小不能超过 5MB"),!1):(u.error("只能上传图片文件"),!1)},x=(s,e,i)=>{if(s.code===200)t.images.push(s.data.fileUrl);else{u.error("上传失败");const n=i.findIndex(d=>d.uid===e.uid);n>-1&&i.splice(n,1)}},R=(s,e)=>{if(s.response&&s.response.code===200){const i=s.response.data.fileUrl,n=t.images.indexOf(i);n>-1&&t.images.splice(n,1)}},B=async()=>{if(await g.value.validate().catch(()=>!1)){t.images.length===0&&u.warning("建议至少上传一张现场照片，以便志愿者更好地了解情况"),c.value=!0;try{const e={title:t.title,type:t.type,description:t.description,location:t.location,priority:t.priority,images:t.images.length>0?t.images:void 0,contactPhone:t.contactPhone};(await ee(e)).code===200&&(u.success("发布成功，志愿者会尽快联系您"),E.push("/rescue"))}catch(e){u.error(e.message||"发布失败")}finally{c.value=!1}}};return(s,e)=>{const i=Z,n=O,d=F,p=H,I=G,b=Y,P=J,y=Q,k=j,N=X,C=D,M=S;return A(),T("div",le,[r("div",te,[l(M,null,{header:o(()=>[r("div",oe,[e[9]||(e[9]=r("h2",null,"发布救助信息",-1)),l(i,{onClick:e[0]||(e[0]=a=>s.$router.back())},{default:o(()=>[...e[8]||(e[8]=[m("返回",-1)])]),_:1})])]),default:o(()=>[l(C,{ref_key:"formRef",ref:g,model:t,rules:V,"label-width":"120px"},{default:o(()=>[l(d,{label:"救助标题",prop:"title"},{default:o(()=>[l(n,{modelValue:t.title,"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),placeholder:"简要描述救助情况，例如：校园东门发现受伤小猫",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(d,{label:"详细描述",prop:"description"},{default:o(()=>[l(n,{modelValue:t.description,"onUpdate:modelValue":e[2]||(e[2]=a=>t.description=a),type:"textarea",rows:6,placeholder:"详细描述猫咪的情况、位置、外观特征等信息...",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(d,{label:"发现地点",prop:"location"},{default:o(()=>[l(n,{modelValue:t.location,"onUpdate:modelValue":e[3]||(e[3]=a=>t.location=a),placeholder:"请输入具体位置，例如：东区图书馆后面的花坛",maxlength:"200"},null,8,["modelValue"])]),_:1}),l(d,{label:"救助类型",prop:"type"},{default:o(()=>[l(I,{modelValue:t.type,"onUpdate:modelValue":e[4]||(e[4]=a=>t.type=a),placeholder:"请选择救助类型",style:{width:"100%"}},{default:o(()=>[l(p,{label:"受伤救助",value:"INJURED"}),l(p,{label:"走失寻找",value:"LOST"}),l(p,{label:"物资求助",value:"MATERIAL"}),l(p,{label:"紧急情况",value:"EMERGENCY"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"优先级",prop:"priority"},{default:o(()=>[l(P,{modelValue:t.priority,"onUpdate:modelValue":e[5]||(e[5]=a=>t.priority=a)},{default:o(()=>[l(b,{label:0},{default:o(()=>[...e[10]||(e[10]=[m("普通",-1)])]),_:1}),l(b,{label:1},{default:o(()=>[...e[11]||(e[11]=[m("紧急",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"现场照片",prop:"images"},{default:o(()=>[l(k,{"file-list":_.value,"onUpdate:fileList":e[6]||(e[6]=a=>_.value=a),action:h,headers:U,"list-type":"picture-card",limit:9,"on-success":x,"on-remove":R,"before-upload":w},{default:o(()=>[l(y,null,{default:o(()=>[l(v(W))]),_:1})]),_:1},8,["file-list"]),e[12]||(e[12]=r("div",{class:"upload-tip"}," 上传现场照片可以帮助志愿者更好地评估情况（最多9张，每张不超过5MB） ",-1))]),_:1}),l(d,{label:"联系电话",prop:"contactPhone"},{default:o(()=>[l(n,{modelValue:t.contactPhone,"onUpdate:modelValue":e[7]||(e[7]=a=>t.contactPhone=a),placeholder:"请输入您的联系电话",maxlength:"20"},{prepend:o(()=>[l(y,null,{default:o(()=>[l(v(K))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(N,{type:"warning",closable:!1,"show-icon":"",class:"notice-alert"},{title:o(()=>[...e[13]||(e[13]=[r("div",{class:"notice-title"},"发布前请注意",-1)])]),default:o(()=>[e[14]||(e[14]=r("ul",{class:"notice-list"},[r("li",null,"请确保信息真实有效，提供准确的地点和联系方式"),r("li",null,"如果猫咪情况危急，建议先拨打紧急救助热线：400-123-4567"),r("li",null,"上传清晰的照片有助于志愿者判断猫咪状态"),r("li",null,"发布后请保持手机畅通，及时回复志愿者"),r("li",null,"如果情况已解决，请及时更新救助状态")],-1))]),_:1}),l(d,null,{default:o(()=>[l(i,{type:"primary",size:"large",loading:c.value,onClick:B,style:{width:"100%"}},{default:o(()=>[...e[15]||(e[15]=[m(" 发布救助信息 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])])}}},Ee=q(ae,[["__scopeId","data-v-3ce3da13"]]);export{Ee as default};
