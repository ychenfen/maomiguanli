import{_ as j,g as G}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                *//* empty css                     *//* empty css                  *//* empty css                    *//* empty css                             *//* empty css                 *//* empty css                        *//* empty css               *//* empty css               *//* empty css                  *//* empty css                           */import{c as J,aA as W,r as i,o as ee,B as y,E as m,C as a,M as ae,D as t,y as Y,az as te,z as p,Q as b,R as N,K as le,a5 as oe,u as T}from"./vue-vendor-UlW9XFxV.js";import{an as re,y as se,E as f,Y as ue,ao as de,F as ne,R as ie,X as me,H as ce,I as pe,S as fe,T as ge,ap as ve,aq as _e,a9 as ye,l as be,aa as we,e as Ie}from"./element-plus-5e6ZgU0u.js";import{g as Ve}from"./cat-CoDgQuJ0.js";import{b as Ee,u as he,c as De}from"./crowdfunding-Dg2TszRA.js";import"./utils-Yxd-MeZx.js";const Ue={class:"crowdfunding-editor"},xe={class:"container"},ke={class:"header"},Ae={class:"title"},Ce={class:"actions"},Me=["src"],Be={key:1,class:"cover-placeholder"},Re={__name:"editor",setup(Le){const w=W(),I=te(),g=J(()=>!!w.params.id),V=i(!1),E=i(!1),x=i(null),l=i({title:"",description:"",catId:null,targetAmount:100,startDate:"",endDate:"",coverImage:"",imageUrls:[],category:"MEDICAL",contactInfo:"",updateMessage:""}),F={title:[{required:!0,message:"请输入项目标题",trigger:"blur"}],description:[{required:!0,message:"请输入项目描述",trigger:"blur"}],targetAmount:[{required:!0,message:"请输入目标金额",trigger:"change"}],category:[{required:!0,message:"请选择项目分类",trigger:"change"}]},k="https://your-domain.com/api/files/upload/image",A={Authorization:`Bearer ${G()}`},h=i([]),C=()=>{l.value.imageUrls=h.value.map(r=>r.url).filter(Boolean)},O=r=>{var e;(r==null?void 0:r.code)===200?l.value.coverImage=((e=r.data)==null?void 0:e.fileUrl)||"":f.error("上传失败")},S=(r,e)=>{var u;if((r==null?void 0:r.code)!==200){f.error("上传失败");return}const s=(u=r.data)==null?void 0:u.fileUrl;s&&(e.url=s,C())},$=()=>{C()},D=i(!1),v=i([]),q=async r=>{const e=(r||"").trim();if(!e){v.value=[];return}D.value=!0;try{const s=await Ve({pageNum:1,pageSize:20,keyword:e});s.code===200&&(v.value=s.data.records||[])}catch{v.value=[]}finally{D.value=!1}},z=async()=>{if(g.value){V.value=!0;try{const r=await Ee(w.params.id);if(r.code===200){const e=r.data||{};l.value={title:e.title||"",description:e.description||"",catId:e.catId||null,targetAmount:Number(e.targetAmount||0)||100,startDate:e.startDate||"",endDate:e.endDate||"",coverImage:e.coverImage||"",imageUrls:Array.isArray(e.imageUrls)?e.imageUrls:[],category:e.category||"MEDICAL",contactInfo:e.contactInfo||"",updateMessage:e.updateMessage||""},h.value=(l.value.imageUrls||[]).map((s,u)=>({name:`image-${u+1}`,url:s}))}}catch(r){f.error((r==null?void 0:r.message)||"加载失败")}finally{V.value=!1}}},H=async()=>{var e,s;if(await((s=(e=x.value)==null?void 0:e.validate)==null?void 0:s.call(e).catch(()=>!1))){E.value=!0;try{g.value?(await he(w.params.id,l.value)).code===200&&(f.success("保存成功"),I.push("/crowdfunding/my")):(await De(l.value)).code===200&&(f.success("创建成功（草稿）"),I.push("/crowdfunding/my"))}catch(u){f.error((u==null?void 0:u.message)||"保存失败")}finally{E.value=!1}}};return ee(()=>{z()}),(r,e)=>{const s=de,u=re,M=Ie,_=pe,d=ce,n=me,c=ge,B=fe,U=ie,K=ve,R=_e,L=ye,P=be,Q=ne,X=ue,Z=se;return p(),y("div",Ue,[m("div",xe,[a(u,{separator:"/",class:"breadcrumb"},{default:t(()=>[a(s,{to:{path:"/crowdfunding"}},{default:t(()=>[...e[10]||(e[10]=[b("爱心众筹",-1)])]),_:1}),a(s,null,{default:t(()=>[b(N(g.value?"编辑众筹":"发起众筹"),1)]),_:1})]),_:1}),ae((p(),Y(X,null,{header:t(()=>[m("div",ke,[m("div",Ae,[m("h2",null,N(g.value?"编辑众筹项目（仅草稿可编辑）":"发起众筹项目"),1),e[11]||(e[11]=m("p",{class:"sub"},"创建后默认保存为草稿，可在“我的众筹”中激活。",-1))]),m("div",Ce,[a(M,{onClick:e[0]||(e[0]=o=>T(I).push("/crowdfunding/my"))},{default:t(()=>[...e[12]||(e[12]=[b("我的众筹",-1)])]),_:1}),a(M,{type:"primary",loading:E.value,onClick:H},{default:t(()=>[...e[13]||(e[13]=[b("保存",-1)])]),_:1},8,["loading"])])])]),default:t(()=>[a(Q,{ref_key:"formRef",ref:x,model:l.value,rules:F,"label-width":"110px"},{default:t(()=>[a(U,{gutter:18},{default:t(()=>[a(n,{xs:24,md:14},{default:t(()=>[a(d,{label:"项目标题",prop:"title"},{default:t(()=>[a(_,{modelValue:l.value.title,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.title=o),maxlength:"50","show-word-limit":"",placeholder:"例如：救助受伤猫咪“小花”手术费用"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:10},{default:t(()=>[a(d,{label:"项目分类",prop:"category"},{default:t(()=>[a(B,{modelValue:l.value.category,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.category=o),placeholder:"请选择分类",style:{width:"100%"}},{default:t(()=>[a(c,{label:"医疗救助",value:"MEDICAL"}),a(c,{label:"猫粮口粮",value:"FOOD"}),a(c,{label:"绝育TNR",value:"STERILIZATION"}),a(c,{label:"保暖与庇护",value:"SHELTER"}),a(c,{label:"其他",value:"OTHER"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(U,{gutter:18},{default:t(()=>[a(n,{xs:24,md:10},{default:t(()=>[a(d,{label:"关联猫咪"},{default:t(()=>[a(B,{modelValue:l.value.catId,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.catId=o),filterable:"",remote:"",clearable:"","reserve-keyword":"","remote-method":q,loading:D.value,placeholder:"输入关键词搜索猫咪（可选）",style:{width:"100%"}},{default:t(()=>[(p(!0),y(le,null,oe(v.value,o=>(p(),Y(c,{key:o.id,label:`${o.name}（${o.breed||"未知"}）`,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),a(n,{xs:24,md:7},{default:t(()=>[a(d,{label:"目标金额",prop:"targetAmount"},{default:t(()=>[a(K,{modelValue:l.value.targetAmount,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.targetAmount=o),min:1,step:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:7},{default:t(()=>[a(d,{label:"联系方式",prop:"contactInfo"},{default:t(()=>[a(_,{modelValue:l.value.contactInfo,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.contactInfo=o),maxlength:"100",placeholder:"微信/电话/邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(U,{gutter:18},{default:t(()=>[a(n,{xs:24,md:12},{default:t(()=>[a(d,{label:"开始日期"},{default:t(()=>[a(R,{modelValue:l.value.startDate,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.startDate=o),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"不填则激活时自动取今天"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:12},{default:t(()=>[a(d,{label:"结束日期"},{default:t(()=>[a(R,{modelValue:l.value.endDate,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.endDate=o),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"不填则激活时默认+1个月"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(d,{label:"封面图片"},{default:t(()=>[a(L,{class:"cover-uploader",action:k,headers:A,"show-file-list":!1,"on-success":o=>O(o)},{default:t(()=>[l.value.coverImage?(p(),y("img",{key:0,src:l.value.coverImage,class:"cover-preview"},null,8,Me)):(p(),y("div",Be,"点击上传封面"))]),_:1},8,["on-success"])]),_:1}),a(d,{label:"项目图片"},{default:t(()=>[a(L,{"list-type":"picture-card",action:k,headers:A,"file-list":h.value,"on-success":S,"on-remove":$},{default:t(()=>[a(P,null,{default:t(()=>[a(T(we))]),_:1})]),_:1},8,["file-list"]),e[14]||(e[14]=m("div",{class:"hint"},"可上传多张，用于展示治疗单据/过程照片等（选填）。",-1))]),_:1}),a(d,{label:"项目描述",prop:"description"},{default:t(()=>[a(_,{modelValue:l.value.description,"onUpdate:modelValue":e[8]||(e[8]=o=>l.value.description=o),type:"textarea",rows:7,maxlength:"2000","show-word-limit":"",placeholder:"尽量写清楚：发现地点、伤情/需求、预算与用途、后续安排等。"},null,8,["modelValue"])]),_:1}),a(d,{label:"进展更新"},{default:t(()=>[a(_,{modelValue:l.value.updateMessage,"onUpdate:modelValue":e[9]||(e[9]=o=>l.value.updateMessage=o),type:"textarea",rows:3,maxlength:"300","show-word-limit":"",placeholder:"创建时可先写一句最新进展（选填）。"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})),[[Z,V.value]])])])}}},ea=j(Re,[["__scopeId","data-v-0df1492a"]]);export{ea as default};
