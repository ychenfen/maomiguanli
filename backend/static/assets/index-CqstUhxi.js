import{_ as J,r as K,u as Q}from"./index-59OIMCbR.js";/* empty css                *//* empty css                        *//* empty css               */import{az as W,r as X,c as k,y as m,z as l,D as s,E as n,O as u,C as e,u as d,R as r,Q as _,B as v,G as w,Y as T,K as Z,a5 as ee,P as ae}from"./vue-vendor-UlW9XFxV.js";import{a as p,r as te,l as ne,J as se,o as ce,ad as ie,h as oe,k as le,ac as de,B as re,aB as me,_ as ue,af as ye,A as fe,q as ge,ag as _e,Y as ve,a5 as pe,E as y}from"./element-plus-5e6ZgU0u.js";import{e as he}from"./community-C3gF1jKv.js";const ke={class:"dynamic-header"},we={class:"user-detail"},Ce={class:"user-name"},Ee={class:"publish-time"},De={key:2,class:"dynamic-images"},xe={class:"cat-info"},Te={class:"cat-name"},Ie={class:"dynamic-actions"},Me={__name:"index",props:{dynamic:{type:Object,required:!0}},emits:["like","comment","detail","refresh"],setup(a,{emit:I}){p.extend(K),p.locale("zh-cn");const t=a,f=I,C=W(),M=Q(),h=X(!1),B=k(()=>t.dynamic.content&&t.dynamic.content.length>200),E=k(()=>t.dynamic.images?t.dynamic.images.slice(0,9):[]),O=k(()=>typeof t.dynamic.canDelete=="boolean"?t.dynamic.canDelete:M.userInfo.id===t.dynamic.userId),b=c=>{if(!c)return"";const o=p(),i=p(c),g=o.diff(i,"hour");return g<24?i.fromNow():g<24*7?i.format("MM-DD HH:mm"):i.format("YYYY-MM-DD")},z=c=>({FEED:"投喂记录",PHOTO:"猫咪照片",UPDATE:"近况更新",OTHER:"其他动态"})[c]||c,H=c=>({FEED:"success",PHOTO:"primary",UPDATE:"warning",OTHER:"info"})[c]||"info",L=()=>{h.value=!0},N=()=>{t.dynamic.userId&&C.push(`/user/${t.dynamic.userId}`)},S=()=>{f("detail",t.dynamic.id)},Y=()=>{t.dynamic.catId&&C.push(`/cats/${t.dynamic.catId}`)},$=()=>{f("like",t.dynamic.id,t.dynamic.isLiked)},A=()=>{f("comment",t.dynamic.id)},P=()=>{const c=`${window.location.origin}/community/${t.dynamic.id}`;navigator.clipboard?navigator.clipboard.writeText(c).then(()=>{y.success("链接已复制到剪贴板")}).catch(()=>{y.warning("复制失败，请手动复制")}):y.info(`分享链接：${c}`)},F=async()=>{try{await pe.confirm("确定要删除这条动态吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),(await he(t.dynamic.id)).code===200&&(y.success("删除成功"),f("refresh"))}catch(c){c!=="cancel"&&y.error(c.message||"删除失败")}};return(c,o)=>{const i=ne,g=te,R=le,U=oe,V=ce,j=re,D=ue,q=ve;return l(),m(q,{class:"dynamic-card","body-style":{padding:"0"}},{default:s(()=>[n("div",ke,[n("div",{class:"user-info",onClick:N},[e(g,{size:40,src:a.dynamic.userAvatar},{default:s(()=>[e(i,null,{default:s(()=>[e(d(se))]),_:1})]),_:1},8,["src"]),n("div",we,[n("div",Ce,r(a.dynamic.username),1),n("div",Ee,r(a.dynamic.formattedTime||b(a.dynamic.createTime)),1)])]),O.value?(l(),m(V,{key:0,trigger:"click"},{dropdown:s(()=>[e(U,null,{default:s(()=>[e(R,{onClick:F},{default:s(()=>[e(i,null,{default:s(()=>[e(d(de))]),_:1}),o[0]||(o[0]=_(" 删除 ",-1))]),_:1})]),_:1})]),default:s(()=>[e(i,{class:"more-icon"},{default:s(()=>[e(d(ie))]),_:1})]),_:1})):u("",!0)]),n("div",{class:"dynamic-content",onClick:S},[a.dynamic.type?(l(),m(j,{key:0,type:H(a.dynamic.type),size:"small",class:"type-tag"},{default:s(()=>[_(r(z(a.dynamic.type)),1)]),_:1},8,["type"])):u("",!0),n("div",{class:w(["dynamic-text",{expanded:h.value}])},r(a.dynamic.content),3),B.value&&!h.value?(l(),v("div",{key:1,class:"expand-btn",onClick:T(L,["stop"])},[o[1]||(o[1]=_(" 展开全文 ",-1)),e(i,null,{default:s(()=>[e(d(me))]),_:1})])):u("",!0),a.dynamic.images&&a.dynamic.images.length>0?(l(),v("div",De,[(l(!0),v(Z,null,ee(E.value,(G,x)=>(l(),m(D,{key:x,src:G,"preview-src-list":a.dynamic.images,"initial-index":x,fit:"cover",class:w(["image-item",`image-count-${E.value.length}`])},null,8,["src","preview-src-list","initial-index","class"]))),128))])):u("",!0),a.dynamic.catId?(l(),v("div",{key:3,class:"related-cat",onClick:T(Y,["stop"])},[e(D,{src:a.dynamic.catImage,fit:"cover",class:"cat-image"},null,8,["src"]),n("div",xe,[n("div",Te,[e(i,null,{default:s(()=>[e(d(ye))]),_:1}),_(" "+r(a.dynamic.catName),1)]),o[2]||(o[2]=n("div",{class:"cat-desc"},"查看猫咪档案",-1))]),e(i,{class:"arrow-icon"},{default:s(()=>[e(d(fe))]),_:1})])):u("",!0)]),n("div",Ie,[n("div",{class:"action-item",onClick:$},[e(i,{class:w({liked:a.dynamic.isLiked})},{default:s(()=>[(l(),m(ae(a.dynamic.isLiked?"StarFilled":"Star")))]),_:1},8,["class"]),n("span",null,r(a.dynamic.likeCount||0),1)]),n("div",{class:"action-item",onClick:A},[e(i,null,{default:s(()=>[e(d(ge))]),_:1}),n("span",null,r(a.dynamic.commentCount||0),1)]),n("div",{class:"action-item",onClick:P},[e(i,null,{default:s(()=>[e(d(_e))]),_:1}),o[3]||(o[3]=n("span",null,"分享",-1))])])]),_:1})}}},Se=J(Me,[["__scopeId","data-v-54a342cd"]]);export{Se as D};
