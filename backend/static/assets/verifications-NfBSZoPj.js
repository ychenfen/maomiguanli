import{_ as X}from"./index-59OIMCbR.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                   *//* empty css                             *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";import{Y as Z,aL as ee,a6 as ae,E as b,ar as te,as as le,B as oe,a as se,e as ie,y as ne,Q as ue,S as re,T as de,I as pe,a1 as ve,a2 as me,ae as ce,_ as fe,F as _e,H as ye}from"./element-plus-5e6ZgU0u.js";import{a as Ee,b as be,d as ge}from"./verification-CTiRPKuY.js";import{r as p,c as we,o as Ve,B as A,C as e,D as t,z as y,M as Ce,E as g,y as R,Q as i,R as u,O as x}from"./vue-vendor-UlW9XFxV.js";import"./utils-Yxd-MeZx.js";const De={class:"verification-admin"},Te={class:"header"},ke={class:"filters"},Re={class:"pager"},xe={key:1,class:"imgs"},Ne={__name:"verifications",setup(Ie){const w=p(!1),N=p([]),I=p(0),m=p({page:1,size:10}),r=p({status:"",verificationType:"",keyword:""}),P=s=>({PENDING:"warning",APPROVED:"success",REJECTED:"danger"})[s]||"info",B=s=>s?se(s).format("YYYY-MM-DD HH:mm"):"-",E=async()=>{w.value=!0;try{const s={pageNum:m.value.page,pageSize:m.value.size,status:r.value.status||void 0,verificationType:r.value.verificationType||void 0,username:r.value.keyword||void 0,realName:r.value.keyword||void 0,studentId:r.value.keyword||void 0},a=await Ee(s);a.code===200&&(N.value=a.data.records||[],I.value=a.data.total||0)}catch(s){b.error((s==null?void 0:s.message)||"加载失败")}finally{w.value=!1}},O=()=>{m.value.page=1,E()},V=p(!1),o=p(null),C=we(()=>o.value?[o.value.idCardFront,o.value.idCardBack,o.value.studentCard].filter(Boolean):[]),S=async s=>{V.value=!0,o.value=s;try{const a=await be(s.id);a.code===200&&(o.value=a.data)}catch{}},c=p(!1),D=p(!1),n=p({id:null,status:"APPROVED",rejectReason:""}),J=s=>{n.value={id:s.id,status:"APPROVED",rejectReason:""},c.value=!0},M=s=>{n.value={id:s.id,status:"REJECTED",rejectReason:""},c.value=!0},Y=async()=>{if(n.value.id){if(n.value.status==="REJECTED"&&!n.value.rejectReason){b.warning("请填写拒绝理由");return}D.value=!0;try{(await ge(n.value)).code===200&&(b.success("操作成功"),c.value=!1,await E())}catch(s){b.error((s==null?void 0:s.message)||"操作失败")}finally{D.value=!1}}};return Ve(()=>{E()}),(s,a)=>{const f=de,z=re,T=pe,_=ie,v=le,U=oe,G=te,H=ue,$=Z,d=me,L=ve,h=ce,k=fe,Q=ee,j=ye,q=_e,K=ae,W=ne;return y(),A("div",De,[e($,null,{header:t(()=>[g("div",Te,[a[11]||(a[11]=g("span",null,"身份认证审核",-1)),g("div",ke,[e(z,{modelValue:r.value.status,"onUpdate:modelValue":a[0]||(a[0]=l=>r.value.status=l),clearable:"",placeholder:"状态",style:{width:"140px"}},{default:t(()=>[e(f,{label:"待审核",value:"PENDING"}),e(f,{label:"已通过",value:"APPROVED"}),e(f,{label:"已拒绝",value:"REJECTED"})]),_:1},8,["modelValue"]),e(z,{modelValue:r.value.verificationType,"onUpdate:modelValue":a[1]||(a[1]=l=>r.value.verificationType=l),clearable:"",placeholder:"类型",style:{width:"140px"}},{default:t(()=>[e(f,{label:"学生",value:"STUDENT"}),e(f,{label:"教师",value:"TEACHER"}),e(f,{label:"职工",value:"STAFF"})]),_:1},8,["modelValue"]),e(T,{modelValue:r.value.keyword,"onUpdate:modelValue":a[2]||(a[2]=l=>r.value.keyword=l),placeholder:"用户名/姓名/学号",style:{width:"220px"},clearable:""},null,8,["modelValue"]),e(_,{type:"primary",onClick:O},{default:t(()=>[...a[10]||(a[10]=[i("查询",-1)])]),_:1})])])]),default:t(()=>[Ce((y(),R(G,{data:N.value,style:{width:"100%"}},{default:t(()=>[e(v,{prop:"id",label:"ID",width:"80"}),e(v,{prop:"username",label:"用户名",width:"120"}),e(v,{prop:"realName",label:"真实姓名",width:"120"}),e(v,{prop:"studentId",label:"学号/工号",width:"140"}),e(v,{prop:"universityName",label:"高校","min-width":"180"}),e(v,{prop:"verificationTypeText",label:"类型",width:"110"}),e(v,{label:"状态",width:"120"},{default:t(({row:l})=>[e(U,{type:P(l.status)},{default:t(()=>[i(u(l.statusText||l.status),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"createTime",label:"提交时间",width:"170"},{default:t(({row:l})=>[i(u(B(l.createTime)),1)]),_:1}),e(v,{label:"操作",width:"220",fixed:"right"},{default:t(({row:l})=>[e(_,{link:"",type:"primary",onClick:F=>S(l)},{default:t(()=>[...a[12]||(a[12]=[i("详情",-1)])]),_:1},8,["onClick"]),e(_,{link:"",type:"success",disabled:l.status!=="PENDING",onClick:F=>J(l)},{default:t(()=>[...a[13]||(a[13]=[i("通过",-1)])]),_:1},8,["disabled","onClick"]),e(_,{link:"",type:"danger",disabled:l.status!=="PENDING",onClick:F=>M(l)},{default:t(()=>[...a[14]||(a[14]=[i("拒绝",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[W,w.value]]),g("div",Re,[e(H,{"current-page":m.value.page,"onUpdate:currentPage":a[3]||(a[3]=l=>m.value.page=l),"page-size":m.value.size,"onUpdate:pageSize":a[4]||(a[4]=l=>m.value.size=l),total:I.value,layout:"total, prev, pager, next",onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),e(Q,{modelValue:V.value,"onUpdate:modelValue":a[5]||(a[5]=l=>V.value=l),title:"认证详情",size:"720px"},{default:t(()=>[o.value?(y(),R(L,{key:0,column:2,border:""},{default:t(()=>[e(d,{label:"用户名"},{default:t(()=>[i(u(o.value.username),1)]),_:1}),e(d,{label:"真实姓名"},{default:t(()=>[i(u(o.value.realName),1)]),_:1}),e(d,{label:"学号/工号"},{default:t(()=>[i(u(o.value.studentId),1)]),_:1}),e(d,{label:"高校"},{default:t(()=>[i(u(o.value.universityName),1)]),_:1}),e(d,{label:"院系/部门"},{default:t(()=>[i(u(o.value.department),1)]),_:1}),e(d,{label:"认证类型"},{default:t(()=>[i(u(o.value.verificationTypeText),1)]),_:1}),e(d,{label:"身份证号"},{default:t(()=>[i(u(o.value.idCard),1)]),_:1}),e(d,{label:"状态"},{default:t(()=>[e(U,{type:P(o.value.status)},{default:t(()=>[i(u(o.value.statusText||o.value.status),1)]),_:1},8,["type"])]),_:1}),e(d,{label:"拒绝理由"},{default:t(()=>[i(u(o.value.rejectReason||"-"),1)]),_:1}),e(d,{label:"提交时间"},{default:t(()=>[i(u(B(o.value.createTime)),1)]),_:1})]),_:1})):x("",!0),e(h),o.value?(y(),A("div",xe,[e(k,{src:o.value.idCardFront,fit:"cover","preview-src-list":C.value},null,8,["src","preview-src-list"]),e(k,{src:o.value.idCardBack,fit:"cover","preview-src-list":C.value},null,8,["src","preview-src-list"]),e(k,{src:o.value.studentCard,fit:"cover","preview-src-list":C.value},null,8,["src","preview-src-list"])])):x("",!0)]),_:1},8,["modelValue"]),e(K,{modelValue:c.value,"onUpdate:modelValue":a[9]||(a[9]=l=>c.value=l),title:n.value.status==="APPROVED"?"通过认证":"拒绝认证",width:"520px"},{footer:t(()=>[e(_,{onClick:a[8]||(a[8]=l=>c.value=!1)},{default:t(()=>[...a[15]||(a[15]=[i("取消",-1)])]),_:1}),e(_,{type:"primary",loading:D.value,onClick:Y},{default:t(()=>[...a[16]||(a[16]=[i("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(q,{"label-width":"90px"},{default:t(()=>[e(j,{label:"认证ID"},{default:t(()=>[e(T,{modelValue:n.value.id,"onUpdate:modelValue":a[6]||(a[6]=l=>n.value.id=l),disabled:""},null,8,["modelValue"])]),_:1}),n.value.status==="REJECTED"?(y(),R(j,{key:0,label:"拒绝理由"},{default:t(()=>[e(T,{modelValue:n.value.rejectReason,"onUpdate:modelValue":a[7]||(a[7]=l=>n.value.rejectReason=l),type:"textarea",rows:3,maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})):x("",!0)]),_:1})]),_:1},8,["modelValue","title"])])}}},Xe=X(Ne,[["__scopeId","data-v-42faa8a0"]]);export{Xe as default};
