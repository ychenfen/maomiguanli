import{g as W}from"./index-B8C77IZt.js";/* empty css                *//* empty css                     *//* empty css                  *//* empty css                    *//* empty css                       *//* empty css                 */import{r as g,l as q,z,B as s,R as l,J as o,aA as A,A as C,O as p,u as _}from"./vue-vendor-L7KxampG.js";import{O as L,q as O,r as $,u as D,D as H,af as N,a9 as F,k as G,aa as T,B as J,p as S,ag as j,e as K,E as d}from"./element-plus-o-j_G_-z.js";import{p as Q}from"./rescue-B_3geFeJ.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCXpdI6d.js";const Y={class:"publish-page"},Z={class:"container-small"},ee={class:"card-header"},le={__name:"publish",setup(te){const v=A(),b=g(null),m=g(!1),t=q({title:"",description:"",location:"",urgency:"MEDIUM",images:[],contactPhone:"",contactWechat:""}),V={title:[{required:!0,message:"请输入救助标题",trigger:"blur"},{min:5,message:"标题至少5个字符",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"},{min:20,message:"描述至少20个字符，以便志愿者了解情况",trigger:"blur"}],location:[{required:!0,message:"请输入发现地点",trigger:"blur"}],urgency:[{required:!0,message:"请选择紧急程度",trigger:"change"}],contactPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},h=g([]),y="https://your-domain.com/api/file/upload",x={Authorization:`Bearer ${W()}`},E=r=>{const e=r.type.startsWith("image/"),i=r.size/1024/1024<5;return e?i?!0:(d.error("图片大小不能超过 5MB"),!1):(d.error("只能上传图片文件"),!1)},w=(r,e,i)=>{if(r.code===200)t.images.push(r.data.url);else{d.error("上传失败");const n=i.findIndex(u=>u.uid===e.uid);n>-1&&i.splice(n,1)}},U=(r,e)=>{if(r.response&&r.response.code===200){const i=r.response.data.url,n=t.images.indexOf(i);n>-1&&t.images.splice(n,1)}},B=async()=>{if(await b.value.validate().catch(()=>!1)){t.images.length===0&&d.warning("建议至少上传一张现场照片，以便志愿者更好地了解情况"),m.value=!0;try{const e={title:t.title,description:t.description,location:t.location,urgency:t.urgency,images:t.images.length>0?t.images:void 0,contactPhone:t.contactPhone,contactWechat:t.contactWechat||void 0};(await Q(e)).code===200&&(d.success("发布成功，志愿者会尽快联系您"),v.push("/rescue"))}catch(e){d.error(e.message||"发布失败")}finally{m.value=!1}}};return(r,e)=>{const i=K,n=D,u=$,c=N,I=H,f=G,k=F,M=j,P=O,R=L;return C(),z("div",Y,[s("div",Z,[l(R,null,{header:o(()=>[s("div",ee,[e[9]||(e[9]=s("h2",null,"发布救助信息",-1)),l(i,{onClick:e[0]||(e[0]=a=>r.$router.back())},{default:o(()=>[...e[8]||(e[8]=[p("返回",-1)])]),_:1})])]),default:o(()=>[l(P,{ref_key:"formRef",ref:b,model:t,rules:V,"label-width":"120px"},{default:o(()=>[l(u,{label:"救助标题",prop:"title"},{default:o(()=>[l(n,{modelValue:t.title,"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),placeholder:"简要描述救助情况，例如：校园东门发现受伤小猫",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(u,{label:"详细描述",prop:"description"},{default:o(()=>[l(n,{modelValue:t.description,"onUpdate:modelValue":e[2]||(e[2]=a=>t.description=a),type:"textarea",rows:6,placeholder:"详细描述猫咪的情况、位置、外观特征等信息...",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(u,{label:"发现地点",prop:"location"},{default:o(()=>[l(n,{modelValue:t.location,"onUpdate:modelValue":e[3]||(e[3]=a=>t.location=a),placeholder:"请输入具体位置，例如：东区图书馆后面的花坛",maxlength:"200"},null,8,["modelValue"])]),_:1}),l(u,{label:"紧急程度",prop:"urgency"},{default:o(()=>[l(I,{modelValue:t.urgency,"onUpdate:modelValue":e[4]||(e[4]=a=>t.urgency=a)},{default:o(()=>[l(c,{label:"LOW"},{default:o(()=>[...e[10]||(e[10]=[p("一般（猫咪状态良好）",-1)])]),_:1}),l(c,{label:"MEDIUM"},{default:o(()=>[...e[11]||(e[11]=[p("紧急（猫咪可能受伤或生病）",-1)])]),_:1}),l(c,{label:"HIGH"},{default:o(()=>[...e[12]||(e[12]=[p("非常紧急（猫咪情况危急）",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"现场照片",prop:"images"},{default:o(()=>[l(k,{"file-list":h.value,"onUpdate:fileList":e[5]||(e[5]=a=>h.value=a),action:y,headers:x,"list-type":"picture-card",limit:9,"on-success":w,"on-remove":U,"before-upload":E},{default:o(()=>[l(f,null,{default:o(()=>[l(_(T))]),_:1})]),_:1},8,["file-list"]),e[13]||(e[13]=s("div",{class:"upload-tip"}," 上传现场照片可以帮助志愿者更好地评估情况（最多9张，每张不超过5MB） ",-1))]),_:1}),l(u,{label:"联系电话",prop:"contactPhone"},{default:o(()=>[l(n,{modelValue:t.contactPhone,"onUpdate:modelValue":e[6]||(e[6]=a=>t.contactPhone=a),placeholder:"请输入您的联系电话",maxlength:"20"},{prepend:o(()=>[l(f,null,{default:o(()=>[l(_(J))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"微信号"},{default:o(()=>[l(n,{modelValue:t.contactWechat,"onUpdate:modelValue":e[7]||(e[7]=a=>t.contactWechat=a),placeholder:"选填，方便志愿者联系您",maxlength:"50"},{prepend:o(()=>[l(f,null,{default:o(()=>[l(_(S))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(M,{type:"warning",closable:!1,"show-icon":"",class:"notice-alert"},{title:o(()=>[...e[14]||(e[14]=[s("div",{class:"notice-title"},"发布前请注意",-1)])]),default:o(()=>[e[15]||(e[15]=s("ul",{class:"notice-list"},[s("li",null,"请确保信息真实有效，提供准确的地点和联系方式"),s("li",null,"如果猫咪情况危急，建议先拨打紧急救助热线：400-123-4567"),s("li",null,"上传清晰的照片有助于志愿者判断猫咪状态"),s("li",null,"发布后请保持手机畅通，及时回复志愿者"),s("li",null,"如果情况已解决，请及时更新救助状态")],-1))]),_:1}),l(u,null,{default:o(()=>[l(i,{type:"primary",size:"large",loading:m.value,onClick:B,style:{width:"100%"}},{default:o(()=>[...e[16]||(e[16]=[p(" 发布救助信息 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])])}}},ge=X(le,[["__scopeId","data-v-251d0851"]]);export{ge as default};
