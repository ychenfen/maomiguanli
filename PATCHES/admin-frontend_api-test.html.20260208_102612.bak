<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIè¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-card h2 {
            margin-top: 0;
            color: #333;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .status.success {
            background: #e8f5e9;
            color: #4caf50;
        }
        .status.error {
            background: #ffebee;
            color: #f44336;
        }
        .status.pending {
            background: #fff3e0;
            color: #ff9800;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç®¡ç†åå°APIè¿æ¥æµ‹è¯•</h1>

    <div class="test-card">
        <h2>1. åç«¯æœåŠ¡å¥åº·æ£€æŸ¥</h2>
        <p>çŠ¶æ€: <span id="healthStatus" class="status pending">æ£€æµ‹ä¸­...</span></p>
        <button onclick="testHealth()">é‡æ–°æ£€æµ‹</button>
        <pre id="healthResult">ç­‰å¾…æ£€æµ‹...</pre>
    </div>

    <div class="test-card">
        <h2>2. ç™»å½•APIæµ‹è¯•</h2>
        <p>çŠ¶æ€: <span id="loginStatus" class="status pending">æœªæµ‹è¯•</span></p>
        <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
        <pre id="loginResult">ç‚¹å‡»æŒ‰é’®æµ‹è¯•ç™»å½•...</pre>
    </div>

    <div class="test-card">
        <h2>3. ä»ªè¡¨æ¿ç»Ÿè®¡APIæµ‹è¯•</h2>
        <p>çŠ¶æ€: <span id="dashboardStatus" class="status pending">æœªæµ‹è¯•</span></p>
        <button onclick="testDashboard()">æµ‹è¯•ä»ªè¡¨æ¿</button>
        <pre id="dashboardResult">éœ€è¦å…ˆç™»å½•...</pre>
    </div>

    <div class="test-card">
        <h2>4. ç”¨æˆ·åˆ—è¡¨APIæµ‹è¯•</h2>
        <p>çŠ¶æ€: <span id="usersStatus" class="status pending">æœªæµ‹è¯•</span></p>
        <button onclick="testUsers()">æµ‹è¯•ç”¨æˆ·åˆ—è¡¨</button>
        <pre id="usersResult">éœ€è¦å…ˆç™»å½•...</pre>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        let token = null;

        // æµ‹è¯•åç«¯å¥åº·çŠ¶æ€
        async function testHealth() {
            const statusEl = document.getElementById('healthStatus');
            const resultEl = document.getElementById('healthResult');

            statusEl.className = 'status pending';
            statusEl.textContent = 'æ£€æµ‹ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/health`);
                const result = await response.json();

                statusEl.className = 'status success';
                statusEl.textContent = 'âœ“ æ­£å¸¸';
                resultEl.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'âœ— å¤±è´¥';
                resultEl.textContent = `é”™è¯¯: ${error.message}\n\nè¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨åœ¨ http://localhost:8080`;
            }
        }

        // æµ‹è¯•ç™»å½•API
        async function testLogin() {
            const statusEl = document.getElementById('loginStatus');
            const resultEl = document.getElementById('loginResult');

            statusEl.className = 'status pending';
            statusEl.textContent = 'æµ‹è¯•ä¸­...';

            try {
                const formData = new URLSearchParams();
                formData.append('username', 'admin');
                formData.append('password', '123456');

                const response = await fetch(`${API_BASE}/users/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData.toString()
                });

                const result = await response.json();

                if (result.code === 200) {
                    token = result.data.token;
                    localStorage.setItem('admin_token', token);
                    localStorage.setItem('admin_user', JSON.stringify(result.data.user));

                    statusEl.className = 'status success';
                    statusEl.textContent = 'âœ“ ç™»å½•æˆåŠŸ';
                    resultEl.textContent = JSON.stringify(result, null, 2);
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = 'âœ— ç™»å½•å¤±è´¥';
                    resultEl.textContent = JSON.stringify(result, null, 2);
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'âœ— å¤±è´¥';
                resultEl.textContent = `é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯•ä»ªè¡¨æ¿API
        async function testDashboard() {
            const statusEl = document.getElementById('dashboardStatus');
            const resultEl = document.getElementById('dashboardResult');

            if (!token) {
                token = localStorage.getItem('admin_token');
            }

            if (!token) {
                resultEl.textContent = 'è¯·å…ˆæµ‹è¯•ç™»å½•ï¼';
                return;
            }

            statusEl.className = 'status pending';
            statusEl.textContent = 'æµ‹è¯•ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/admin/dashboard/statistics`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();

                if (result.code === 200) {
                    statusEl.className = 'status success';
                    statusEl.textContent = 'âœ“ æˆåŠŸ';
                    resultEl.textContent = JSON.stringify(result, null, 2);
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = 'âœ— å¤±è´¥';
                    resultEl.textContent = JSON.stringify(result, null, 2);
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'âœ— å¤±è´¥';
                resultEl.textContent = `é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯•ç”¨æˆ·åˆ—è¡¨API
        async function testUsers() {
            const statusEl = document.getElementById('usersStatus');
            const resultEl = document.getElementById('usersResult');

            if (!token) {
                token = localStorage.getItem('admin_token');
            }

            if (!token) {
                resultEl.textContent = 'è¯·å…ˆæµ‹è¯•ç™»å½•ï¼';
                return;
            }

            statusEl.className = 'status pending';
            statusEl.textContent = 'æµ‹è¯•ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/admin/users?page=1&size=10`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();

                if (result.code === 200) {
                    statusEl.className = 'status success';
                    statusEl.textContent = 'âœ“ æˆåŠŸ';
                    resultEl.textContent = JSON.stringify(result, null, 2);
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = 'âœ— å¤±è´¥';
                    resultEl.textContent = JSON.stringify(result, null, 2);
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'âœ— å¤±è´¥';
                resultEl.textContent = `é”™è¯¯: ${error.message}`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•å¥åº·çŠ¶æ€
        window.onload = () => {
            testHealth();
            // å¦‚æœå·²ç»æœ‰tokenï¼Œè‡ªåŠ¨æµ‹è¯•å…¶ä»–API
            token = localStorage.getItem('admin_token');
            if (token) {
                document.getElementById('loginStatus').className = 'status success';
                document.getElementById('loginStatus').textContent = 'âœ“ å·²ç™»å½•';
                document.getElementById('loginResult').textContent = 'ä½¿ç”¨å·²ä¿å­˜çš„token';
            }
        };
    </script>
</body>
</html>
