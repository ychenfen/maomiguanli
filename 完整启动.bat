@echo off
chcp 65001 >nul
title çŒ«å’ªæ•‘ï¿½ï¿½ç³»ç»Ÿ - å®Œæ•´å¯åŠ¨
color 0A

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                                                            â•‘
echo â•‘           ðŸ± çŒ«å’ªæ•‘åŠ©ç³»ç»Ÿ - å®Œæ•´å¯åŠ¨è„šæœ¬ ðŸ±              â•‘
echo â•‘                                                            â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

cd /d "%~dp0"

:: ========== çŽ¯å¢ƒæ£€æŸ¥ ==========
echo [æ£€æŸ¥] æ­£åœ¨æ£€æŸ¥è¿è¡ŒçŽ¯å¢ƒ...
echo.

:: æ£€æŸ¥Java
echo [1/3] æ£€æŸ¥JavaçŽ¯å¢ƒ...
java -version >nul 2>&1
if errorlevel 1 (
    color 0C
    echo [é”™è¯¯] æœªæ£€æµ‹åˆ°JavaçŽ¯å¢ƒï¼
    echo        è¯·å…ˆå®‰è£…Java 17æˆ–æ›´é«˜ç‰ˆæœ¬
    echo        ä¸‹è½½åœ°å€: https://www.oracle.com/java/technologies/downloads/
    echo.
    pause
    exit /b 1
) else (
    echo [æˆåŠŸ] JavaçŽ¯å¢ƒæ£€æµ‹é€šè¿‡
)

:: æ£€æŸ¥Node.js
echo [2/3] æ£€æŸ¥Node.jsçŽ¯å¢ƒ...
node -v >nul 2>&1
if errorlevel 1 (
    color 0C
    echo [é”™è¯¯] æœªæ£€æµ‹åˆ°Node.jsçŽ¯å¢ƒï¼
    echo        è¯·å…ˆå®‰è£…Node.js 16æˆ–æ›´é«˜ç‰ˆæœ¬
    echo        ä¸‹è½½åœ°å€: https://nodejs.org/
    echo.
    pause
    exit /b 1
) else (
    echo [æˆåŠŸ] Node.jsçŽ¯å¢ƒæ£€æµ‹é€šè¿‡
)

:: æ£€æŸ¥å¿…è¦æ–‡ä»¶
echo [3/3] æ£€æŸ¥å¿…è¦æ–‡ä»¶...
if not exist "backend\cat-rescue.jar" (
    color 0C
    echo [é”™è¯¯] æœªæ‰¾åˆ°åŽç«¯jaræ–‡ä»¶: backend\cat-rescue.jar
    echo.
    pause
    exit /b 1
)
if not exist "frontend\server.js" (
    color 0C
    echo [é”™è¯¯] æœªæ‰¾åˆ°ç”¨æˆ·å‰ç«¯æœåŠ¡æ–‡ä»¶: frontend\server.js
    echo.
    pause
    exit /b 1
)
if not exist "admin-frontend\server.js" (
    color 0C
    echo [é”™è¯¯] æœªæ‰¾åˆ°ç®¡ç†åŽå°æœåŠ¡æ–‡ä»¶: admin-frontend\server.js
    echo.
    pause
    exit /b 1
)
echo [æˆåŠŸ] æ‰€æœ‰å¿…è¦æ–‡ä»¶æ£€æŸ¥é€šè¿‡
echo.

:: ========== ç«¯å£æ£€æŸ¥ ==========
echo [æ£€æŸ¥] æ­£åœ¨æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ...
echo.

netstat -ano | findstr ":8080" | findstr "LISTENING" >nul
if not errorlevel 1 (
    echo [è­¦å‘Š] ç«¯å£8080å·²è¢«å ç”¨ï¼Œæ­£åœ¨å°è¯•åœæ­¢æ—§æœåŠ¡...
    call åœæ­¢æœåŠ¡.bat >nul 2>&1
    timeout /t 2 /nobreak >nul
) else (
    echo [æˆåŠŸ] ç«¯å£8080å¯ç”¨
)

netstat -ano | findstr ":5000" | findstr "LISTENING" >nul
if not errorlevel 1 (
    echo [è­¦å‘Š] ç«¯å£5000å·²è¢«å ç”¨ï¼Œæ­£åœ¨å°è¯•åœæ­¢æ—§æœåŠ¡...
    call åœæ­¢æœåŠ¡.bat >nul 2>&1
    timeout /t 2 /nobreak >nul
) else (
    echo [æˆåŠŸ] ç«¯å£5000å¯ç”¨
)

netstat -ano | findstr ":5001" | findstr "LISTENING" >nul
if not errorlevel 1 (
    echo [è­¦å‘Š] ç«¯å£5001å·²è¢«å ç”¨ï¼Œæ­£åœ¨å°è¯•åœæ­¢æ—§æœåŠ¡...
    call åœæ­¢æœåŠ¡.bat >nul 2>&1
    timeout /t 2 /nobreak >nul
) else (
    echo [æˆåŠŸ] ç«¯å£5001å¯ç”¨
)
echo.

:: ========== å¯åŠ¨æœåŠ¡ ==========
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                      å¯åŠ¨æœåŠ¡ä¸­...                         â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: å¯åŠ¨åŽç«¯æœåŠ¡
echo [1/3] å¯åŠ¨åŽç«¯æœåŠ¡ (ç«¯å£ 8080)...
cd backend
if exist backend.log del backend.log
start /min cmd /c "java -jar cat-rescue.jar --spring.profiles.active=prod > backend.log 2>&1"
cd ..
echo       ç­‰å¾…åŽç«¯æœåŠ¡å¯åŠ¨...
timeout /t 8 /nobreak >nul

:: æ£€æŸ¥åŽç«¯æ˜¯å¦å¯åŠ¨æˆåŠŸ
netstat -ano | findstr ":8080" | findstr "LISTENING" >nul
if errorlevel 1 (
    color 0C
    echo [å¤±è´¥] åŽç«¯æœåŠ¡å¯åŠ¨å¤±è´¥ï¼
    echo        è¯·æŸ¥çœ‹æ—¥å¿—: backend\backend.log
    echo.
    pause
    exit /b 1
) else (
    echo [æˆåŠŸ] åŽç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ
)
echo.

:: å¯åŠ¨ç”¨æˆ·å‰ç«¯
echo [2/3] å¯åŠ¨ç”¨æˆ·å‰ç«¯ (ç«¯å£ 5000)...
cd frontend
if exist frontend.log del frontend.log
start /min cmd /c "node server.js > frontend.log 2>&1"
cd ..
echo       ç­‰å¾…ç”¨æˆ·å‰ç«¯å¯åŠ¨...
timeout /t 3 /nobreak >nul

:: æ£€æŸ¥ç”¨æˆ·å‰ç«¯æ˜¯å¦å¯åŠ¨æˆåŠŸ
netstat -ano | findstr ":5000" | findstr "LISTENING" >nul
if errorlevel 1 (
    color 0C
    echo [å¤±è´¥] ç”¨æˆ·å‰ç«¯å¯åŠ¨å¤±è´¥ï¼
    echo        è¯·æŸ¥çœ‹æ—¥å¿—: frontend\frontend.log
    echo.
    pause
    exit /b 1
) else (
    echo [æˆåŠŸ] ç”¨æˆ·å‰ç«¯å¯åŠ¨æˆåŠŸ
)
echo.

:: å¯åŠ¨ç®¡ç†åŽå°
echo [3/3] å¯åŠ¨ç®¡ç†åŽå° (ç«¯å£ 5001)...
cd admin-frontend
if exist admin.log del admin.log
start /min cmd /c "node server.js > admin.log 2>&1"
cd ..
echo       ç­‰å¾…ç®¡ç†åŽå°å¯åŠ¨...
timeout /t 3 /nobreak >nul

:: æ£€æŸ¥ç®¡ç†åŽå°æ˜¯å¦å¯åŠ¨æˆåŠŸ
netstat -ano | findstr ":5001" | findstr "LISTENING" >nul
if errorlevel 1 (
    color 0C
    echo [å¤±è´¥] ç®¡ç†åŽå°å¯åŠ¨å¤±è´¥ï¼
    echo        è¯·æŸ¥çœ‹æ—¥å¿—: admin-frontend\admin.log
    echo.
    pause
    exit /b 1
) else (
    echo [æˆåŠŸ] ç®¡ç†åŽå°å¯åŠ¨æˆåŠŸ
)
echo.

:: ========== å¯åŠ¨å®Œæˆ ==========
color 0A
echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                                                            â•‘
echo â•‘                  âœ“ æ‰€æœ‰æœåŠ¡å¯åŠ¨æˆåŠŸï¼                     â•‘
echo â•‘                                                            â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
echo â”‚  æœåŠ¡åœ°å€                                                  â”‚
echo â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
echo â”‚  ç”¨æˆ·å‰ç«¯:  http://localhost:5000                         â”‚
echo â”‚  ç®¡ç†åŽå°:  http://localhost:5001                         â”‚
echo â”‚  åŽç«¯API:   http://localhost:8080/api                     â”‚
echo â”‚  APIæ–‡æ¡£:   http://localhost:8080/swagger-ui.html         â”‚
echo â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
echo.
echo â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
echo â”‚  ç®¡ç†å‘˜è´¦å·                                                â”‚
echo â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
echo â”‚  ç”¨æˆ·å: admin                                             â”‚
echo â”‚  å¯†ç :   123456                                            â”‚
echo â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
echo.
echo â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
echo â”‚  æ—¥å¿—æ–‡ä»¶                                                  â”‚
echo â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
echo â”‚  åŽç«¯æ—¥å¿—:     backend\backend.log                        â”‚
echo â”‚  å‰ç«¯æ—¥å¿—:     frontend\frontend.log                      â”‚
echo â”‚  ç®¡ç†åŽå°æ—¥å¿—: admin-frontend\admin.log                   â”‚
echo â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
echo.
echo â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
echo â”‚  å¿«æ·æ“ä½œ                                                  â”‚
echo â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
echo â”‚  æŸ¥çœ‹çŠ¶æ€: è¿è¡Œ "æŸ¥çœ‹çŠ¶æ€.bat"                            â”‚
echo â”‚  åœæ­¢æœåŠ¡: è¿è¡Œ "åœæ­¢æœåŠ¡.bat"                            â”‚
echo â”‚  æŸ¥çœ‹æ—¥å¿—: æ‰“å¼€å¯¹åº”çš„logæ–‡ä»¶                              â”‚
echo â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
echo.

:: è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
echo [æç¤º] æ­£åœ¨æ‰“å¼€æµè§ˆå™¨...
timeout /t 2 /nobreak >nul
start http://localhost:5000
timeout /t 1 /nobreak >nul
start http://localhost:5001/login.html
echo.

echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo  æç¤º: è¯·ä¿æŒæ­¤çª—å£æ‰“å¼€ï¼Œå…³é—­å°†åœæ­¢æ‰€æœ‰æœåŠ¡
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo æŒ‰ä»»æ„é”®é€€å‡ºå¹¶åœæ­¢æ‰€æœ‰æœåŠ¡...
pause >nul

:: é€€å‡ºæ—¶åœæ­¢æœåŠ¡
echo.
echo [æ¸…ç†] æ­£åœ¨åœæ­¢æ‰€æœ‰æœåŠ¡...
call åœæ­¢æœåŠ¡.bat >nul 2>&1
echo [å®Œæˆ] æ‰€æœ‰æœåŠ¡å·²åœæ­¢
timeout /t 2 /nobreak >nul
